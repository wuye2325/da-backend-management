<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>流程模板管理 - 大家共治后台管理系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="js/sidebar.js"></script>
    <script src="js/top-navigation.js"></script>
    <script src="js/tab-system.js"></script>
    <script src="js/layout.js"></script>
</head>
<body class="bg-gray-50">
    <div class="flex h-screen">
        <!-- Sidebar Container -->
        <div id="sidebar-container"></div>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Top Navigation Container -->
            <div id="top-navigation-container"></div>

            <!-- Content -->
            <main id="main-content" class="flex-1 overflow-y-auto p-6">

                <!-- Templates Table -->
                <div class="bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-medium text-gray-900">流程模板列表</h3>
                            <div class="flex items-center space-x-3">
                                <button onclick="createNewTemplate()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center">
                                    <i class="fas fa-plus mr-2"></i>新建模板
                                </button>
                                <div class="relative">
                                    <input type="text" placeholder="搜索模板..." 
                                           class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                </div>

                                <select class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option>全部状态</option>
                                    <option>启用</option>
                                    <option>草稿</option>
                                    <option>停用</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">模板信息</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">步骤数</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">状态</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">更新时间</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <!-- 支出申请 -->
                                <tr class="hover:bg-gray-50">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div>
                                            <div class="text-sm font-medium text-gray-900">支出申请</div>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">4</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">启用</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2024-01-15</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <button onclick="editTemplate('1')" class="text-blue-600 hover:text-bg-blue-100 -900 mr-3">编辑</button>
                                        <button onclick="previewTemplate('1')" class="text-gray-600 hover:text-gray-900 mr-3">预览</button>
                                        <button onclick="toggleTemplateStatus('1', 'enabled')" class="text-orange-600 hover:text-orange-900 mr-3">停用</button>
                                        <button onclick="deleteTemplate('1')" class="text-red-600 hover:text-red-900">删除</button>
                                    </td>
                                </tr>
                                <!-- 用印申请 -->
                                <tr class="hover:bg-gray-50">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div>
                                            <div class="text-sm font-medium text-gray-900">用印申请</div>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">4</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">启用</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2024-01-12</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <button onclick="editTemplate('2')" class="text-blue-600 hover:text-bg-blue-100 -900 mr-3">编辑</button>
                                        <button onclick="previewTemplate('2')" class="text-gray-600 hover:text-gray-900 mr-3">预览</button>
                                        <button onclick="toggleTemplateStatus('2', 'enabled')" class="text-orange-600 hover:text-orange-900 mr-3">停用</button>
                                        <button onclick="deleteTemplate('2')" class="text-red-600 hover:text-red-900">删除</button>
                                    </td>
                                </tr>

                            </tbody>
                        </table>
                    </div>
                    <div class="bg-white px-4 py-3 border-t border-gray-200 sm:px-6">
                        <div class="flex items-center justify-between">
                            <div class="flex-1 flex justify-between sm:hidden">
                                <button class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">上一页</button>
                                <button class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">下一页</button>
                            </div>
                            <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                                <div>
                                    <p class="text-sm text-gray-700">显示 <span class="font-medium">1</span> 到 <span class="font-medium">2</span> 共 <span class="font-medium">2</span> 条记录</p>
                                </div>
                                <div>
                                    <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px">
                                        <button class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                            <i class="fas fa-chevron-left"></i>
                                        </button>
                                        <button class="bg-blue-50 border-blue-500 text-blue-600 relative inline-flex items-center px-4 py-2 border text-sm font-medium">1</button>
                                        <button class="bg-white border-gray-300 text-gray-500 hover:bg-gray-50 relative inline-flex items-center px-4 py-2 border text-sm font-medium">2</button>
                                        <button class="bg-white border-gray-300 text-gray-500 hover:bg-gray-50 relative inline-flex items-center px-4 py-2 border text-sm font-medium">3</button>
                                        <button class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                            <i class="fas fa-chevron-right"></i>
                                        </button>
                                    </nav>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        // 页面初始化
        document.addEventListener('DOMContentLoaded', function() {
            initPage('template-process');
        });

        /**
         * 创建新模板
         * 跳转到流程配置页面进行新建操作
         */
        function createNewTemplate() {
            // 跳转到流程配置页面，mode=create表示新建模式
            window.location.href = 'process-config.html?mode=create';
        }

        /**
         * 编辑模板
         * @param {string} templateId - 模板ID
         */
        function editTemplate(templateId) {
            // 跳转到流程配置页面，mode=edit表示编辑模式，传入模板ID
            window.location.href = `process-config.html?mode=edit&id=${templateId}`;
        }

        /**
         * 预览模板
         * @param {string} templateId - 模板ID
         */
        function previewTemplate(templateId) {
            // 跳转到流程配置页面，mode=preview表示预览模式，传入模板ID
            window.location.href = `process-config.html?mode=preview&id=${templateId}`;
        }

        /**
         * 切换模板状态（启用/停用）
         * @param {string} templateId - 模板ID
         * @param {string} currentStatus - 当前状态
         */
        function toggleTemplateStatus(templateId, currentStatus) {
            const newStatus = currentStatus === 'enabled' ? 'disabled' : 'enabled';
            const action = newStatus === 'enabled' ? '启用' : '停用';
            
            if (confirm(`确定要${action}此模板吗？`)) {
                // 这里应该调用后端API来更新模板状态
                console.log(`${action}模板 ${templateId}`);
                
                // 模拟API调用成功后的处理
                setTimeout(() => {
                    // 更新按钮文本和样式
                    const button = event.target;
                    if (newStatus === 'enabled') {
                        button.textContent = '停用';
                        button.className = 'text-orange-600 hover:text-orange-900 mr-3';
                        button.onclick = () => toggleTemplateStatus(templateId, 'enabled');
                    } else {
                        button.textContent = '启用';
                        button.className = 'text-green-600 hover:text-green-900 mr-3';
                        button.onclick = () => toggleTemplateStatus(templateId, 'disabled');
                    }
                    
                    // 更新状态列显示
                    const row = button.closest('tr');
                    const statusCell = row.querySelector('td:nth-child(5)');
                    if (statusCell) {
                        const statusSpan = statusCell.querySelector('span');
                        if (statusSpan) {
                            if (newStatus === 'enabled') {
                                statusSpan.textContent = '启用';
                                statusSpan.className = 'px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800';
                            } else {
                                statusSpan.textContent = '停用';
                                statusSpan.className = 'px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800';
                            }
                        }
                    }
                    
                    alert(`模板已成功${action}`);
                }, 500);
            }
        }

        /**
         * 删除模板
         * @param {string} templateId - 模板ID
         */
        function deleteTemplate(templateId) {
            if (confirm('确定要删除此模板吗？此操作不可恢复。')) {
                // 这里应该调用后端API来删除模板
                console.log(`删除模板 ${templateId}`);
                
                // 模拟API调用成功后的处理
                setTimeout(() => {
                    const button = event.target;
                    const row = button.closest('tr');
                    row.remove();
                    alert('模板已成功删除');
                }, 500);
            }
        }
    </script>
</body>
</html>
