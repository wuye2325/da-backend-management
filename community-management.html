<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小区管理 - 大家共治后台管理系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
         .table-wrapper {
             position: relative;
             overflow: hidden;
             border: 1px solid #e5e7eb;
             border-radius: 0.5rem;
         }
         .scrollable-table {
             overflow-x: auto;
             margin-right: 280px; /* 操作列宽度 */
         }
         .fixed-column {
             position: absolute;
             top: 0;
             right: 0;
             width: 280px;
             background: white;
             border-left: 1px solid #e5e7eb;
             box-shadow: -2px 0 4px rgba(0, 0, 0, 0.1);
         }
         .main-table {
             min-width: 1120px; /* 减去操作列宽度 */
         }
         .fixed-table {
             width: 280px;
         }
         /* 确保两个表格行高一致 */
         .main-table tr,
         .fixed-table tr {
             height: 73px; /* 固定行高 */
         }
         .main-table th,
         .fixed-table th {
             height: 40px; /* 优化表头高度 */
             white-space: nowrap; /* 表头文字单行显示 */
         }
         .main-table td,
         .fixed-table td {
             vertical-align: middle;
         }
     </style>
    <script src="js/tab-system.js"></script>
    <script src="js/layout.js"></script>
    <script src="js/main.js"></script>
    <script src="js/search-component.js"></script>
    <!-- 引入附件上传组件 -->
    <script src="components/AttachmentUpload.js"></script>
    <!-- 引入状态开关组件 -->
    <script src="components/toggle-switch.js"></script>
</head>
<body class="bg-gray-50">
    <div class="flex h-screen">
        <!-- Sidebar Container -->
        <div id="sidebar-container"></div>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Top Navigation Container -->
            <div id="top-navigation-container"></div>

            <!-- Content -->
            <main id="main-content" class="flex-1 overflow-y-auto p-6">
            <!-- Page Header -->
            <div class="mb-8">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900 mb-2">小区管理</h1>
                    </div>
                    <button onclick="openAddModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        <i class="fas fa-plus mr-2"></i>新增
                    </button>
                </div>
            </div>



            <!-- Search and Filter -->
            <div class="bg-white rounded-lg shadow mb-6">
                <div class="p-6">
                    <!-- 筛选条件 -->
                    <div class="grid grid-cols-12 gap-4 w-full">
                        <div class="relative col-span-12 md:col-span-3">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                行政区划
                            </label>
                            <div class="relative">
                                <input type="text" id="locationInput" readonly placeholder="请选择地理位置" 
                                       onclick="toggleLocationDropdown()" 
                                       class="w-full h-10 px-3 py-2 pr-8 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 cursor-pointer bg-white">
                                <i class="fas fa-chevron-down absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                                
                                <!-- 级联下拉菜单 -->
                                <div id="locationDropdown" class="absolute top-full left-0 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg z-50 hidden" style="width: 750px; min-width: 750px;">
                                    <div class="flex">
                                        <!-- 省份列表 -->
                                        <div id="provinceList" class="w-1/5 border-r border-gray-200">
                                            <div class="p-2 bg-gray-50 text-sm font-medium text-gray-700 border-b">省份</div>
                                            <div class="max-h-64 overflow-y-auto"></div>
                                        </div>
                                        <!-- 城市列表 -->
                                        <div id="cityList" class="w-1/5 border-r border-gray-200">
                                            <div class="p-2 bg-gray-50 text-sm font-medium text-gray-700 border-b">城市</div>
                                            <div class="max-h-64 overflow-y-auto">
                                                <div class="p-3 text-gray-400 text-sm">请先选择省份</div>
                                            </div>
                                        </div>
                                        <!-- 区县列表 -->
                                        <div id="districtList" class="w-1/5 border-r border-gray-200">
                                            <div class="p-2 bg-gray-50 text-sm font-medium text-gray-700 border-b">区县</div>
                                            <div class="max-h-64 overflow-y-auto">
                                                <div class="p-3 text-gray-400 text-sm">请先选择城市</div>
                                            </div>
                                        </div>
                                        <!-- 街道列表 -->
                                        <div id="streetList" class="w-1/5 border-r border-gray-200">
                                            <div class="p-2 bg-gray-50 text-sm font-medium text-gray-700 border-b">街道</div>
                                            <div class="max-h-64 overflow-y-auto">
                                                <div class="p-3 text-gray-400 text-sm">请先选择区县</div>
                                            </div>
                                        </div>
                                        <!-- 社区列表 -->
                                        <div id="communityList" class="w-1/5">
                                            <div class="p-2 bg-gray-50 text-sm font-medium text-gray-700 border-b">社区</div>
                                            <div class="max-h-64 overflow-y-auto">
                                                <div class="p-3 text-gray-400 text-sm">请先选择街道</div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- 操作按钮 -->
                                    <div class="flex justify-end gap-2 p-3 border-t border-gray-200 bg-gray-50">
                                        <button type="button" onclick="clearLocationSelection()" 
                                                class="px-3 py-1 text-sm text-gray-600 hover:text-gray-800">清空</button>
                                        <button type="button" onclick="confirmLocationSelection()" 
                                                class="px-4 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700">确定</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-span-12 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-2">授权等级</label>
                            <select class="w-full h-10 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option>全部等级</option>
                                <option>基础版</option>
                                <option>标准版</option>
                                <option>高级版</option>
                                <option>企业版</option>
                            </select>
                        </div>
                        <div class="col-span-12 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-2">平台入驻情况</label>
                            <select class="w-full h-10 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option>全部</option>
                                <option>已入驻</option>
                                <option>待入驻</option>
                            </select>
                        </div>
                        <div class="col-span-12 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-2">业委会成立情况</label>
                            <select class="w-full h-10 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option>全部</option>
                                <option>已成立</option>
                                <option>待成立</option>
                            </select>
                        </div>
                         <div class="col-span-12 md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">授权到期时间</label>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <div>
                                    <input type="date" id="expireStartDate"
                                           class="w-full h-10 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                           placeholder="选择开始时间">
                                </div>
                                <div>
                                    <input type="date" id="expireEndDate"
                                           class="w-full h-10 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                           placeholder="选择结束时间">
                                </div>
                            </div>
                        </div>
                        <div class="col-span-12 md:col-span-3" id="community-search-container"></div>
                     </div>
                </div>
            </div>

            <!-- Community Table -->
            <div class="bg-white rounded-lg shadow">

                <div class="table-wrapper">
                    <!-- 可滚动的主表格 -->
                    <div class="scrollable-table">
                        <table class="main-table">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        <input type="checkbox" class="rounded border-gray-300">
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">小区名称</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">小区地址</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">平台入驻情况</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">业委会成立情况</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">物业公司</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">当前授权等级</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">认证户数/总户数</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">注册人数</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">注册时间</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">授权到期时间</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">市场负责人</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">运维</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">状态</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">最后操作人</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">更新时间</th>
                                </tr>
                            </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <input type="checkbox" class="rounded border-gray-300">
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm font-medium text-gray-900">阳光花园</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">北京市朝阳区建国路88号</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 py-1 text-xs font-semibold bg-green-100 text-green-800 rounded-full">已入驻</span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 py-1 text-xs font-semibold bg-blue-100 text-blue-800 rounded-full">已成立</span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">阳光物业管理有限公司</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 py-1 text-xs font-semibold bg-purple-100 text-purple-800 rounded-full">标准版</span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">650/800</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">1,200人</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">2023-12-01</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">2024-12-31</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">张经理</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">李工程师</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div id="community-status-toggle-1"></div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">张经理</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">2024-01-15 14:30</div>
                                </td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <input type="checkbox" class="rounded border-gray-300">
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm font-medium text-gray-900">绿城小区</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">上海市浦东新区世纪大道123号</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 py-1 text-xs font-semibold bg-yellow-100 text-yellow-800 rounded-full">待入驻</span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 py-1 text-xs font-semibold bg-orange-100 text-orange-800 rounded-full">待成立</span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">绿城物业服务集团</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 py-1 text-xs font-semibold bg-blue-100 text-blue-800 rounded-full">专业版</span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">980/1,200</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">1,800人</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">2023-05-15</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">2024-05-31</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">王经理</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">赵工程师</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div id="community-status-toggle-2"></div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">王经理</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">2024-01-10 09:45</div>
                                </td>
                            </tr>
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <input type="checkbox" class="rounded border-gray-300">
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm font-medium text-gray-900">华府豪庭</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">深圳市南山区科技园南区深南大道9999号</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 py-1 text-xs font-semibold bg-green-100 text-green-800 rounded-full">已入驻</span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 py-1 text-xs font-semibold bg-blue-100 text-blue-800 rounded-full">已成立</span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">华府物业管理有限公司</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 py-1 text-xs font-semibold bg-yellow-100 text-yellow-800 rounded-full">企业版</span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">1,350/1,500</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">2,200人</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">2024-02-20</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">2025-02-28</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">陈经理</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">刘工程师</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div id="community-status-toggle-3"></div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">陈经理</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">2024-01-08 16:20</div>
                                </td>
                            </tr>
                        </tbody>
                        </table>
                    </div>
                    
                    <!-- 固定的操作列表格 -->
                    <div class="fixed-column">
                        <table class="fixed-table">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr class="hover:bg-gray-50">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <div class="flex items-center space-x-2">
                                            <button onclick="showCommunityDetail('阳光花园')" class="text-indigo-600 hover:text-indigo-900">详情</button>
                                            <button onclick="openEditModal('阳光花园')" class="text-blue-600 hover:text-blue-900">编辑</button>
                                            <button onclick="openUserListModal('阳光花园')" class="text-green-600 hover:text-green-900">自定义用户清册</button>
                                            <button onclick="openRenewalModal('阳光花园', '高级版', '2024-12-31')" class="text-blue-600 hover:text-blue-900">授权续期</button>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="hover:bg-gray-50">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <div class="flex items-center space-x-2">
                                            <button onclick="showCommunityDetail('绿城小区')" class="text-indigo-600 hover:text-indigo-900">详情</button>
                                            <button onclick="openEditModal('绿城小区')" class="text-blue-600 hover:text-blue-900">编辑</button>
                                            <button onclick="openUserListModal('绿城小区')" class="text-green-600 hover:text-green-900">自定义用户清册</button>
                                            <button onclick="openRenewalModal('绿城小区', '标准版', '2024-05-31')" class="text-blue-600 hover:text-blue-900">授权续期</button>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="hover:bg-gray-50">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <div class="flex items-center space-x-2">
                                            <button onclick="showCommunityDetail('华府豪庭')" class="text-indigo-600 hover:text-indigo-900">详情</button>
                                            <button onclick="openEditModal('华府豪庭')" class="text-blue-600 hover:text-blue-900">编辑</button>
                                            <button onclick="openUserListModal('华府豪庭')" class="text-green-600 hover:text-green-900">自定义用户清册</button>
                                            <button onclick="openRenewalModal('华府豪庭', '企业版', '2025-02-28')" class="text-blue-600 hover:text-blue-900">授权续期</button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                 <div class="px-6 py-4 border-t border-gray-200">
                    <div class="flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4">
                        <!-- 左侧：记录信息和分页条数选择器 -->
                        <div class="flex flex-col sm:flex-row items-start sm:items-center gap-4">
                            <div class="text-sm text-gray-500">
                                显示 <span class="font-medium">1-10</span> 条，共 <span class="font-medium">156</span> 条记录
                            </div>
                            <div class="flex items-center gap-2">
                                <label class="text-sm text-gray-600">每页显示</label>
                                <select class="px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="10" selected>10条</option>
                                    <option value="20">20条</option>
                                    <option value="50">50条</option>
                                    <option value="100">100条</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- 右侧：分页控件 -->
                        <div class="flex flex-col sm:flex-row items-start sm:items-center gap-4">
                            <!-- 页码按钮组 -->
                            <div class="flex items-center space-x-1">
                                <!-- 上一页 -->
                                <button class="px-3 py-1 text-sm text-gray-500 border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                    <i class="fas fa-chevron-left mr-1"></i>上一页
                                </button>
                                
                                <!-- 页码按钮 -->
                                <button class="px-3 py-1 text-sm bg-blue-600 text-white rounded font-medium">1</button>
                                <button class="px-3 py-1 text-sm text-gray-700 border border-gray-300 rounded hover:bg-gray-50">2</button>
                                <button class="px-3 py-1 text-sm text-gray-700 border border-gray-300 rounded hover:bg-gray-50">3</button>
                                <button class="px-3 py-1 text-sm text-gray-700 border border-gray-300 rounded hover:bg-gray-50">4</button>
                                <button class="px-3 py-1 text-sm text-gray-700 border border-gray-300 rounded hover:bg-gray-50">5</button>
                                <span class="px-2 py-1 text-sm text-gray-500">...</span>
                                <button class="px-3 py-1 text-sm text-gray-700 border border-gray-300 rounded hover:bg-gray-50">16</button>
                                
                                <!-- 下一页 -->
                                <button class="px-3 py-1 text-sm text-gray-700 border border-gray-300 rounded hover:bg-gray-50">
                                    下一页<i class="fas fa-chevron-right ml-1"></i>
                                </button>
                            </div>
                            
                            <!-- 页码跳转 -->
                            <div class="flex items-center gap-2">
                                <span class="text-sm text-gray-600">跳转到</span>
                                <input type="number" min="1" max="16" value="1" class="w-16 px-2 py-1 text-sm text-center border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <span class="text-sm text-gray-600">页</span>
                                <button class="px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    确定
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
            </div>
        </main>
    </div>

    <!-- Add Community Modal -->
    <div id="addModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-5xl w-full max-h-screen overflow-y-auto">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 id="modalTitle" class="text-lg font-semibold text-gray-900">添加小区</h3>
                        <button onclick="closeAddModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="p-6">
                    <form class="space-y-6">
                        <!-- 基本信息 -->
                        <div class="border border-gray-200 rounded-lg">
                            <div class="bg-gray-50 px-4 py-3 border-b border-gray-200">
                                <h4 class="text-md font-semibold text-gray-800">
                                    基本信息
                                </h4>
                            </div>
                            <div class="p-4 space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <!-- 小区名称 -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">小区名称 <span class="text-red-500">*</span></label>
                                        <input type="text" id="communityName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入小区名称">
                                    </div>
                                    <!-- 建筑区规划名称 -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">建筑区规划名称</label>
                                        <input type="text" id="planningName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入建筑区规划名称">
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <!-- 建成年代 -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">建成年代</label>
                                        <input type="date" id="buildYear" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <!-- 维修基金金额 -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">维修基金金额（元）</label>
                                        <input type="number" id="maintenanceFund" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入维修基金金额">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 入驻情况 -->
                        <div class="border border-gray-200 rounded-lg">
                            <div class="bg-gray-50 px-4 py-3 border-b border-gray-200">
                                <h4 class="text-md font-semibold text-gray-800">
                                    入驻情况
                                </h4>
                            </div>
                            <div class="p-4 space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <!-- 小区状况 -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">业委会成立情况</label>
                                        <select id="communityStatus" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="">请选择</option>
                                            <option value="已成立业委会">已成立</option>
                                            <option value="未成立业委会">未成立</option>
                                        </select>
                                    </div>
                                    <!-- 平台入驻 -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">平台入驻</label>
                                        <select id="platformStatus" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="">请选择</option>
                                            <option value="已入驻">已入驻</option>
                                            <option value="待入驻">待入驻</option>
                                        </select>
                                    </div>
                                    <!-- 入驻时间 -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">注册时间</label>
                                        <input type="date" id="joinDate" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 位置信息 -->
                        <div class="border border-gray-200 rounded-lg">
                            <div class="bg-gray-50 px-4 py-3 border-b border-gray-200">
                                <h4 class="text-md font-semibold text-gray-800">
                                    位置信息
                                </h4>
                            </div>
                            <div class="p-4 space-y-4">
                                <!-- 行政区划选择器 -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">行政区划</label>
                                    <div class="relative">
                                        <input type="text" id="addLocationInput" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 cursor-pointer" placeholder="请选择省份/城市/区县/街道/社区" readonly onclick="toggleAddLocationDropdown()">
                                        <div class="absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none">
                                            <i class="fas fa-chevron-down text-gray-400"></i>
                                        </div>
                                        
                                        <!-- 添加社区的地理位置下拉框 -->
                                        <div id="addLocationDropdown" class="absolute top-full left-0 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg z-50 hidden" style="width: 1000px; min-width: 1000px;">
                                            <div class="flex">
                                                <!-- 省份列表 -->
                                                <div id="addProvinceList" class="w-1/5 border-r border-gray-200">
                                                    <div class="p-2 bg-gray-50 text-sm font-medium text-gray-700 border-b">省份</div>
                                                    <div class="max-h-64 overflow-y-auto"></div>
                                                </div>
                                                <!-- 城市列表 -->
                                                <div id="addCityList" class="w-1/5 border-r border-gray-200">
                                                    <div class="p-2 bg-gray-50 text-sm font-medium text-gray-700 border-b">城市</div>
                                                    <div class="max-h-64 overflow-y-auto">
                                                        <div class="p-3 text-gray-400 text-sm">请先选择省份</div>
                                                    </div>
                                                </div>
                                                <!-- 区县列表 -->
                                                <div id="addDistrictList" class="w-1/5 border-r border-gray-200">
                                                    <div class="p-2 bg-gray-50 text-sm font-medium text-gray-700 border-b">区县</div>
                                                    <div class="max-h-64 overflow-y-auto">
                                                        <div class="p-3 text-gray-400 text-sm">请先选择城市</div>
                                                    </div>
                                                </div>
                                                <!-- 街道列表 -->
                                                <div id="addStreetList" class="w-1/5 border-r border-gray-200">
                                                    <div class="p-2 bg-gray-50 text-sm font-medium text-gray-700 border-b">街道</div>
                                                    <div class="max-h-64 overflow-y-auto">
                                                        <div class="p-3 text-gray-400 text-sm">请先选择区县</div>
                                                    </div>
                                                </div>
                                                <!-- 社区列表 -->
                                                <div id="addCommunityList" class="w-1/5">
                                                    <div class="p-2 bg-gray-50 text-sm font-medium text-gray-700 border-b">社区</div>
                                                    <div class="max-h-64 overflow-y-auto">
                                                        <div class="p-3 text-gray-400 text-sm">请先选择街道</div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- 操作按钮 -->
                                            <div class="flex justify-end gap-2 p-3 border-t border-gray-200 bg-gray-50">
                                                <button type="button" onclick="clearAddLocationSelection()" 
                                                        class="px-3 py-1 text-sm text-gray-600 hover:text-gray-800">清空</button>
                                                <button type="button" onclick="confirmAddLocationSelection()" 
                                                        class="px-4 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700">确定</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- 坐落地址 -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">小区地址</label>
                                    <input type="text" id="detailAddress" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入详细地址">
                                </div>
                                <!-- 建筑区划范围 -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">建筑区划范围</label>
                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                        <div>
                                            <label class="block text-xs text-gray-600 mb-1">东至</label>
                                            <input type="text" id="eastBoundary" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="东至">
                                        </div>
                                        <div>
                                            <label class="block text-xs text-gray-600 mb-1">南至</label>
                                            <input type="text" id="southBoundary" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="南至">
                                        </div>
                                        <div>
                                            <label class="block text-xs text-gray-600 mb-1">西至</label>
                                            <input type="text" id="westBoundary" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="西至">
                                        </div>
                                        <div>
                                            <label class="block text-xs text-gray-600 mb-1">北至</label>
                                            <input type="text" id="northBoundary" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="北至">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 建筑信息 -->
                        <div class="border border-gray-200 rounded-lg">
                            <div class="bg-gray-50 px-4 py-3 border-b border-gray-200">
                                <h4 class="text-md font-semibold text-gray-800">
                                    建筑信息
                                </h4>
                            </div>
                            <div class="p-4 space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <!-- 总户数 -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">总户数</label>
                                        <input type="number" id="totalHouseholds" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入总户数">
                                    </div>
                                    <!-- 楼栋数 -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">楼栋数</label>
                                        <input type="number" id="buildingCount" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入楼栋数">
                                    </div>
                                    <!-- 总建筑面积 -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">总建筑面积（㎡）</label>
                                        <input type="number" id="totalBuildingArea" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入总建筑面积">
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <!-- 住宅面积 -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">住宅面积（㎡）</label>
                                        <input type="number" id="residentialArea" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入住宅面积">
                                    </div>
                                    <!-- 非住宅面积 -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">非住宅面积（㎡）</label>
                                        <input type="number" id="nonResidentialArea" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入非住宅面积">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 其他信息 -->
                        <div class="border border-gray-200 rounded-lg">
                            <div class="bg-gray-50 px-4 py-3 border-b border-gray-200">
                                <h4 class="text-md font-semibold text-gray-800">
                                    其他信息
                                </h4>
                            </div>
                            <div class="p-4 space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <!-- 容积率 -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">容积率</label>
                                        <input type="number" id="plotRatio" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入容积率">
                                    </div>
                                    <!-- 入住率 -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">入住率（%）</label>
                                        <input type="number" id="occupancyRate" step="0.01" min="0" max="100" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入入住率">
                                    </div>
                                    <!-- 车位配比 -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">车位配比</label>
                                        <input type="text" id="parkingRatio" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="如：1:1.2">
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <!-- 固定车位数 -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">固定车位数</label>
                                        <input type="number" id="fixedParkingSpaces" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入固定车位数">
                                    </div>
                                    <!-- 产权车位数 -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">产权车位数</label>
                                        <input type="number" id="propertyParkingSpaces" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入产权车位数">
                                    </div>
                                    <!-- 人防车位数 -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">人防车位数</label>
                                        <input type="number" id="civilDefenseParkingSpaces" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入人防车位数">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 基础设施 -->
                        <div class="border border-gray-200 rounded-lg">
                            <div class="bg-gray-50 px-4 py-3 border-b border-gray-200">
                                <h4 class="text-md font-semibold text-gray-800">
                                    基础设施
                                </h4>
                            </div>
                            <div class="p-4">
                                <label class="block text-sm font-medium text-gray-700 mb-3">请选择已有的基础设施</label>
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" id="infrastructure_water" value="供水" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                        <span class="text-sm text-gray-700">供水</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" id="infrastructure_electricity" value="供电" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                        <span class="text-sm text-gray-700">供电</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" id="infrastructure_gas" value="供气" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                        <span class="text-sm text-gray-700">供气</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" id="infrastructure_heating" value="供暖" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                        <span class="text-sm text-gray-700">供暖</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" id="infrastructure_broadband" value="宽带" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                        <span class="text-sm text-gray-700">宽带</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" id="infrastructure_ventilation" value="新风" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                        <span class="text-sm text-gray-700">新风</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" id="infrastructure_hotwater" value="热水" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                        <span class="text-sm text-gray-700">热水</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- 原有字段保留 -->
                        <div class="border border-gray-200 rounded-lg">
                            <div class="bg-gray-50 px-4 py-3 border-b border-gray-200">
                                <h4 class="text-md font-semibold text-gray-800">
                                    管理信息
                                </h4>
                            </div>
                            <div class="p-4 space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <!-- 小区联系人 -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">小区联系人</label>
                                        <input type="text" id="communityContact" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入小区联系人">
                                    </div>
                                    <!-- 联系电话 -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">联系电话</label>
                                        <input type="tel" id="contactPhone" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入联系电话">
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <!-- 物业公司 -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">物业公司</label>
                                        <select id="propertyCompany" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="">请选择物业公司</option>
                                            <option value="阳光物业管理有限公司">阳光物业管理有限公司</option>
                                            <option value="绿城物业服务集团">绿城物业服务集团</option>
                                            <option value="万科物业发展股份有限公司">万科物业发展股份有限公司</option>
                                            <option value="保利物业发展股份有限公司">保利物业发展股份有限公司</option>
                                            <option value="华润物业管理有限公司">华润物业管理有限公司</option>
                                            <option value="中海物业管理有限公司">中海物业管理有限公司</option>
                                        </select>
                                    </div>
                                    <!-- 授权等级 -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">授权等级</label>
                                        <select id="authLevel" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="">请选择授权等级</option>
                                            <option value="基础版">基础版</option>
                                            <option value="标准版">标准版</option>
                                            <option value="专业版">专业版</option>
                                            <option value="企业版">企业版</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <!-- 市场负责人 -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">市场负责人</label>
                                        <select id="marketManager" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="">请选择负责人</option>
                                            <option value="张经理">张经理</option>
                                            <option value="王经理">王经理</option>
                                            <option value="李经理">李经理</option>
                                            <option value="陈经理">陈经理</option>
                                        </select>
                                    </div>
                                    <!-- 运维 -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">运维人员</label>
                                        <select id="operationManager" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="">请选择运维人员</option>
                                            <option value="李工程师">李工程师</option>
                                            <option value="赵工程师">赵工程师</option>
                                            <option value="刘工程师">刘工程师</option>
                                            <option value="周工程师">周工程师</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <!-- 小区管理员 -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">小区管理员</label>
                                        <input type="text" id="communityAdmin" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入小区管理员姓名">
                                    </div>
                                    <!-- 管理员联系方式 -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">管理员联系方式</label>
                                        <input type="tel" id="adminContactPhone" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入管理员联系电话">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 附件上传 -->
                        <div class="border border-gray-200 rounded-lg">
                            <div class="bg-gray-50 px-4 py-3 border-b border-gray-200">
                                <h4 class="text-md font-semibold text-gray-800">
                                    附件上传
                                </h4>
                            </div>
                            <div class="p-4">
                                <div id="attachment-upload-container"></div>
                            </div>
                        </div>

                    </form>
                </div>
                <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-3">
                    <button onclick="closeAddModal()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                        取消
                    </button>
                    <button onclick="saveCommunity()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        保存
                    </button>
                </div>
            </div>
        </div>
    </div>



    <!-- 授权续期弹窗 -->
    <div id="renewalModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-screen overflow-y-auto">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-900">授权续期 - <span id="renewalCommunityName"></span></h3>
                        <button onclick="closeRenewalModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- 左侧：授权信息修改 -->
                        <div>
                            <h4 class="text-md font-semibold text-gray-800 mb-4">授权信息修改</h4>
                            <form class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">当前授权等级</label>
                                    <div class="px-3 py-2 bg-gray-100 border border-gray-300 rounded-lg text-gray-600" id="currentAuthLevel"></div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">新授权等级</label>
                                    <select id="newAuthLevel" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="基础版">基础版</option>
                                        <option value="标准版">标准版</option>
                                        <option value="高级版">高级版</option>
                                        <option value="企业版">企业版</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">当前到期时间</label>
                                    <div class="px-3 py-2 bg-gray-100 border border-gray-300 rounded-lg text-gray-600" id="currentExpireDate"></div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">新到期时间</label>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                                        <div>
                                            <input type="date" id="newExpireStartDate" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        </div>
                                        <div>
                                            <input type="date" id="newExpireEndDate" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        </div>
                                    </div>
                                    <div class="flex space-x-2">
                                        <button type="button" onclick="setQuickExpireDateRange(1)" class="px-3 py-1 text-xs bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200 transition-colors">
                                            +1年
                                        </button>
                                        <button type="button" onclick="setQuickExpireDateRange(3)" class="px-3 py-1 text-xs bg-green-100 text-green-700 rounded-md hover:bg-green-200 transition-colors">
                                            +3年
                                        </button>
                                        <button type="button" onclick="setQuickExpireDateRange(5)" class="px-3 py-1 text-xs bg-purple-100 text-purple-700 rounded-md hover:bg-purple-200 transition-colors">
                                            +5年
                                        </button>
                                    </div>
                                </div>
                                <div>
                                     <label class="block text-sm font-medium text-gray-700 mb-2">备注</label>
                                     <textarea id="renewalReason" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="请输入备注信息..."></textarea>
                                 </div>
                            </form>
                        </div>
                        
                        <!-- 右侧：续期记录 -->
                        <div>
                            <h4 class="text-md font-semibold text-gray-800 mb-4">续期记录</h4>
                            <div class="bg-gray-50 rounded-lg p-4 max-h-96 overflow-y-auto">
                                <div id="renewalHistory" class="space-y-3">
                                    <!-- 续期记录将通过JavaScript动态加载 -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-3">
                    <button onclick="closeRenewalModal()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                        取消
                    </button>
                    <button onclick="saveRenewal()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        确认续期
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 自定义用户清册弹窗 - 列配置管理 -->
    <div id="userListModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-gray-900">自定义用户清册 - 列配置管理</h3>
                    <button onclick="closeColumnConfigModal()" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                <div class="p-6 overflow-y-auto max-h-[70vh]">
                    <div class="text-sm text-gray-600 mb-6">
                        自定义表格显示列，可以选择显示哪些列、修改列名称以及调整列的显示顺序。
                    </div>

                    <!-- 列配置区域 -->
                    <div class="bg-gray-50 rounded-lg p-4 mb-6">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="text-md font-medium text-gray-900">可用列配置</h4>
                            <button onclick="addNewColumn()" class="px-3 py-1.5 bg-green-600 text-white rounded-md hover:bg-green-700 flex items-center space-x-1 text-sm">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                                <span>新增列</span>
                            </button>
                        </div>
                        <div id="columnConfigList" class="space-y-3">
                            <!-- 列配置项将通过JavaScript动态生成 -->
                        </div>
                    </div>

                    <!-- 预览区域 -->
                    <div class="mb-6">
                        <h4 class="text-md font-medium text-gray-900 mb-3">预览效果</h4>
                        <div class="border rounded-lg overflow-hidden">
                            <div id="previewTableHeader" class="bg-gray-50 px-4 py-3 border-b">
                                <!-- 预览表头将通过JavaScript动态生成 -->
                            </div>
                            <div class="px-4 py-3 text-sm text-gray-500">
                                表格数据行将按照上述配置显示...
                            </div>
                        </div>
                    </div>
                </div>
                <div class="px-6 py-4 border-t border-gray-200">
                    <div class="flex items-center justify-between">
                        <button onclick="resetColumnConfig()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                            重置为默认
                        </button>
                        <div class="flex items-center space-x-3">
                            <button onclick="closeColumnConfigModal()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                                取消
                            </button>
                            <button onclick="saveColumnConfig()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                保存配置
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 地理位置数据
        const locationData = {
            beijing: {
                name: '北京市',
                cities: {
                    beijing: {
                        name: '北京市',
                        districts: {
                            chaoyang: { name: '朝阳区', streets: ['建国门街道', '朝外街道', '呼家楼街道'] },
                            haidian: { name: '海淀区', streets: ['中关村街道', '学院路街道', '清华园街道'] },
                            dongcheng: { name: '东城区', streets: ['东华门街道', '景山街道', '交道口街道'] }
                        }
                    }
                }
            },
            shanghai: {
                name: '上海市',
                cities: {
                    shanghai: {
                        name: '上海市',
                        districts: {
                            pudong: { name: '浦东新区', streets: ['陆家嘴街道', '周家渡街道', '塘桥街道'] },
                            huangpu: { name: '黄浦区', streets: ['南京东路街道', '外滩街道', '豫园街道'] },
                            xuhui: { name: '徐汇区', streets: ['徐家汇街道', '田林街道', '凌云路街道'] }
                        }
                    }
                }
            },
            guangdong: {
                name: '广东省',
                cities: {
                    guangzhou: {
                        name: '广州市',
                        districts: {
                            tianhe: { name: '天河区', streets: ['珠江新城街道', '天河南街道', '林和街道'] },
                            yuexiu: { name: '越秀区', streets: ['北京街道', '六榕街道', '流花街道'] }
                        }
                    },
                    shenzhen: {
                        name: '深圳市',
                        districts: {
                            futian: { name: '福田区', streets: ['园岭街道', '南园街道', '华富街道'] },
                            nanshan: { name: '南山区', streets: ['南头街道', '沙河街道', '蛇口街道'] }
                        }
                    }
                }
            },
            jiangsu: {
                name: '江苏省',
                cities: {
                    nanjing: {
                        name: '南京市',
                        districts: {
                            xuanwu: { name: '玄武区', streets: ['梅园新村街道', '新街口街道', '玄武门街道'] },
                            qinhuai: { name: '秦淮区', streets: ['五老村街道', '夫子庙街道', '红花街道'] }
                        }
                    },
                    suzhou: {
                        name: '苏州市',
                        districts: {
                            gusu: { name: '姑苏区', streets: ['沧浪街道', '双塔街道', '胥江街道'] },
                            xiangcheng: { name: '相城区', streets: ['元和街道', '太平街道', '黄桥街道'] }
                        }
                    }
                }
            },
            zhejiang: {
                name: '浙江省',
                cities: {
                    hangzhou: {
                        name: '杭州市',
                        districts: {
                            xihu: { name: '西湖区', streets: ['北山街道', '西溪街道', '灵隐街道'] },
                            shangcheng: { name: '上城区', streets: ['清波街道', '湖滨街道', '小营街道'] }
                        }
                    },
                    ningbo: {
                        name: '宁波市',
                        districts: {
                            haishu: { name: '海曙区', streets: ['南门街道', '江厦街道', '鼓楼街道'] },
                            jiangbei: { name: '江北区', streets: ['中马街道', '白沙街道', '孔浦街道'] }
                        }
                    }
                }
            }
        };

        // 初始化页面
        document.addEventListener('DOMContentLoaded', function() {
            initPage('community');
        });

        // 旧的selectedLocation变量已删除，使用currentLocationSelection

        // 旧的地理位置选择器系统已删除，使用新的regionData系统

        // 级联选择器数据
        const regionData = {
            beijing: {
                name: '北京市',
                cities: {
                    beijing: {
                        name: '北京市',
                        districts: {
                            chaoyang: {
                                name: '朝阳区',
                                streets: {
                                    jianguomen: { name: '建国门街道', communities: { community1: '建国门社区', community2: '国贸社区' } },
                                    sanlitun: { name: '三里屯街道', communities: { community3: '三里屯社区', community4: '工体社区' } }
                                }
                            },
                            haidian: {
                                name: '海淀区',
                                streets: {
                                    zhongguancun: { name: '中关村街道', communities: { community5: '中关村社区', community6: '科技园社区' } },
                                    wudaokou: { name: '五道口街道', communities: { community7: '五道口社区', community8: '清华园社区' } }
                                }
                            }
                        }
                    }
                }
            },
            shanghai: {
                name: '上海市',
                cities: {
                    shanghai: {
                        name: '上海市',
                        districts: {
                            huangpu: {
                                name: '黄浦区',
                                streets: {
                                    nanjingdong: { name: '南京东路街道', communities: { community9: '南京路社区', community10: '外滩社区' } },
                                    yuyuan: { name: '豫园街道', communities: { community11: '豫园社区', community12: '城隍庙社区' } }
                                }
                            },
                            pudong: {
                                name: '浦东新区',
                                streets: {
                                    lujiazui: { name: '陆家嘴街道', communities: { community13: '陆家嘴社区', community14: '金融城社区' } },
                                    zhangjiang: { name: '张江镇', communities: { community15: '张江社区', community16: '高科技园区社区' } }
                                }
                            }
                        }
                    }
                }
            },
            guangdong: {
                name: '广东省',
                cities: {
                    guangzhou: {
                        name: '广州市',
                        districts: {
                            tianhe: {
                                name: '天河区',
                                streets: {
                                    zhujiang: { name: '珠江新城街道', communities: { community17: '珠江新城社区', community18: 'CBD社区' } },
                                    shipai: { name: '石牌街道', communities: { community19: '石牌社区', community20: '华师社区' } }
                                }
                            },
                            yuexiu: {
                                name: '越秀区',
                                streets: {
                                    beijing: { name: '北京街道', communities: { community21: '北京路社区', community22: '中山路社区' } }
                                }
                            }
                        }
                    },
                    shenzhen: {
                        name: '深圳市',
                        districts: {
                            futian: {
                                name: '福田区',
                                streets: {
                                    huaqiangbei: { name: '华强北街道', communities: { community23: '华强北社区', community24: '电子市场社区' } }
                                }
                            }
                        }
                    }
                }
            },
            jiangsu: {
                name: '江苏省',
                cities: {
                    nanjing: {
                        name: '南京市',
                        districts: {
                            xuanwu: {
                                name: '玄武区',
                                streets: {
                                    xinjiekou: { name: '新街口街道', communities: { community25: '新街口社区', community26: '商业中心社区' } }
                                }
                            }
                        }
                    }
                }
            },
            zhejiang: {
                name: '浙江省',
                cities: {
                    hangzhou: {
                        name: '杭州市',
                        districts: {
                            xihu: {
                                name: '西湖区',
                                streets: {
                                    xihu: { name: '西湖街道', communities: { community27: '西湖社区', community28: '断桥社区' } }
                                }
                            }
                        }
                    }
                }
            }
        };

        // 当前选择的地理位置信息
        let currentLocationSelection = {
            province: null,
            city: null,
            district: null,
            street: null,
            community: null
        };

        /**
         * 切换地理位置选择器的显示/隐藏
         */
        function toggleLocationSelector() {
            const selector = document.getElementById('locationSelector');
            const isHidden = selector.classList.contains('hidden');
            
            if (isHidden) {
                selector.classList.remove('hidden');
                initializeLocationSelector();
            } else {
                selector.classList.add('hidden');
            }
        }

        /**
         * 初始化地理位置选择器
         */
        function initializeLocationSelector() {
            loadProvinceList();
        }

        /**
         * 加载省份列表
         */
        function loadProvinceList() {
            const provinceList = document.getElementById('provinceList').querySelector('.max-h-64');
            
            if (!provinceList) {
                console.error('找不到provinceList元素');
                return;
            }
            
            provinceList.innerHTML = '';
            
            Object.keys(regionData).forEach(provinceKey => {
                const provinceItem = document.createElement('div');
                provinceItem.className = 'p-3 hover:bg-blue-50 cursor-pointer text-sm border-b border-gray-100 last:border-b-0';
                provinceItem.textContent = regionData[provinceKey].name;
                provinceItem.dataset.key = provinceKey;
                
                // 如果当前已选择该省份，添加选中样式
                if (currentLocationSelection.province?.key === provinceKey) {
                    provinceItem.classList.add('bg-blue-100', 'text-blue-700');
                }
                
                provinceItem.addEventListener('click', function() {
                    selectProvince(provinceKey, regionData[provinceKey].name);
                });
                
                provinceList.appendChild(provinceItem);
            });
        }

        /**
         * 选择省份
         */
        function selectProvince(provinceKey, provinceName) {
            currentLocationSelection.province = { key: provinceKey, name: provinceName };
            currentLocationSelection.city = null;
            currentLocationSelection.district = null;
            currentLocationSelection.street = null;
            currentLocationSelection.community = null;
            
            // 更新省份列表的选中状态
            updateSelectedState('provinceList', provinceKey);
            
            // 加载城市列表
            loadCityList(provinceKey);
            
            // 清空下级列表
            clearDistrictList();
            clearStreetList();
            clearCommunityList();
        }

        /**
         * 加载城市列表
         */
        function loadCityList(provinceKey) {
            const cityList = document.getElementById('cityList').querySelector('.max-h-64');
            cityList.innerHTML = '';
            
            if (regionData[provinceKey] && regionData[provinceKey].cities) {
                Object.keys(regionData[provinceKey].cities).forEach(cityKey => {
                    const cityItem = document.createElement('div');
                    cityItem.className = 'p-3 hover:bg-blue-50 cursor-pointer text-sm border-b border-gray-100 last:border-b-0';
                    cityItem.textContent = regionData[provinceKey].cities[cityKey].name;
                    cityItem.dataset.key = cityKey;
                    
                    // 如果当前已选择该城市，添加选中样式
                    if (currentLocationSelection.city?.key === cityKey) {
                        cityItem.classList.add('bg-blue-100', 'text-blue-700');
                    }
                    
                    cityItem.addEventListener('click', function() {
                        selectCity(provinceKey, cityKey, regionData[provinceKey].cities[cityKey].name);
                    });
                    
                    cityList.appendChild(cityItem);
                });
            } else {
                cityList.innerHTML = '<div class="p-3 text-gray-400 text-sm">暂无城市数据</div>';
            }
        }

        /**
         * 选择城市
         */
        function selectCity(provinceKey, cityKey, cityName) {
            currentLocationSelection.city = { key: cityKey, name: cityName };
            currentLocationSelection.district = null;
            currentLocationSelection.street = null;
            currentLocationSelection.community = null;
            
            // 更新城市列表的选中状态
            updateSelectedState('cityList', cityKey);
            
            // 加载区县列表
            loadDistrictList(provinceKey, cityKey);
            
            // 清空下级列表
            clearStreetList();
            clearCommunityList();
        }

        /**
         * 加载区县列表
         */
        function loadDistrictList(provinceKey, cityKey) {
            const districtList = document.getElementById('districtList').querySelector('.max-h-64');
            districtList.innerHTML = '';
            
            if (regionData[provinceKey]?.cities[cityKey]?.districts) {
                Object.keys(regionData[provinceKey].cities[cityKey].districts).forEach(districtKey => {
                    const districtItem = document.createElement('div');
                    districtItem.className = 'p-3 hover:bg-blue-50 cursor-pointer text-sm border-b border-gray-100 last:border-b-0';
                    districtItem.textContent = regionData[provinceKey].cities[cityKey].districts[districtKey].name;
                    districtItem.dataset.key = districtKey;
                    
                    // 如果当前已选择该区县，添加选中样式
                    if (currentLocationSelection.district?.key === districtKey) {
                        districtItem.classList.add('bg-blue-100', 'text-blue-700');
                    }
                    
                    districtItem.addEventListener('click', function() {
                        selectDistrict(provinceKey, cityKey, districtKey, regionData[provinceKey].cities[cityKey].districts[districtKey].name);
                    });
                    
                    districtList.appendChild(districtItem);
                });
            } else {
                districtList.innerHTML = '<div class="p-3 text-gray-400 text-sm">暂无区县数据</div>';
            }
        }

        /**
         * 选择区县
         */
        function selectDistrict(provinceKey, cityKey, districtKey, districtName) {
            currentLocationSelection.district = { key: districtKey, name: districtName };
            currentLocationSelection.street = null;
            currentLocationSelection.community = null;
            
            // 更新区县列表的选中状态
            updateSelectedState('districtList', districtKey);
            
            // 加载街道列表
            loadStreetList(provinceKey, cityKey, districtKey);
            
            // 清空社区列表
            clearCommunityList();
        }

        /**
         * 加载街道列表
         */
        function loadStreetList(provinceKey, cityKey, districtKey) {
            const streetList = document.getElementById('streetList').querySelector('.max-h-64');
            streetList.innerHTML = '';
            
            if (regionData[provinceKey]?.cities[cityKey]?.districts[districtKey]?.streets) {
                Object.keys(regionData[provinceKey].cities[cityKey].districts[districtKey].streets).forEach(streetKey => {
                    const streetItem = document.createElement('div');
                    streetItem.className = 'p-3 hover:bg-blue-50 cursor-pointer text-sm border-b border-gray-100 last:border-b-0';
                    streetItem.textContent = regionData[provinceKey].cities[cityKey].districts[districtKey].streets[streetKey].name;
                    streetItem.dataset.key = streetKey;
                    
                    // 如果当前已选择该街道，添加选中样式
                    if (currentLocationSelection.street?.key === streetKey) {
                        streetItem.classList.add('bg-blue-100', 'text-blue-700');
                    }
                    
                    streetItem.addEventListener('click', function() {
                        selectStreet(provinceKey, cityKey, districtKey, streetKey, regionData[provinceKey].cities[cityKey].districts[districtKey].streets[streetKey].name);
                    });
                    
                    streetList.appendChild(streetItem);
                });
            } else {
                streetList.innerHTML = '<div class="p-3 text-gray-400 text-sm">暂无街道数据</div>';
            }
        }

        /**
         * 选择街道
         */
        function selectStreet(provinceKey, cityKey, districtKey, streetKey, streetName) {
            currentLocationSelection.street = { key: streetKey, name: streetName };
            currentLocationSelection.community = null;
            
            // 更新街道列表的选中状态
            updateSelectedState('streetList', streetKey);
            
            // 加载社区列表
            loadCommunityList(provinceKey, cityKey, districtKey, streetKey);
        }

        /**
         * 加载社区列表
         */
        function loadCommunityList(provinceKey, cityKey, districtKey, streetKey) {
            const communityList = document.getElementById('communityList').querySelector('.max-h-64');
            communityList.innerHTML = '';
            
            if (regionData[provinceKey]?.cities[cityKey]?.districts[districtKey]?.streets[streetKey]?.communities) {
                const communities = regionData[provinceKey].cities[cityKey].districts[districtKey].streets[streetKey].communities;
                Object.keys(communities).forEach(communityKey => {
                    const communityItem = document.createElement('div');
                    communityItem.className = 'p-3 hover:bg-blue-50 cursor-pointer text-sm border-b border-gray-100 last:border-b-0';
                    communityItem.textContent = communities[communityKey];
                    communityItem.dataset.key = communityKey;
                    
                    // 如果当前已选择该社区，添加选中样式
                    if (currentLocationSelection.community?.key === communityKey) {
                        communityItem.classList.add('bg-blue-100', 'text-blue-700');
                    }
                    
                    communityItem.addEventListener('click', function() {
                        selectCommunity(communityKey, communities[communityKey]);
                    });
                    
                    communityList.appendChild(communityItem);
                });
            } else {
                communityList.innerHTML = '<div class="p-3 text-gray-400 text-sm">暂无社区数据</div>';
            }
        }

        /**
         * 选择社区
         */
        function selectCommunity(communityKey, communityName) {
            currentLocationSelection.community = { key: communityKey, name: communityName };
            
            // 更新社区列表的选中状态
            updateSelectedState('communityList', communityKey);
        }

        /**
         * 更新选中状态
         */
        function updateSelectedState(listId, selectedKey) {
            const list = document.getElementById(listId);
            const items = list.querySelectorAll('div[data-key]');
            
            items.forEach(item => {
                item.classList.remove('bg-blue-100', 'text-blue-700');
                if (item.dataset.key === selectedKey) {
                    item.classList.add('bg-blue-100', 'text-blue-700');
                }
            });
        }

        /**
         * 清空区县列表
         */
        function clearDistrictList() {
            document.getElementById('districtList').querySelector('.max-h-64').innerHTML = '<div class="p-3 text-gray-400 text-sm">请先选择城市</div>';
        }

        /**
         * 清空街道列表
         */
        function clearStreetList() {
            document.getElementById('streetList').querySelector('.max-h-64').innerHTML = '<div class="p-3 text-gray-400 text-sm">请先选择区县</div>';
        }

        /**
         * 清空社区列表
         */
        function clearCommunityList() {
            document.getElementById('communityList').querySelector('.max-h-64').innerHTML = '<div class="p-3 text-gray-400 text-sm">请先选择街道</div>';
        }

        /**
         * 切换地理位置下拉选择器显示状态
         */
        function toggleLocationDropdown() {
            const locationDropdown = document.getElementById('locationDropdown');
            
            if (!locationDropdown) {
                console.error('找不到locationDropdown元素');
                return;
            }
            
            if (locationDropdown.classList.contains('hidden')) {
                locationDropdown.classList.remove('hidden');
                locationDropdown.style.display = 'block';
                // 初始化省份列表
                loadProvinceList();
            } else {
                locationDropdown.classList.add('hidden');
                locationDropdown.style.display = 'none';
            }
        }

        /**
         * 清空地理位置选择
         */
        function clearLocationSelection() {
            currentLocationSelection = {
                province: null,
                city: null,
                district: null,
                street: null,
                community: null
            };
            
            document.getElementById('locationInput').value = '';
            
            // 重置所有列表
            loadProvinceList();
            document.getElementById('cityList').querySelector('.max-h-64').innerHTML = '<div class="p-3 text-gray-400 text-sm">请先选择省份</div>';
            clearDistrictList();
            clearStreetList();
            clearCommunityList();
            
            // 隐藏下拉框
            const locationDropdown = document.getElementById('locationDropdown');
            locationDropdown.classList.add('hidden');
            locationDropdown.style.display = 'none';
        }

        /**
         * 确认地理位置选择
         */
        function confirmLocationSelection() {
            let locationText = '';
            const parts = [];
            
            if (currentLocationSelection.province) parts.push(currentLocationSelection.province.name);
            if (currentLocationSelection.city) parts.push(currentLocationSelection.city.name);
            if (currentLocationSelection.district) parts.push(currentLocationSelection.district.name);
            if (currentLocationSelection.street) parts.push(currentLocationSelection.street.name);
            if (currentLocationSelection.community) parts.push(currentLocationSelection.community.name);
            
            locationText = parts.join(' / ');
            
            document.getElementById('locationInput').value = locationText;
            const locationDropdown = document.getElementById('locationDropdown');
            locationDropdown.classList.add('hidden');
            locationDropdown.style.display = 'none';
        }

        // 添加社区表单的地理位置选择器相关变量
        let addLocationSelection = {
            province: null,
            city: null,
            district: null,
            street: null,
            community: null
        };

        /**
         * 切换添加社区表单的地理位置下拉选择器显示状态
         */
        function toggleAddLocationDropdown() {
            const addLocationDropdown = document.getElementById('addLocationDropdown');
            
            if (addLocationDropdown.classList.contains('hidden')) {
                addLocationDropdown.classList.remove('hidden');
                addLocationDropdown.style.display = 'block';
                // 初始化省份列表
                loadAddProvinceList();
            } else {
                addLocationDropdown.classList.add('hidden');
                addLocationDropdown.style.display = 'none';
            }
        }

        /**
         * 加载添加表单的省份列表
         */
        function loadAddProvinceList() {
            const provinceList = document.getElementById('addProvinceList').querySelector('.max-h-64');
            provinceList.innerHTML = '';
            
            Object.keys(regionData).forEach(provinceKey => {
                const provinceItem = document.createElement('div');
                provinceItem.className = 'p-3 hover:bg-blue-50 cursor-pointer text-sm border-b border-gray-100 last:border-b-0';
                provinceItem.textContent = regionData[provinceKey].name;
                provinceItem.dataset.key = provinceKey;
                
                if (addLocationSelection.province?.key === provinceKey) {
                    provinceItem.classList.add('bg-blue-100', 'text-blue-700');
                }
                
                provinceItem.addEventListener('click', function() {
                    selectAddProvince(provinceKey, regionData[provinceKey].name);
                });
                
                provinceList.appendChild(provinceItem);
            });
        }

        /**
         * 选择添加表单的省份
         */
        function selectAddProvince(provinceKey, provinceName) {
            addLocationSelection.province = { key: provinceKey, name: provinceName };
            addLocationSelection.city = null;
            addLocationSelection.district = null;
            addLocationSelection.street = null;
            addLocationSelection.community = null;
            
            updateAddSelectedState('addProvinceList', provinceKey);
            loadAddCityList(provinceKey);
            clearAddDistrictList();
            clearAddStreetList();
            clearAddCommunityList();
        }

        /**
         * 加载添加表单的城市列表
         */
        function loadAddCityList(provinceKey) {
            const cityList = document.getElementById('addCityList').querySelector('.max-h-64');
            cityList.innerHTML = '';
            
            if (regionData[provinceKey] && regionData[provinceKey].cities) {
                Object.keys(regionData[provinceKey].cities).forEach(cityKey => {
                    const cityItem = document.createElement('div');
                    cityItem.className = 'p-3 hover:bg-blue-50 cursor-pointer text-sm border-b border-gray-100 last:border-b-0';
                    cityItem.textContent = regionData[provinceKey].cities[cityKey].name;
                    cityItem.dataset.key = cityKey;
                    
                    if (addLocationSelection.city?.key === cityKey) {
                        cityItem.classList.add('bg-blue-100', 'text-blue-700');
                    }
                    
                    cityItem.addEventListener('click', function() {
                        selectAddCity(provinceKey, cityKey, regionData[provinceKey].cities[cityKey].name);
                    });
                    
                    cityList.appendChild(cityItem);
                });
            } else {
                cityList.innerHTML = '<div class="p-3 text-gray-400 text-sm">暂无城市数据</div>';
            }
        }

        /**
         * 选择添加表单的城市
         */
        function selectAddCity(provinceKey, cityKey, cityName) {
            addLocationSelection.city = { key: cityKey, name: cityName };
            addLocationSelection.district = null;
            addLocationSelection.street = null;
            addLocationSelection.community = null;
            
            updateAddSelectedState('addCityList', cityKey);
            loadAddDistrictList(provinceKey, cityKey);
            clearAddStreetList();
            clearAddCommunityList();
        }

        /**
         * 加载添加表单的区县列表
         */
        function loadAddDistrictList(provinceKey, cityKey) {
            const districtList = document.getElementById('addDistrictList').querySelector('.max-h-64');
            districtList.innerHTML = '';
            
            if (regionData[provinceKey]?.cities[cityKey]?.districts) {
                Object.keys(regionData[provinceKey].cities[cityKey].districts).forEach(districtKey => {
                    const districtItem = document.createElement('div');
                    districtItem.className = 'p-3 hover:bg-blue-50 cursor-pointer text-sm border-b border-gray-100 last:border-b-0';
                    districtItem.textContent = regionData[provinceKey].cities[cityKey].districts[districtKey].name;
                    districtItem.dataset.key = districtKey;
                    
                    if (addLocationSelection.district?.key === districtKey) {
                        districtItem.classList.add('bg-blue-100', 'text-blue-700');
                    }
                    
                    districtItem.addEventListener('click', function() {
                        selectAddDistrict(provinceKey, cityKey, districtKey, regionData[provinceKey].cities[cityKey].districts[districtKey].name);
                    });
                    
                    districtList.appendChild(districtItem);
                });
            } else {
                districtList.innerHTML = '<div class="p-3 text-gray-400 text-sm">暂无区县数据</div>';
            }
        }

        /**
         * 选择添加表单的区县
         */
        function selectAddDistrict(provinceKey, cityKey, districtKey, districtName) {
            addLocationSelection.district = { key: districtKey, name: districtName };
            addLocationSelection.street = null;
            addLocationSelection.community = null;
            
            updateAddSelectedState('addDistrictList', districtKey);
            loadAddStreetList(provinceKey, cityKey, districtKey);
            clearAddCommunityList();
        }

        /**
         * 加载添加表单的街道列表
         */
        function loadAddStreetList(provinceKey, cityKey, districtKey) {
            const streetList = document.getElementById('addStreetList').querySelector('.max-h-64');
            streetList.innerHTML = '';
            
            if (regionData[provinceKey]?.cities[cityKey]?.districts[districtKey]?.streets) {
                Object.keys(regionData[provinceKey].cities[cityKey].districts[districtKey].streets).forEach(streetKey => {
                    const streetItem = document.createElement('div');
                    streetItem.className = 'p-3 hover:bg-blue-50 cursor-pointer text-sm border-b border-gray-100 last:border-b-0';
                    streetItem.textContent = regionData[provinceKey].cities[cityKey].districts[districtKey].streets[streetKey].name;
                    streetItem.dataset.key = streetKey;
                    
                    if (addLocationSelection.street?.key === streetKey) {
                        streetItem.classList.add('bg-blue-100', 'text-blue-700');
                    }
                    
                    streetItem.addEventListener('click', function() {
                        selectAddStreet(provinceKey, cityKey, districtKey, streetKey, regionData[provinceKey].cities[cityKey].districts[districtKey].streets[streetKey].name);
                    });
                    
                    streetList.appendChild(streetItem);
                });
            } else {
                streetList.innerHTML = '<div class="p-3 text-gray-400 text-sm">暂无街道数据</div>';
            }
        }

        /**
         * 选择添加表单的街道
         */
        function selectAddStreet(provinceKey, cityKey, districtKey, streetKey, streetName) {
            addLocationSelection.street = { key: streetKey, name: streetName };
            addLocationSelection.community = null;
            
            updateAddSelectedState('addStreetList', streetKey);
            loadAddCommunityList(provinceKey, cityKey, districtKey, streetKey);
        }

        /**
         * 加载添加表单的社区列表
         */
        function loadAddCommunityList(provinceKey, cityKey, districtKey, streetKey) {
            const communityList = document.getElementById('addCommunityList').querySelector('.max-h-64');
            communityList.innerHTML = '';
            
            if (regionData[provinceKey]?.cities[cityKey]?.districts[districtKey]?.streets[streetKey]?.communities) {
                Object.keys(regionData[provinceKey].cities[cityKey].districts[districtKey].streets[streetKey].communities).forEach(communityKey => {
                    const communityItem = document.createElement('div');
                    communityItem.className = 'p-3 hover:bg-blue-50 cursor-pointer text-sm border-b border-gray-100 last:border-b-0';
                    communityItem.textContent = regionData[provinceKey].cities[cityKey].districts[districtKey].streets[streetKey].communities[communityKey];
                    communityItem.dataset.key = communityKey;
                    
                    if (addLocationSelection.community?.key === communityKey) {
                        communityItem.classList.add('bg-blue-100', 'text-blue-700');
                    }
                    
                    communityItem.addEventListener('click', function() {
                        selectAddCommunity(communityKey, regionData[provinceKey].cities[cityKey].districts[districtKey].streets[streetKey].communities[communityKey]);
                    });
                    
                    communityList.appendChild(communityItem);
                });
            } else {
                communityList.innerHTML = '<div class="p-3 text-gray-400 text-sm">暂无社区数据</div>';
            }
        }

        /**
         * 选择添加表单的社区
         */
        function selectAddCommunity(communityKey, communityName) {
            addLocationSelection.community = { key: communityKey, name: communityName };
            updateAddSelectedState('addCommunityList', communityKey);
        }

        /**
         * 更新添加表单选中状态
         */
        function updateAddSelectedState(listId, selectedKey) {
            const list = document.getElementById(listId).querySelector('.max-h-64');
            const items = list.querySelectorAll('div[data-key]');
            
            items.forEach(item => {
                item.classList.remove('bg-blue-100', 'text-blue-700');
                if (item.dataset.key === selectedKey) {
                    item.classList.add('bg-blue-100', 'text-blue-700');
                }
            });
        }

        /**
         * 清空添加表单的区县列表
         */
        function clearAddDistrictList() {
            document.getElementById('addDistrictList').querySelector('.max-h-64').innerHTML = '<div class="p-3 text-gray-400 text-sm">请先选择城市</div>';
        }

        /**
         * 清空添加表单的街道列表
         */
        function clearAddStreetList() {
            document.getElementById('addStreetList').querySelector('.max-h-64').innerHTML = '<div class="p-3 text-gray-400 text-sm">请先选择区县</div>';
        }

        /**
         * 清空添加表单的社区列表
         */
        function clearAddCommunityList() {
            document.getElementById('addCommunityList').querySelector('.max-h-64').innerHTML = '<div class="p-3 text-gray-400 text-sm">请先选择街道</div>';
        }

        /**
         * 清空添加表单的地理位置选择
         */
        function clearAddLocationSelection() {
            addLocationSelection = {
                province: null,
                city: null,
                district: null,
                street: null,
                community: null
            };
            
            document.getElementById('addLocationInput').value = '';
            
            // 重置所有列表
            loadAddProvinceList();
            document.getElementById('addCityList').querySelector('.max-h-64').innerHTML = '<div class="p-3 text-gray-400 text-sm">请先选择省份</div>';
            clearAddDistrictList();
            clearAddStreetList();
            clearAddCommunityList();
            
            // 隐藏下拉框
            const addLocationDropdown = document.getElementById('addLocationDropdown');
            addLocationDropdown.classList.add('hidden');
            addLocationDropdown.style.display = 'none';
        }

        /**
         * 确认添加表单的地理位置选择
         */
        function confirmAddLocationSelection() {
            let locationText = '';
            const parts = [];
            
            if (addLocationSelection.province) parts.push(addLocationSelection.province.name);
            if (addLocationSelection.city) parts.push(addLocationSelection.city.name);
            if (addLocationSelection.district) parts.push(addLocationSelection.district.name);
            if (addLocationSelection.street) parts.push(addLocationSelection.street.name);
            if (addLocationSelection.community) parts.push(addLocationSelection.community.name);
            
            locationText = parts.join(' / ');
            
            document.getElementById('addLocationInput').value = locationText;
            const addLocationDropdown = document.getElementById('addLocationDropdown');
            addLocationDropdown.classList.add('hidden');
            addLocationDropdown.style.display = 'none';
        }

        // 点击其他地方关闭选择器
        document.addEventListener('click', function(event) {
            const locationDropdown = document.getElementById('locationDropdown');
            const locationInput = document.getElementById('locationInput');
            const addLocationDropdown = document.getElementById('addLocationDropdown');
            const addLocationInput = document.getElementById('addLocationInput');
            
            // 关闭筛选条件的地理位置下拉框
            if (locationDropdown && !locationDropdown.classList.contains('hidden') && 
                !locationDropdown.contains(event.target) && event.target !== locationInput) {
                locationDropdown.classList.add('hidden');
                locationDropdown.style.display = 'none';
            }
            
            // 关闭添加表单的地理位置下拉框
            if (addLocationDropdown && !addLocationDropdown.classList.contains('hidden') && 
                !addLocationDropdown.contains(event.target) && event.target !== addLocationInput) {
                addLocationDropdown.classList.add('hidden');
                addLocationDropdown.style.display = 'none';
            }
        });

        // 模态框控制
        function openAddModal() {
            document.getElementById('addModal').classList.remove('hidden');
            
            // 设置为新增模式标题
            document.getElementById('modalTitle').textContent = '添加小区';
            
            // 清空所有表单数据
            clearFormData();
            
            // 初始化附件上传组件
            initAttachmentUpload();
        }

        /**
         * 清空表单数据
         */
        function clearFormData() {
            // 清空基本信息
            const basicFields = [
                'communityName', 'communityCode', 'detailAddress', 'totalArea', 
                'buildingCount', 'householdCount', 'contactPhone', 'propertyCompany',
                'marketManager', 'operationManager', 'authLevel'
            ];
            
            basicFields.forEach(fieldId => {
                const element = document.getElementById(fieldId);
                if (element) element.value = '';
            });
            
            // 清空新增字段
            const newFields = [
                'joinDate', 'planningName', 'buildYear', 'maintenanceFund',
                'totalBuildingArea', 'residentialArea', 'nonResidentialArea',
                'plotRatio', 'occupancyRate', 'parkingRatio', 'fixedParkingSpaces',
                'propertyParkingSpaces', 'civilDefenseParkingSpaces', 'communityContact'
            ];
            
            newFields.forEach(fieldId => {
                const element = document.getElementById(fieldId);
                if (element) element.value = '';
            });
            
            // 清空下拉框
            const selectFields = ['platformStatus', 'communityStatus'];
            selectFields.forEach(fieldId => {
                const element = document.getElementById(fieldId);
                if (element) element.selectedIndex = 0;
            });
            
            // 清空基础设施复选框
            const infrastructureCheckboxes = document.querySelectorAll('input[name="infrastructure"]');
            infrastructureCheckboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            
            // 清空文本域
            const textareaFields = document.querySelectorAll('#addModal textarea');
            textareaFields.forEach(textarea => {
                textarea.value = '';
            });
        }

        function closeAddModal() {
            document.getElementById('addModal').classList.add('hidden');
            // 重置模态框标题为添加模式
            document.getElementById('modalTitle').textContent = '添加小区';
            // 清空表单数据
            document.getElementById('communityName').value = '';
            document.getElementById('authLevel').value = '';
            document.getElementById('detailAddress').value = '';
            document.getElementById('totalArea').value = '';
            document.getElementById('buildingCount').value = '';
            document.getElementById('householdCount').value = '';
            document.getElementById('contactPhone').value = '';
            document.getElementById('propertyCompany').value = '';
            document.getElementById('marketManager').value = '';
            document.getElementById('operationManager').value = '';
            document.getElementById('communityAdmin').value = '';
            document.getElementById('adminContactPhone').value = '';
            
            // 清空附件上传组件
            if (window.communityAttachmentUpload) {
                window.communityAttachmentUpload.clearFiles();
            }
        }

        /**
         * 初始化附件上传组件
         */
        function initAttachmentUpload() {
            // 检查是否已经初始化过
            if (window.communityAttachmentUpload) {
                return;
            }
            
            // 创建附件上传组件实例
            window.communityAttachmentUpload = new AttachmentUpload('attachment-upload-container', {
                maxFileSize: 20 * 1024 * 1024, // 20MB
                maxFiles: 10,
                allowedTypes: ['.pdf', '.doc', '.docx', '.xls', '.xlsx', 'WPS'],
                onChange: function(files) {
                    console.log('附件列表变化:', files);
                }
            });
            
            // 为了兼容组件内部的删除按钮，也将实例存储到组件期望的位置
            window[`attachmentUpload_attachment-upload-container`] = window.communityAttachmentUpload;
        }

        /**
         * 打开编辑小区弹窗
         * @param {string} communityName - 小区名称
         */
        function openEditModal(communityName) {
            // 复用添加模态框，设置为编辑模式
            document.getElementById('addModal').classList.remove('hidden');
            document.getElementById('modalTitle').textContent = '编辑小区';
            
            // 根据小区名称加载对应的数据
            loadCommunityData(communityName);
        }



        /**
         * 加载小区数据到编辑表单
         * @param {string} communityName - 小区名称
         */
        function loadCommunityData(communityName) {
            // 模拟小区数据
            const communityData = {
                '阳光花园': {
                    name: '阳光花园',
                    code: 'YG001',
                    province: '北京市',
                    city: '北京市',
                    district: '朝阳区',
                    address: '朝阳区建国门外大街1号',
                    totalArea: 50000,
                    buildingCount: 12,
                    householdCount: 800,
                    contactPhone: '010-12345678',
                    propertyCompany: '阳光物业管理有限公司',
                    marketManager: '张经理',
                    operationManager: '李工程师',
                    communityAdmin: '王管理员',
                    adminContactPhone: '13800138001',
                    totalHouseholds: 800,
                    verifiedHouseholds: 650,
                    registeredUsers: 1200,
                    authLevel: '标准版',
                    // 新增字段
                    platformStatus: '已入驻',
                    communityStatus: '已成立业委会',
                    joinDate: '2023-03-15',
                    planningName: '阳光花园住宅区',
                    buildYear: '2018-06-01',
                    maintenanceFund: 2500000,
                    totalBuildingArea: 45000,
                    residentialArea: 38000,
                    nonResidentialArea: 7000,
                    plotRatio: 2.5,
                    occupancyRate: 85.5,
                    parkingRatio: '1:1.2',
                    fixedParkingSpaces: 600,
                    propertyParkingSpaces: 400,
                    civilDefenseParkingSpaces: 200,
                    communityContact: '张主任',
                    infrastructure: ['供水', '供电', '供气', '宽带']
                },
                '绿城小区': {
                    name: '绿城小区',
                    code: 'LC002',
                    province: '上海市',
                    city: '上海市',
                    district: '浦东新区',
                    address: '浦东新区世纪大道100号',
                    totalArea: 80000,
                    buildingCount: 20,
                    householdCount: 1200,
                    contactPhone: '021-87654321',
                    propertyCompany: '绿城物业服务集团',
                    marketManager: '王经理',
                    operationManager: '赵工程师',
                    communityAdmin: '李管理员',
                    adminContactPhone: '13900139002',
                    totalHouseholds: 1200,
                    verifiedHouseholds: 980,
                    registeredUsers: 1800,
                    authLevel: '专业版',
                    // 新增字段
                    platformStatus: '待入驻',
                    communityStatus: '未成立业委会',
                    joinDate: '2023-08-20',
                    planningName: '绿城现代住宅小区',
                    buildYear: '2020-09-15',
                    maintenanceFund: 4200000,
                    totalBuildingArea: 75000,
                    residentialArea: 65000,
                    nonResidentialArea: 10000,
                    plotRatio: 3.2,
                    occupancyRate: 92.3,
                    parkingRatio: '1:1.5',
                    fixedParkingSpaces: 900,
                    propertyParkingSpaces: 600,
                    civilDefenseParkingSpaces: 300,
                    communityContact: '李经理',
                    infrastructure: ['供水', '供电', '供气', '供暖', '宽带', '新风']
                },
                '华府豪庭': {
                    name: '华府豪庭',
                    code: 'HF003',
                    province: '广东省',
                    city: '深圳市',
                    district: '南山区',
                    address: '南山区科技园南区深南大道9999号',
                    totalArea: 120000,
                    buildingCount: 30,
                    householdCount: 1500,
                    contactPhone: '0755-88888888',
                    propertyCompany: '华府物业管理有限公司',
                    marketManager: '陈经理',
                    operationManager: '刘工程师',
                    communityAdmin: '张管理员',
                    adminContactPhone: '13700137003',
                    totalHouseholds: 1500,
                    verifiedHouseholds: 1350,
                    registeredUsers: 2200,
                    authLevel: '企业版',
                    // 新增字段
                    platformStatus: '已入驻',
                    communityStatus: '已成立业委会',
                    joinDate: '2022-12-10',
                    planningName: '华府豪庭高端住宅区',
                    buildYear: '2019-03-20',
                    maintenanceFund: 6800000,
                    totalBuildingArea: 110000,
                    residentialArea: 95000,
                    nonResidentialArea: 15000,
                    plotRatio: 2.8,
                    occupancyRate: 96.7,
                    parkingRatio: '1:1.8',
                    fixedParkingSpaces: 1200,
                    propertyParkingSpaces: 800,
                    civilDefenseParkingSpaces: 400,
                    communityContact: '王总监',
                    infrastructure: ['供水', '供电', '供气', '供暖', '宽带', '新风', '热水']
                }
            };
            
            const data = communityData[communityName];
            if (data) {
                // 填充表单数据
                const communityNameInput = document.getElementById('communityName');
                if (communityNameInput) communityNameInput.value = data.name;
                
                const authLevelSelect = document.getElementById('authLevel');
                if (authLevelSelect) authLevelSelect.value = data.authLevel;
                
                const detailAddressInput = document.getElementById('detailAddress');
                if (detailAddressInput) detailAddressInput.value = data.address;
                
                const totalAreaInput = document.getElementById('totalArea');
                if (totalAreaInput) totalAreaInput.value = data.totalArea;
                
                const buildingCountInput = document.getElementById('buildingCount');
                if (buildingCountInput) buildingCountInput.value = data.buildingCount;
                
                const householdCountInput = document.getElementById('householdCount');
                if (householdCountInput) householdCountInput.value = data.householdCount;
                
                const contactPhoneInput = document.getElementById('contactPhone');
                if (contactPhoneInput) contactPhoneInput.value = data.contactPhone;
                
                const propertyCompanySelect = document.getElementById('propertyCompany');
                if (propertyCompanySelect) propertyCompanySelect.value = data.propertyCompany;
                
                const marketManagerSelect = document.getElementById('marketManager');
                if (marketManagerSelect) marketManagerSelect.value = data.marketManager;
                
                const operationManagerSelect = document.getElementById('operationManager');
                if (operationManagerSelect) operationManagerSelect.value = data.operationManager;
                
                const communityAdminInput = document.getElementById('communityAdmin');
                if (communityAdminInput) communityAdminInput.value = data.communityAdmin;
                
                const adminContactPhoneInput = document.getElementById('adminContactPhone');
                if (adminContactPhoneInput) adminContactPhoneInput.value = data.adminContactPhone;
                
                // 填充新增字段
                // 平台入驻情况
                const platformStatusSelect = document.getElementById('platformStatus');
                if (platformStatusSelect && data.platformStatus) {
                    platformStatusSelect.value = data.platformStatus;
                }
                
                // 小区情况
                const communityStatusSelect = document.getElementById('communityStatus');
                if (communityStatusSelect && data.communityStatus) {
                    communityStatusSelect.value = data.communityStatus;
                }
                
                // 入驻时间
                const joinDateInput = document.getElementById('joinDate');
                if (joinDateInput && data.joinDate) {
                    joinDateInput.value = data.joinDate;
                }
                
                // 规划名称
                const planningNameInput = document.getElementById('planningName');
                if (planningNameInput && data.planningName) {
                    planningNameInput.value = data.planningName;
                }
                
                // 建成年份
                const buildYearInput = document.getElementById('buildYear');
                if (buildYearInput && data.buildYear) {
                    buildYearInput.value = data.buildYear;
                }
                
                // 维修基金
                const maintenanceFundInput = document.getElementById('maintenanceFund');
                if (maintenanceFundInput && data.maintenanceFund) {
                    maintenanceFundInput.value = data.maintenanceFund;
                }
                
                // 总建筑面积
                const totalBuildingAreaInput = document.getElementById('totalBuildingArea');
                if (totalBuildingAreaInput && data.totalBuildingArea) {
                    totalBuildingAreaInput.value = data.totalBuildingArea;
                }
                
                // 住宅面积
                const residentialAreaInput = document.getElementById('residentialArea');
                if (residentialAreaInput && data.residentialArea) {
                    residentialAreaInput.value = data.residentialArea;
                }
                
                // 非住宅面积
                const nonResidentialAreaInput = document.getElementById('nonResidentialArea');
                if (nonResidentialAreaInput && data.nonResidentialArea) {
                    nonResidentialAreaInput.value = data.nonResidentialArea;
                }
                
                // 容积率
                const plotRatioInput = document.getElementById('plotRatio');
                if (plotRatioInput && data.plotRatio) {
                    plotRatioInput.value = data.plotRatio;
                }
                
                // 入住率
                const occupancyRateInput = document.getElementById('occupancyRate');
                if (occupancyRateInput && data.occupancyRate) {
                    occupancyRateInput.value = data.occupancyRate;
                }
                
                // 车位配比
                const parkingRatioInput = document.getElementById('parkingRatio');
                if (parkingRatioInput && data.parkingRatio) {
                    parkingRatioInput.value = data.parkingRatio;
                }
                
                // 固定车位
                const fixedParkingInput = document.getElementById('fixedParking');
                if (fixedParkingInput && data.fixedParkingSpaces) {
                    fixedParkingInput.value = data.fixedParkingSpaces;
                }
                
                // 产权车位
                const propertyParkingInput = document.getElementById('propertyParking');
                if (propertyParkingInput && data.propertyParkingSpaces) {
                    propertyParkingInput.value = data.propertyParkingSpaces;
                }
                
                // 人防车位
                const civilDefenseParkingInput = document.getElementById('civilDefenseParking');
                if (civilDefenseParkingInput && data.civilDefenseParkingSpaces) {
                    civilDefenseParkingInput.value = data.civilDefenseParkingSpaces;
                }
                
                // 社区联系人
                const communityContactInput = document.getElementById('communityContact');
                if (communityContactInput && data.communityContact) {
                    communityContactInput.value = data.communityContact;
                }
                
                // 设置基础设施复选框
                if (data.infrastructure && Array.isArray(data.infrastructure)) {
                    // 先清除所有复选框
                    const infrastructureCheckboxes = document.querySelectorAll('input[name="infrastructure"]');
                    infrastructureCheckboxes.forEach(checkbox => {
                        checkbox.checked = false;
                    });
                    
                    // 根据数据设置对应的复选框
                    data.infrastructure.forEach(item => {
                        const checkbox = document.querySelector(`input[name="infrastructure"][value="${item}"]`);
                        if (checkbox) {
                            checkbox.checked = true;
                        }
                    });
                }
                
                // 设置地理位置三级联动
                // 这里需要根据实际的地理位置数据来设置省市区
                // 暂时先设置省份，然后触发级联更新
                setTimeout(() => {
                    // 可以在这里添加地理位置的设置逻辑
                    // 由于地理位置联选器比较复杂，暂时跳过
                    console.log('地理位置数据:', data.province, data.city, data.district);
                }, 100);
            }
        }



        // 授权续期相关函数
        function openRenewalModal(communityName, currentLevel, currentExpireDate) {
            document.getElementById('renewalModal').classList.remove('hidden');
            document.getElementById('renewalCommunityName').textContent = communityName;
            document.getElementById('currentAuthLevel').textContent = currentLevel;
            document.getElementById('currentExpireDate').textContent = currentExpireDate;
            document.getElementById('newAuthLevel').value = currentLevel;
            
            // 设置默认的新到期时间范围
            const today = new Date();
            const nextYear = new Date();
            nextYear.setFullYear(nextYear.getFullYear() + 1);
            
            // 开始时间设为今天，结束时间设为一年后
            document.getElementById('newExpireStartDate').value = today.toISOString().split('T')[0];
            document.getElementById('newExpireEndDate').value = nextYear.toISOString().split('T')[0];
            
            // 加载续期记录
            loadRenewalHistory(communityName);
        }

        function closeRenewalModal() {
            document.getElementById('renewalModal').classList.add('hidden');
            // 清空表单
            document.getElementById('renewalReason').value = '';
        }

        // 快捷设置到期时间范围函数
        function setQuickExpireDateRange(years) {
            const currentExpireDate = document.getElementById('currentExpireDate').textContent;
            const currentDate = new Date(currentExpireDate);
            
            // 如果当前到期时间无效，则从今天开始计算
            if (isNaN(currentDate.getTime())) {
                currentDate = new Date();
            }
            
            // 设置开始时间为当前到期时间
            document.getElementById('newExpireStartDate').value = currentDate.toISOString().split('T')[0];
            
            // 设置结束时间为当前时间加上指定年数
            const endDate = new Date(currentDate);
            endDate.setFullYear(endDate.getFullYear() + years);
            document.getElementById('newExpireEndDate').value = endDate.toISOString().split('T')[0];
        }

        function saveRenewal() {
            const communityName = document.getElementById('renewalCommunityName').textContent;
            const newLevel = document.getElementById('newAuthLevel').value;
            const newExpireStartDate = document.getElementById('newExpireStartDate').value;
            const newExpireEndDate = document.getElementById('newExpireEndDate').value;
            const reason = document.getElementById('renewalReason').value;
            
            if (!newExpireStartDate || !newExpireEndDate) {
                alert('请选择新的到期时间范围');
                return;
            }
            
            // 验证开始时间不能晚于结束时间
            if (new Date(newExpireStartDate) > new Date(newExpireEndDate)) {
                alert('开始时间不能晚于结束时间');
                return;
            }
            
            if (!reason.trim()) {
                alert('请输入备注信息');
                return;
            }
            
            // 这里应该调用后端API保存续期信息
            console.log('保存续期信息:', {
                community: communityName,
                newLevel: newLevel,
                newExpireStartDate: newExpireStartDate,
                newExpireEndDate: newExpireEndDate,
                reason: reason
            });
            
            alert('授权续期成功！');
            closeRenewalModal();
            
            // 刷新页面数据（实际项目中应该调用API刷新）
            location.reload();
        }

        function loadRenewalHistory(communityName) {
            // 模拟续期记录数据
            const historyData = {
                '阳光花园': [
                    { date: '2024-01-15', fromLevel: '标准版', toLevel: '高级版', operator: '管理员', reason: '小区规模扩大，需要更多功能' },
                    { date: '2023-12-01', fromLevel: '基础版', toLevel: '标准版', operator: '系统管理员', reason: '初次升级' }
                ],
                '绿城小区': [
                    { date: '2023-11-20', fromLevel: '基础版', toLevel: '标准版', operator: '管理员', reason: '业务需求增加' }
                ],
                '华府豪庭': [
                    { date: '2024-02-20', fromLevel: '高级版', toLevel: '企业版', operator: '超级管理员', reason: '大型社区，需要企业级功能' }
                ]
            };
            
            const history = historyData[communityName] || [];
            const historyContainer = document.getElementById('renewalHistory');
            
            if (history.length === 0) {
                historyContainer.innerHTML = '<div class="text-gray-500 text-center py-4">暂无续期记录</div>';
                return;
            }
            
            historyContainer.innerHTML = history.map(record => `
                <div class="bg-white rounded-lg p-3 border border-gray-200">
                    <div class="flex justify-between items-start mb-2">
                        <div class="text-sm font-medium text-gray-900">${record.fromLevel} → ${record.toLevel}</div>
                        <div class="text-xs text-gray-500">${record.date}</div>
                    </div>
                    <div class="text-xs text-gray-600 mb-1">操作人：${record.operator}</div>
                    <div class="text-xs text-gray-600">原因：${record.reason}</div>
                </div>
            `).join('');
        }

        // 自定义用户清册 - 列配置管理相关函数
        let columnConfig = [
            { key: 'communityName', name: '小区名称', visible: true, order: 1, isDefault: true },
            { key: 'address', name: '地址', visible: true, order: 2, isDefault: true },
            { key: 'building', name: '楼栋', visible: true, order: 3, isDefault: true },
            { key: 'unit', name: '单元', visible: true, order: 4, isDefault: true },
            { key: 'roomNumber', name: '房号', visible: true, order: 5, isDefault: true },
            { key: 'area', name: '面积', visible: true, order: 6, isDefault: true },
            { key: 'propertyType', name: '产权类型', visible: true, order: 7, isDefault: true },
            { key: 'ownerName', name: '产权人姓名', visible: true, order: 8, isDefault: true },
            { key: 'gender', name: '性别', visible: true, order: 9, isDefault: true },
            { key: 'phone', name: '电话', visible: true, order: 10, isDefault: true },
            { key: 'idCard', name: '身份证', visible: true, order: 11, isDefault: true }
        ];

        /**
         * 打开列配置管理弹窗
         * @param {string} communityName - 小区名称（用于上下文显示）
         */
        function openUserListModal(communityName) {
            document.getElementById('userListModal').classList.remove('hidden');
            loadColumnConfig();
            renderColumnConfigList();
            updatePreview();
        }

        /**
         * 关闭列配置管理弹窗
         */
        function closeColumnConfigModal() {
            document.getElementById('userListModal').classList.add('hidden');
        }

        /**
         * 加载列配置（从本地存储或使用默认配置）
         */
        function loadColumnConfig() {
            const savedConfig = localStorage.getItem('communityTableColumnConfig');
            if (savedConfig) {
                columnConfig = JSON.parse(savedConfig);
            }
            // 确保配置按order排序
            columnConfig.sort((a, b) => a.order - b.order);
        }

        /**
          * 渲染列配置列表
          */
         function renderColumnConfigList() {
             const container = document.getElementById('columnConfigList');
             container.innerHTML = columnConfig.map((column, index) => {
                 // 如果是临时编辑状态的列
                 if (column.isTemp) {
                     return `
                         <div class="flex items-center justify-between p-3 bg-blue-50 rounded border-2 border-blue-200" data-column-key="${column.key}">
                             <div class="flex items-center space-x-3">
                                 <input type="checkbox" checked disabled
                                        class="rounded border-gray-300 opacity-50">
                                 <input type="text" value="${column.name}" 
                                        data-temp-key="${column.key}"
                                        placeholder="请输入列名称"
                                        onkeydown="handleTempColumnKeydown(event, '${column.key}')"
                                        onblur="handleTempColumnBlur('${column.key}', this.value)"
                                        class="px-2 py-1 border-2 border-blue-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                             </div>
                             <div class="flex items-center space-x-2">
                                 <button onclick="confirmAddColumn('${column.key}', document.querySelector('[data-temp-key=\"${column.key}\"]').value)" 
                                         class="p-1 text-green-600 hover:text-green-800" title="确认添加">
                                     <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                     </svg>
                                 </button>
                                 <button onclick="cancelAddColumn()" 
                                         class="p-1 text-red-600 hover:text-red-800" title="取消添加">
                                     <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                     </svg>
                                 </button>
                             </div>
                         </div>
                     `;
                 }
                 
                 // 正常列的渲染
                 return `
                     <div class="flex items-center justify-between p-3 bg-white rounded border" data-column-key="${column.key}">
                         <div class="flex items-center space-x-3">
                             <input type="checkbox" ${column.visible ? 'checked' : ''} 
                                    onchange="toggleColumnVisibility('${column.key}')" 
                                    class="rounded border-gray-300">
                             <input type="text" value="${column.name}" 
                                    onchange="updateColumnName('${column.key}', this.value)"
                                    class="px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-1 focus:ring-blue-500">
                         </div>
                         <div class="flex items-center space-x-2">
                             <button onclick="moveColumnUp(${index})" 
                                     ${index === 0 ? 'disabled' : ''}
                                     class="p-1 text-gray-400 hover:text-gray-600 disabled:opacity-30">
                                 <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                                 </svg>
                             </button>
                             <button onclick="moveColumnDown(${index})" 
                                     ${index === columnConfig.length - 1 ? 'disabled' : ''}
                                     class="p-1 text-gray-400 hover:text-gray-600 disabled:opacity-30">
                                 <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                 </svg>
                             </button>
                             <button onclick="${column.isDefault ? '' : `deleteColumn('${column.key}')`}" 
                                     ${column.isDefault ? 'disabled' : ''}
                                     class="p-1 ${column.isDefault ? 'text-gray-300 cursor-not-allowed' : 'text-red-400 hover:text-red-600'}">
                                 <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                 </svg>
                             </button>
                         </div>
                     </div>
                 `;
             }).join('');
         }

        /**
         * 切换列的显示状态
         * @param {string} columnKey - 列的键值
         */
        function toggleColumnVisibility(columnKey) {
            const column = columnConfig.find(col => col.key === columnKey);
            if (column) {
                column.visible = !column.visible;
                updatePreview();
            }
        }

        /**
         * 更新列名称
         * @param {string} columnKey - 列的键值
         * @param {string} newName - 新的列名称
         */
        function updateColumnName(columnKey, newName) {
            const column = columnConfig.find(col => col.key === columnKey);
            if (column) {
                column.name = newName;
                updatePreview();
            }
        }

        /**
         * 向上移动列
         * @param {number} index - 当前列的索引
         */
        function moveColumnUp(index) {
            if (index > 0) {
                // 交换order值
                const temp = columnConfig[index].order;
                columnConfig[index].order = columnConfig[index - 1].order;
                columnConfig[index - 1].order = temp;
                
                // 重新排序并渲染
                columnConfig.sort((a, b) => a.order - b.order);
                renderColumnConfigList();
                updatePreview();
            }
        }

        /**
         * 向下移动列
         * @param {number} index - 当前列的索引
         */
        function moveColumnDown(index) {
            if (index < columnConfig.length - 1) {
                // 交换order值
                const temp = columnConfig[index].order;
                columnConfig[index].order = columnConfig[index + 1].order;
                columnConfig[index + 1].order = temp;
                
                // 重新排序并渲染
                columnConfig.sort((a, b) => a.order - b.order);
                renderColumnConfigList();
                updatePreview();
            }
        }

        /**
         * 更新市场负责人
         * @param {HTMLSelectElement} selectElement - 下拉选择元素
         * @param {string} communityName - 小区名称
         */
        function updateMarketManager(selectElement, communityName) {
            const newValue = selectElement.value;
            console.log(`更新${communityName}的市场负责人为: ${newValue}`);
            
            // 这里可以添加实际的更新逻辑，比如发送API请求
            // 模拟成功提示
            showNotification(`${communityName}的市场负责人已更新为${newValue}`, 'success');
        }

        /**
         * 更新运维人员
         * @param {HTMLSelectElement} selectElement - 下拉选择元素
         * @param {string} communityName - 小区名称
         */
        function updateOperator(selectElement, communityName) {
            const newValue = selectElement.value;
            console.log(`更新${communityName}的运维人员为: ${newValue}`);
            
            // 这里可以添加实际的更新逻辑，比如发送API请求
            // 模拟成功提示
            showNotification(`${communityName}的运维人员已更新为${newValue}`, 'success');
        }

        /**
         * 切换状态下拉菜单显示/隐藏
         * @param {HTMLElement} statusElement - 状态标签元素
         * @param {string} communityName - 小区名称
         */
        function toggleStatusDropdown(statusElement, communityName) {
            const dropdown = statusElement.nextElementSibling;
            const allDropdowns = document.querySelectorAll('.absolute.bg-white');
            
            // 隐藏其他所有下拉菜单
            allDropdowns.forEach(dd => {
                if (dd !== dropdown) {
                    dd.classList.add('hidden');
                }
            });
            
            // 切换当前下拉菜单
            dropdown.classList.toggle('hidden');
        }
        
        /**
         * 更改状态
         * @param {HTMLElement} optionElement - 选项元素
         * @param {string} communityName - 小区名称
         * @param {string} newStatus - 新状态
         * @param {string} statusClass - 状态样式类
         */
        function changeStatus(optionElement, communityName, newStatus, statusClass) {
            const statusSpan = optionElement.closest('td').querySelector('span');
            const dropdown = optionElement.closest('.absolute');
            
            // 更新状态显示
            statusSpan.textContent = newStatus;
            statusSpan.className = `px-2 py-1 text-xs font-semibold ${statusClass} rounded-full cursor-pointer`;
            statusSpan.setAttribute('data-current-status', newStatus);
            
            // 隐藏下拉菜单
            dropdown.classList.add('hidden');
            
            console.log(`更新${communityName}的状态为: ${newStatus}`);
            
            // 这里可以添加实际的更新逻辑，比如发送API请求
            // 模拟成功提示
            showNotification(`${communityName}的状态已更新为${newStatus}`, 'success');
        }

        /**
         * 显示通知消息
         * @param {string} message - 消息内容
         * @param {string} type - 消息类型 (success, error, warning)
         */
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-yellow-500';
            
            notification.className = `fixed top-4 right-4 ${bgColor} text-white px-4 py-2 rounded shadow-lg z-50`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // 3秒后自动移除
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }
        
        // 点击页面其他地方时隐藏所有下拉菜单
        document.addEventListener('click', function(event) {
            const isStatusClick = event.target.closest('span[data-current-status]') || event.target.closest('.absolute.bg-white');
            if (!isStatusClick) {
                const allDropdowns = document.querySelectorAll('.absolute.bg-white');
                allDropdowns.forEach(dropdown => {
                    dropdown.classList.add('hidden');
                });
            }
        });

        /**
         * 更新预览效果
         */
        function updatePreview() {
            const previewContainer = document.getElementById('previewTableHeader');
            const visibleColumns = columnConfig.filter(col => col.visible);
            
            // 创建表格预览
            previewContainer.innerHTML = `
                <table class="min-w-full">
                    <thead>
                        <tr class="bg-gray-100">
                            ${visibleColumns.map(col => 
                                `<th class="px-3 py-2 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-r border-gray-200 last:border-r-0">${col.name}</th>`
                            ).join('')}
                        </tr>
                    </thead>
                    <tbody>
                        <!-- 空表格，无数据行 -->
                    </tbody>
                </table>
            `;
        }

        /**
          * 重置为默认配置
          */
         function resetColumnConfig() {
             columnConfig = [
                 { key: 'communityName', name: '小区名称', visible: true, order: 1, isDefault: true },
                 { key: 'address', name: '地址', visible: true, order: 2, isDefault: true },
                 { key: 'building', name: '楼栋', visible: true, order: 3, isDefault: true },
                 { key: 'unit', name: '单元', visible: true, order: 4, isDefault: true },
                 { key: 'roomNumber', name: '房号', visible: true, order: 5, isDefault: true },
                 { key: 'area', name: '面积', visible: true, order: 6, isDefault: true },
                 { key: 'propertyType', name: '产权类型', visible: true, order: 7, isDefault: true },
                 { key: 'ownerName', name: '产权人姓名', visible: true, order: 8, isDefault: true },
                 { key: 'gender', name: '性别', visible: true, order: 9, isDefault: true },
                 { key: 'phone', name: '电话', visible: true, order: 10, isDefault: true },
                 { key: 'idCard', name: '身份证', visible: true, order: 11, isDefault: true }
             ];
             renderColumnConfigList();
             updatePreview();
         }

        /**
         * 保存列配置
         */
        function saveColumnConfig() {
            // 保存到本地存储
            localStorage.setItem('communityTableColumnConfig', JSON.stringify(columnConfig));
            
            // 应用配置到实际表格
            applyColumnConfigToTable();
            
            alert('列配置已保存并应用到表格！');
            closeColumnConfigModal();
        }

        /**
          * 将列配置应用到实际表格
          */
         function applyColumnConfigToTable() {
             const table = document.querySelector('.min-w-full.divide-y.divide-gray-200');
             if (!table) return;
             
             const thead = table.querySelector('thead tr');
             const tbody = table.querySelector('tbody');
             
             // 获取可见列
             const visibleColumns = columnConfig.filter(col => col.visible);
             
             // 重新生成表头
             thead.innerHTML = visibleColumns.map(col => {
                 return `<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">${col.name}</th>`;
             }).join('');
             
             // 重新生成表格数据行（这里需要根据实际数据结构调整）
             // 由于这是演示，我们只更新表头，实际项目中需要重新渲染数据行
             console.log('表格列配置已应用，可见列：', visibleColumns.map(col => col.name));
         }

         // 临时编辑状态管理
         let isAddingNewColumn = false;
         let tempColumnKey = null;

         /**
          * 新增列 - 直接在列表底部添加输入行
          */
         function addNewColumn() {
             // 如果已经在添加状态，则不重复添加
             if (isAddingNewColumn) {
                 return;
             }
             
             // 生成唯一的临时key
             tempColumnKey = 'temp_' + Date.now();
             const maxOrder = Math.max(...columnConfig.map(col => col.order));
             
             // 创建临时新列配置
             const tempColumn = {
                 key: tempColumnKey,
                 name: '',
                 visible: true,
                 order: maxOrder + 1,
                 isCustom: true,
                 isDefault: false,
                 isTemp: true // 标记为临时状态
             };
             
             columnConfig.push(tempColumn);
             isAddingNewColumn = true;
             
             renderColumnConfigList();
             
             // 延迟聚焦到输入框
             setTimeout(() => {
                 const tempInput = document.querySelector(`input[data-temp-key="${tempColumnKey}"]`);
                 if (tempInput) {
                     tempInput.focus();
                     tempInput.select();
                 }
             }, 100);
         }

         /**
          * 确认添加新列
          * @param {string} columnKey - 列的键值
          * @param {string} columnName - 列名称
          */
         function confirmAddColumn(columnKey, columnName) {
             if (!columnName || columnName.trim() === '') {
                 cancelAddColumn();
                 return;
             }
             
             // 找到临时列并更新为正式列
             const column = columnConfig.find(col => col.key === columnKey);
             if (column) {
                 column.name = columnName.trim();
                 column.isTemp = false;
                 column.key = 'custom_' + Date.now(); // 生成正式的key
             }
             
             isAddingNewColumn = false;
             tempColumnKey = null;
             
             renderColumnConfigList();
             updatePreview();
         }

         /**
           * 取消添加新列
           */
          function cancelAddColumn() {
              if (tempColumnKey) {
                  // 移除临时列
                  columnConfig = columnConfig.filter(col => col.key !== tempColumnKey);
              }
              
              isAddingNewColumn = false;
              tempColumnKey = null;
              
              renderColumnConfigList();
          }

          /**
           * 处理临时列输入框的键盘事件
           * @param {KeyboardEvent} event - 键盘事件
           * @param {string} columnKey - 列的键值
           */
          function handleTempColumnKeydown(event, columnKey) {
              if (event.key === 'Enter') {
                  event.preventDefault();
                  const inputValue = event.target.value;
                  confirmAddColumn(columnKey, inputValue);
              } else if (event.key === 'Escape') {
                  event.preventDefault();
                  cancelAddColumn();
              }
          }

          /**
           * 处理临时列输入框失焦事件
           * @param {string} columnKey - 列的键值
           * @param {string} inputValue - 输入值
           */
          function handleTempColumnBlur(columnKey, inputValue) {
              // 延迟处理，避免与按钮点击事件冲突
              setTimeout(() => {
                  if (isAddingNewColumn && tempColumnKey === columnKey) {
                      if (inputValue && inputValue.trim() !== '') {
                          confirmAddColumn(columnKey, inputValue);
                      } else {
                          cancelAddColumn();
                      }
                  }
              }, 150);
          }

         /**
          * 删除列
          * @param {string} columnKey - 要删除的列的键值
          */
         function deleteColumn(columnKey) {
             const column = columnConfig.find(col => col.key === columnKey);
             if (!column) return;
             
             if (confirm(`确定要删除列 "${column.name}" 吗？`)) {
                 // 从配置中移除该列
                 columnConfig = columnConfig.filter(col => col.key !== columnKey);
                 
                 // 重新调整order值，确保连续性
                 columnConfig.forEach((col, index) => {
                     col.order = index + 1;
                 });
                 
                 renderColumnConfigList();
                 updatePreview();
             }
         }

        /**
         * 保存小区信息（添加或编辑）
         */
        function saveCommunity() {
            // 获取表单数据
            const formData = {
                name: document.getElementById('communityName').value,
                authLevel: document.getElementById('authLevel').value,
                detailAddress: document.getElementById('detailAddress').value,
                totalArea: document.getElementById('totalArea').value,
                buildingCount: document.getElementById('buildingCount').value,
                householdCount: document.getElementById('householdCount').value,
                contactPhone: document.getElementById('contactPhone').value,
                propertyCompany: document.getElementById('propertyCompany').value,
                marketManager: document.getElementById('marketManager').value,
                operationManager: document.getElementById('operationManager').value,
                communityAdmin: document.getElementById('communityAdmin').value,
                adminContactPhone: document.getElementById('adminContactPhone').value
            };
            
            // 获取附件数据
            if (window.communityAttachmentUpload) {
                formData.attachments = window.communityAttachmentUpload.getFiles();
            }
            
            // 基本验证
            if (!formData.name.trim()) {
                alert('请输入小区名称');
                return;
            }
            
            if (!formData.authLevel) {
                alert('请选择授权等级');
                return;
            }
            
            // 判断是添加还是编辑模式
            const modalTitle = document.getElementById('modalTitle').textContent;
            const isEditMode = modalTitle === '编辑小区';
            
            // 这里应该调用后端API保存数据
            console.log(isEditMode ? '保存小区编辑信息:' : '保存新增小区信息:', formData);
            
            alert(isEditMode ? '小区信息修改成功！' : '小区添加成功！');
            closeAddModal();
            
            // 刷新页面数据（实际项目中应该调用API刷新）
            location.reload();
        }

        // 初始化搜索组件
        let communitySearchComponent;
        
        /**
         * 页面加载完成后初始化搜索组件
         */
        document.addEventListener('DOMContentLoaded', function() {
            // 创建搜索组件实例
            communitySearchComponent = new SearchComponent({
                containerId: 'community-search-container',
                placeholder: '小区名/地址/负责人/运维人',
                label: '搜索',
                onSearch: function(searchValue) {
                    console.log('搜索小区:', searchValue);
                    // 这里可以添加实际的搜索逻辑
                    // 例如：filterCommunityList(searchValue);
                    if (searchValue) {
                        alert(`正在搜索: ${searchValue}`);
                    }
                },
                onReset: function() {
                    console.log('重置小区搜索');
                    // 这里可以添加实际的重置逻辑
                    // 例如：resetCommunityList();
                    alert('已重置搜索条件');
                }
            });
        });
        
        /**
         * 获取当前搜索值（供其他函数调用）
         * @returns {string} 当前搜索关键词
         */
        function getCurrentSearchValue() {
            return communitySearchComponent ? communitySearchComponent.getValue() : '';
        }
        
        /**
         * 设置搜索值（供其他函数调用）
         * @param {string} value 要设置的搜索值
         */
        function setSearchValue(value) {
            if (communitySearchComponent) {
                communitySearchComponent.setValue(value);
            }
        }
        
        /**
         * 显示小区详情
         * @param {string} communityName 小区名称
         */
        function showCommunityDetail(communityName) {
            // 模拟小区详情数据
            const communityDetails = {
                '阳光花园': {
                    name: '阳光花园',
                    address: '北京市朝阳区阳光街123号',
                    platformStatus: '已入驻',
                    communityStatus: '已成立业委会',
                    propertyCompany: '阳光物业管理有限公司',
                    contact: '张经理',
                    contractDate: '2023-01-15',
                    updateTime: '2024-01-15 14:30',
                    buildingYear: '2018年',
                    totalHouseholds: '1200户',
                    buildingCount: '8栋',
                    totalArea: '150000㎡',
                    occupancyRate: '95%',
                    parkingRatio: '1:1.2',
                    authLevel: '标准版'
                },
                '绿城小区': {
                    name: '绿城小区',
                    address: '上海市浦东新区绿城路456号',
                    platformStatus: '待入驻',
                    communityStatus: '待成立业委会',
                    propertyCompany: '绿城物业服务集团',
                    contact: '李经理',
                    contractDate: '2023-03-20',
                    updateTime: '2024-01-10 09:45',
                    buildingYear: '2020年',
                    totalHouseholds: '800户',
                    buildingCount: '6栋',
                    totalArea: '120000㎡',
                    occupancyRate: '88%',
                    parkingRatio: '1:1.0',
                    authLevel: '专业版'
                },
                '华府豪庭': {
                    name: '华府豪庭',
                    address: '广州市天河区华府路789号',
                    platformStatus: '已入驻',
                    communityStatus: '已成立业委会',
                    propertyCompany: '华府物业管理公司',
                    contact: '陈经理',
                    contractDate: '2023-06-10',
                    updateTime: '2024-01-08 16:20',
                    buildingYear: '2019年',
                    totalHouseholds: '600户',
                    buildingCount: '4栋',
                    totalArea: '80000㎡',
                    occupancyRate: '92%',
                    parkingRatio: '1:1.5',
                    authLevel: '企业版'
                }
            };
            
            const detail = communityDetails[communityName];
            if (!detail) {
                alert('未找到该小区的详细信息');
                return;
            }
            
            // 创建详情弹窗内容
            const modalContent = `
                <div class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50" id="communityDetailModal">
                    <div class="relative top-10 mx-auto p-6 border w-11/12 md:w-4/5 lg:w-3/4 xl:w-2/3 shadow-lg rounded-lg bg-white max-h-screen overflow-y-auto">
                        <div class="">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-xl font-semibold text-gray-900">${detail.name} - 详细信息</h3>
                                <button onclick="closeCommunityDetail()" class="text-gray-400 hover:text-gray-600 p-1">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            

                            
                            <!-- 详细信息网格 -->
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <!-- 基本信息 -->
                                <div class="bg-white border border-gray-200 rounded-lg p-4">
                                    <h4 class="font-semibold text-gray-800 border-b border-gray-200 pb-2 mb-4">
                                        基本信息
                                    </h4>
                                    <div class="space-y-3">
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">小区名称</span>
                                            <span class="font-medium">${detail.name}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">建筑区规划名称</span>
                                            <span class="font-medium">${detail.name}住宅区</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">建成年代</span>
                                            <span class="font-medium">${detail.buildingYear}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">维修基金金额</span>
                                            <span class="font-medium text-green-600">￥${(Math.random() * 1000000 + 500000).toFixed(0)}</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 入驻情况 -->
                                <div class="bg-white border border-gray-200 rounded-lg p-4">
                                    <h4 class="font-semibold text-gray-800 border-b border-gray-200 pb-2 mb-4">
                                        入驻情况
                                    </h4>
                                    <div class="space-y-3">
                                        <div class="flex justify-between items-center">
                                            <span class="text-gray-600">小区状况</span>
                                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">${detail.communityStatus}</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-gray-600">平台入驻</span>
                                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">${detail.platformStatus}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">注册时间</span>
                                            <span class="font-medium">${detail.contractDate}</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 位置信息 -->
                                <div class="bg-white border border-gray-200 rounded-lg p-4">
                                    <h4 class="font-semibold text-gray-800 border-b border-gray-200 pb-2 mb-4">
                                        位置信息
                                    </h4>
                                    <div class="space-y-3">
                                        <div>
                                            <span class="text-gray-600 block mb-1">小区地址</span>
                                            <span class="font-medium">${detail.address}</span>
                                        </div>
                                        <div class="grid grid-cols-2 gap-2 text-sm">
                                            <div><span class="text-gray-600">东至：</span>东环路</div>
                                            <div><span class="text-gray-600">南至：</span>南大街</div>
                                            <div><span class="text-gray-600">西至：</span>西二环</div>
                                            <div><span class="text-gray-600">北至：</span>北三环</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 行政区划 -->
                                <div class="bg-white border border-gray-200 rounded-lg p-4">
                                    <h4 class="font-semibold text-gray-800 border-b border-gray-200 pb-2 mb-4">
                                        行政区划
                                    </h4>
                                    <div class="space-y-3">
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">所属街道（乡镇）</span>
                                            <span class="font-medium">${detail.name.includes('阳光') ? '朝阳街道' : detail.name.includes('绿城') ? '浦东街道' : '天河街道'}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">所属社区</span>
                                            <span class="font-medium">${detail.name}社区</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 建筑信息 -->
                                <div class="bg-white border border-gray-200 rounded-lg p-4">
                                    <h4 class="font-semibold text-gray-800 border-b border-gray-200 pb-2 mb-4">
                                        建筑信息
                                    </h4>
                                    <div class="space-y-3">
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">总户数</span>
                                            <span class="font-medium">${detail.totalHouseholds}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">楼栋数</span>
                                            <span class="font-medium">${detail.buildingCount}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">总建筑面积</span>
                                            <span class="font-medium">${detail.totalArea}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">住宅面积</span>
                                            <span class="font-medium">${(parseInt(detail.totalArea) * 0.8).toFixed(0)}㎡</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">非住宅面积</span>
                                            <span class="font-medium">${(parseInt(detail.totalArea) * 0.2).toFixed(0)}㎡</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 其他信息 -->
                                <div class="bg-white border border-gray-200 rounded-lg p-4">
                                    <h4 class="font-semibold text-gray-800 border-b border-gray-200 pb-2 mb-4">
                                        其他信息
                                    </h4>
                                    <div class="space-y-3">
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">容积率</span>
                                            <span class="font-medium">2.5</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">入住率</span>
                                            <span class="font-medium">${detail.occupancyRate}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">车位配比</span>
                                            <span class="font-medium">${detail.parkingRatio}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">固定车位数</span>
                                            <span class="font-medium">${Math.floor(parseInt(detail.totalHouseholds) * 0.6)}个</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">产权车位数</span>
                                            <span class="font-medium">${Math.floor(parseInt(detail.totalHouseholds) * 0.8)}个</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">人防车位数</span>
                                            <span class="font-medium">${Math.floor(parseInt(detail.totalHouseholds) * 0.3)}个</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 基础设施 -->
                                <div class="bg-white border border-gray-200 rounded-lg p-4 lg:col-span-2">
                                    <h4 class="font-semibold text-gray-800 border-b border-gray-200 pb-2 mb-4">
                                        基础设施
                                    </h4>
                                    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-3">
                                        <div class="flex items-center space-x-2">
                                            <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                            <span class="text-sm">供水</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                            <span class="text-sm">供电</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                            <span class="text-sm">供气</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                            <span class="text-sm">供暖</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                            <span class="text-sm">宽带</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
                                            <span class="text-sm">新风</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                            <span class="text-sm">热水</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 管理信息 -->
                                <div class="bg-white border border-gray-200 rounded-lg p-4 lg:col-span-2">
                                    <h4 class="font-semibold text-gray-800 border-b border-gray-200 pb-2 mb-4">
                                        管理信息
                                    </h4>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div>
                                            <span class="text-gray-600 block mb-1">小区联系人</span>
                                            <span class="font-medium">${detail.contact}</span>
                                        </div>
                                        <div>
                                            <span class="text-gray-600 block mb-1">联系电话</span>
                                            <span class="font-medium">138${Math.floor(Math.random() * 10000000).toString().padStart(8, '0')}</span>
                                        </div>
                                        <div>
                                            <span class="text-gray-600 block mb-1">物业公司</span>
                                            <span class="font-medium">${detail.propertyCompany}</span>
                                        </div>
                                        <div>
                                            <span class="text-gray-600 block mb-1">授权等级</span>
                                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${detail.authLevel === '标准版' ? 'bg-blue-100 text-blue-800' : detail.authLevel === '专业版' ? 'bg-blue-100 text-blue-800' : 'bg-yellow-100 text-yellow-800'}">${detail.authLevel}</span>
                                        </div>
                                        <div>
                                            <span class="text-gray-600 block mb-1">市场负责人</span>
                                            <span class="font-medium">${detail.name.includes('阳光') ? '王市场' : detail.name.includes('绿城') ? '李市场' : '陈市场'}</span>
                                        </div>
                                        <div>
                                            <span class="text-gray-600 block mb-1">运维人员</span>
                                            <span class="font-medium">${detail.name.includes('阳光') ? '张运维' : detail.name.includes('绿城') ? '刘运维' : '赵运维'}</span>
                                        </div>
                                        <div>
                                            <span class="text-gray-600 block mb-1">小区管理员</span>
                                            <span class="font-medium">${detail.name.includes('阳光') ? '王管理员' : detail.name.includes('绿城') ? '李管理员' : '张管理员'}</span>
                                        </div>
                                        <div>
                                            <span class="text-gray-600 block mb-1">管理员联系方式</span>
                                            <span class="font-medium">${detail.name.includes('阳光') ? '13800138001' : detail.name.includes('绿城') ? '13900139002' : '13700137003'}</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 附件信息 -->
                                <div class="bg-white border border-gray-200 rounded-lg p-4 lg:col-span-2">
                                    <h4 class="font-semibold text-gray-800 border-b border-gray-200 pb-2 mb-4">
                                        附件信息
                                    </h4>
                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="attachmentCards">
                                        <!-- 附件卡片将通过JavaScript动态生成 -->
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-6 flex justify-end space-x-3">
                                <button onclick="closeCommunityDetail()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors">
                                    关闭
                                </button>
                                <button onclick="editCommunity('${detail.name}')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                    编辑小区
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // 添加弹窗到页面
            document.body.insertAdjacentHTML('beforeend', modalContent);
            
            // 生成附件卡片
            generateAttachmentCards(communityName);
        }
        
        /**
         * 关闭小区详情弹窗
         */
        function closeCommunityDetail() {
            const modal = document.getElementById('communityDetailModal');
            if (modal) {
                modal.remove();
            }
        }
        
        /**
         * 生成附件卡片
         * @param {string} communityName - 小区名称
         */
        function generateAttachmentCards(communityName) {
            // 模拟附件数据
            const attachmentData = {
                '阳光花园': [
                    {
                        id: 1,
                        name: '小区规划图.pdf',
                        type: 'pdf',
                        size: '2.3 MB',
                        uploadTime: '2024-01-15 14:30',
                        icon: 'fas fa-file-pdf',
                        color: 'text-red-600'
                    },
                    {
                        id: 2,
                        name: '物业合同.doc',
                        type: 'doc',
                        size: '1.8 MB',
                        uploadTime: '2024-01-10 09:15',
                        icon: 'fas fa-file-word',
                        color: 'text-blue-600'
                    },
                    {
                        id: 3,
                        name: '住户清册.xlsx',
                        type: 'xlsx',
                        size: '856 KB',
                        uploadTime: '2024-01-08 16:20',
                        icon: 'fas fa-file-excel',
                        color: 'text-green-600'
                    }
                ],
                '绿城小区': [
                    {
                        id: 4,
                        name: '建筑设计图.pdf',
                        type: 'pdf',
                        size: '4.1 MB',
                        uploadTime: '2024-01-12 11:30',
                        icon: 'fas fa-file-pdf',
                        color: 'text-red-600'
                    },
                    {
                        id: 5,
                        name: '业委会成立文件.docx',
                        type: 'docx',
                        size: '1.2 MB',
                        uploadTime: '2024-01-05 15:45',
                        icon: 'fas fa-file-word',
                        color: 'text-blue-600'
                    }
                ],
                '华府豪庭': [
                    {
                        id: 6,
                        name: '小区环境评估报告.pdf',
                        type: 'pdf',
                        size: '3.7 MB',
                        uploadTime: '2024-01-18 10:20',
                        icon: 'fas fa-file-pdf',
                        color: 'text-red-600'
                    },
                    {
                        id: 7,
                        name: '财务报表.xlsx',
                        type: 'xlsx',
                        size: '1.5 MB',
                        uploadTime: '2024-01-16 14:10',
                        icon: 'fas fa-file-excel',
                        color: 'text-green-600'
                    },
                    {
                        id: 8,
                        name: '消防安全检查报告.doc',
                        type: 'doc',
                        size: '2.1 MB',
                        uploadTime: '2024-01-14 16:30',
                        icon: 'fas fa-file-word',
                        color: 'text-blue-600'
                    }
                ]
            };
            
            const attachments = attachmentData[communityName] || [];
            const container = document.getElementById('attachmentCards');
            
            if (attachments.length === 0) {
                container.innerHTML = '<div class="col-span-full text-center text-gray-500 py-8">暂无附件</div>';
                return;
            }
            
            const cardsHtml = attachments.map(attachment => `
                <div class="attachment-card bg-gray-50 border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer" onclick="downloadAttachment('${attachment.id}', '${attachment.name}')">
                    <div class="flex items-start space-x-3">
                        <div class="flex-shrink-0">
                            <i class="${attachment.icon} ${attachment.color} text-2xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="text-sm font-medium text-gray-900 truncate" title="${attachment.name}">
                                ${attachment.name}
                            </div>
                            <div class="text-xs text-gray-500 mt-1">
                                ${attachment.size} • ${attachment.uploadTime}
                            </div>
                        </div>
                        <div class="flex-shrink-0">
                            <button class="text-gray-400 hover:text-gray-600" onclick="event.stopPropagation(); downloadAttachment('${attachment.id}', '${attachment.name}')">
                                <i class="fas fa-download text-sm"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = cardsHtml;
        }
        
        /**
         * 下载附件
         * @param {string} attachmentId - 附件ID
         * @param {string} fileName - 文件名
         */
        function downloadAttachment(attachmentId, fileName) {
            console.log(`下载附件: ${fileName} (ID: ${attachmentId})`);
            // 这里应该调用实际的下载 API
            alert(`开始下载: ${fileName}`);
        }
        
        // 页面初始化
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof initPage === 'function') {
                initPage('community-management');
            } else {
                console.error('initPage函数未定义，请检查layout.js是否正确加载');
            }
            
            // 初始化状态开关组件
            initializeCommunityStatusToggles();
        });
        
        /**
         * 初始化小区状态开关组件
         */
        function initializeCommunityStatusToggles() {
            // 小区状态数据映射 - 根据入驻状态判断
            const communityStatusData = [
                { id: 1, name: '阳光花园', status: true },  // 已入驻 = 启用 = true
                { id: 2, name: '绿城小区', status: false }, // 待入驻 = 停用 = false
                { id: 3, name: '华府豪庭', status: true }   // 已入驻 = 启用 = true
            ];
            
            // 为每个小区创建状态开关
            communityStatusData.forEach(community => {
                new ToggleSwitch({
                    containerId: `community-status-toggle-${community.id}`,
                    id: `community-status-${community.id}`,
                    checked: community.status,
                    onChange: (checked, id) => handleCommunityStatusChange(community.name, checked, id),
                    size: 'sm'
                });
            });
        }
        
        /**
         * 处理小区状态变更
         * @param {string} communityName - 小区名称
         * @param {boolean} newStatus - 新状态（true=启用，false=停用）
         * @param {string} toggleId - 开关ID
         */
        function handleCommunityStatusChange(communityName, newStatus, toggleId) {
            const statusText = newStatus ? '启用' : '停用';
            console.log(`小区 ${communityName} 状态已更改为: ${statusText}`);
            
            // 这里可以添加 API 调用来更新后端数据
            // 例如: updateCommunityStatus(communityName, newStatus)
            
            // 可选：显示状态更改确认
            // alert(`${communityName} 状态已更改为: ${statusText}`);
        }

    </script>
</body>
</html>