# é€šç”¨å®¡æ‰¹ç³»ç»Ÿå¼€å‘æŒ‡å—

## æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›è¯¦ç»†çš„æŠ€æœ¯å®ç°æŒ‡å—ï¼Œç”¨äºåœ¨DA-SOLOç³»ç»Ÿä¸­å¼€å‘ç‹¬ç«‹çš„é€šç”¨å®¡æ‰¹ç³»ç»Ÿã€‚è¯¥ç³»ç»Ÿå¤ç”¨ç°æœ‰é€šçŸ¥å®¡æ‰¹çš„æˆåŠŸç»éªŒï¼Œä½†é‡‡ç”¨å®Œå…¨ç‹¬ç«‹çš„æ¶æ„ï¼Œé¿å…ä¸ç°æœ‰é€šçŸ¥ç³»ç»Ÿå†²çªã€‚

## é‡è¦è®¾è®¡åŸåˆ™

### Eventè¡¨å…³è”è®¾è®¡
- **çˆ¶å­å…³ç³»**ï¼šEventè¡¨æ˜¯çˆ¶çº§ï¼Œå®¡æ‰¹äº‹é¡¹æ˜¯å­çº§
- **å…³è”å­—æ®µ**ï¼š`related_event_id` å­—æ®µå…³è”åˆ° `events.id`
- **ä¸šåŠ¡é€»è¾‘**ï¼šå®¡æ‰¹äº‹é¡¹å¯ä»¥ä»Eventè¯¦æƒ…é¡µå‘èµ·ï¼Œä¹Ÿå¯ä»¥ç‹¬ç«‹åˆ›å»º
- **æ•°æ®æµè½¬**ï¼šEvent â†’ å®¡æ‰¹äº‹é¡¹ â†’ å®¡æ‰¹é€šè¿‡ â†’ å¯èƒ½æ›´æ–°EventçŠ¶æ€

### ç‰¹æ®Šç±»å‹å¤„ç†
- **é—®å·è°ƒæŸ¥**ï¼šä½¿ç”¨ä¸“é—¨çš„é—®å·è®¾è®¡å™¨ï¼Œä¸ä½¿ç”¨é€šç”¨å¯Œæ–‡æœ¬ç¼–è¾‘å™¨
- **å…¶ä»–ç±»å‹**ï¼šä½¿ç”¨é€šç”¨çš„å¯Œæ–‡æœ¬+é™„ä»¶æ¨¡å¼
- **åŠ¨æ€è¡¨å•**ï¼šæ ¹æ®é€‰æ‹©çš„å®¡æ‰¹ç±»å‹åŠ¨æ€åˆ‡æ¢è¡¨å•ç»„ä»¶

## ç³»ç»Ÿæ¶æ„

### ç›®å½•ç»“æ„

```
src/
â”œâ”€â”€ types/
â”‚   â””â”€â”€ approval.ts                    # å®¡æ‰¹ç³»ç»Ÿç±»å‹å®šä¹‰
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ ApprovalService.ts            # å®¡æ‰¹CRUDæœåŠ¡
â”‚   â”œâ”€â”€ ApprovalWorkflowService.ts    # å®¡æ‰¹æµç¨‹æœåŠ¡ï¼ˆå¤ç”¨ç°æœ‰ï¼‰
â”‚   â””â”€â”€ ApprovalPushService.ts        # å®¡æ‰¹æ¨é€æœåŠ¡
â”œâ”€â”€ components/approval/              # ç‹¬ç«‹çš„å®¡æ‰¹ç»„ä»¶ç›®å½•
â”‚   â”œâ”€â”€ ApprovalForm.tsx             # é€šç”¨å®¡æ‰¹è¡¨å•ï¼ˆåŠ¨æ€åˆ‡æ¢ï¼‰
â”‚   â”œâ”€â”€ ApprovalCard.tsx             # å®¡æ‰¹äº‹é¡¹å¡ç‰‡
â”‚   â”œâ”€â”€ ApprovalTabNavigation.tsx    # Tabå¯¼èˆªç»„ä»¶
â”‚   â”œâ”€â”€ ApprovalTypeSelector.tsx     # å®¡æ‰¹ç±»å‹é€‰æ‹©å™¨
â”‚   â”œâ”€â”€ ApprovalFlow.tsx             # å®¡æ‰¹æµç¨‹å±•ç¤º
â”‚   â”œâ”€â”€ ApprovalVotingBar.tsx        # æŠ•ç¥¨æ“ä½œæ 
â”‚   â”œâ”€â”€ SurveyDesigner.tsx           # é—®å·è®¾è®¡å™¨ï¼ˆç‰¹æ®Šç±»å‹ï¼‰
â”‚   â””â”€â”€ GeneralContentEditor.tsx     # é€šç”¨å†…å®¹ç¼–è¾‘å™¨
â”œâ”€â”€ pages/approval/                   # ç‹¬ç«‹çš„å®¡æ‰¹é¡µé¢
â”‚   â”œâ”€â”€ ApprovalCreate.tsx           # åˆ›å»ºå®¡æ‰¹äº‹é¡¹
â”‚   â”œâ”€â”€ ApprovalList.tsx             # å®¡æ‰¹äº‹é¡¹åˆ—è¡¨
â”‚   â””â”€â”€ ApprovalDetail.tsx           # å®¡æ‰¹äº‹é¡¹è¯¦æƒ…
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useApproval.ts               # å®¡æ‰¹ç›¸å…³hooks
â””â”€â”€ store/
    â””â”€â”€ approvalSlice.ts             # å®¡æ‰¹çŠ¶æ€ç®¡ç†
```

## ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¶æ„æ­å»º

### ä»»åŠ¡1.1ï¼šåˆ›å»ºç±»å‹å®šä¹‰æ–‡ä»¶ã€å·²å®Œæˆã€‘

**æ–‡ä»¶ä½ç½®**ï¼š`src/types/approval.ts`
**å‚è€ƒæ–‡ä»¶**ï¼š`src/types/notification.ts`

```typescript
/**
 * å®¡æ‰¹ç³»ç»Ÿç›¸å…³çš„TypeScriptæ¥å£å®šä¹‰
 * åŸºäºé€šçŸ¥ç³»ç»Ÿè®¾è®¡ï¼Œæ”¯æŒå¤šç§å®¡æ‰¹ç±»å‹çš„è¿‡åŠå®¡æ‰¹æœºåˆ¶
 */

import { User, Message, Publisher } from '../store/index';

// å®¡æ‰¹ç±»å‹æšä¸¾ï¼ˆå¼€æ”¾è®¾è®¡ï¼Œæ”¯æŒè‡ªå®šä¹‰ï¼‰
export const APPROVAL_TYPE = {
  ANNOUNCEMENT: 'announcement',      // å…¬å‘Š
  EXPENSE: 'expense',               // æ”¯å‡ºç”³è¯·
  NOTIFICATION: 'notification',      // é€šçŸ¥
  SEAL: 'seal',                     // ç”¨å°ç”³è¯·
  SURVEY: 'survey',                 // é—®å·è°ƒæŸ¥
  GENERAL: 'general'                // é€šç”¨ï¼ˆè‡ªå®šä¹‰ç±»å‹ï¼‰
} as const;

// å®¡æ‰¹çŠ¶æ€æšä¸¾ï¼ˆä¸é€šçŸ¥ç³»ç»Ÿä¿æŒä¸€è‡´ï¼‰
export const APPROVAL_STATUS = {
  DRAFT: 'draft',                    // è‰ç¨¿
  PENDING_APPROVAL: 'pending_approval', // å¾…å®¡æ‰¹
  APPROVED: 'approved',              // å®¡æ‰¹é€šè¿‡
  PUBLISHED: 'published',            // å·²å‘å¸ƒ
  REJECTED: 'rejected'               // å®¡æ‰¹æ‹’ç»
} as const;

// å®¡æ‰¹ç›®æ ‡å—ä¼—æšä¸¾ï¼ˆå¤ç”¨é€šçŸ¥ç³»ç»Ÿè®¾è®¡ï¼‰
export const APPROVAL_AUDIENCE = {
  ALL: 'all',           // å…¨ä½“ä¸šä¸»
  BUILDING: 'building', // ç‰¹å®šæ¥¼æ ‹
  ROLE: 'role'         // ç‰¹å®šè§’è‰²
} as const;

// å®¡æ‰¹æŠ•ç¥¨ç±»å‹æšä¸¾ï¼ˆå¤ç”¨ç°æœ‰ï¼‰
export const APPROVAL_VOTE = {
  APPROVE: 'approve',  // èµæˆ
  REJECT: 'reject',    // åå¯¹
  ABSTAIN: 'abstain'   // å¼ƒæƒ
} as const;

export type ApprovalType = typeof APPROVAL_TYPE[keyof typeof APPROVAL_TYPE];
export type ApprovalStatus = typeof APPROVAL_STATUS[keyof typeof APPROVAL_STATUS];
export type ApprovalAudience = typeof APPROVAL_AUDIENCE[keyof typeof APPROVAL_AUDIENCE];
export type ApprovalVote = typeof APPROVAL_VOTE[keyof typeof APPROVAL_VOTE];

// å®¡æ‰¹äº‹é¡¹ä¸»æ¥å£
export interface Approval {
  id: string;
  title: string;
  content: string; // å¯Œæ–‡æœ¬å†…å®¹
  approval_type: string; // æ”¯æŒè‡ªå®šä¹‰ç±»å‹ï¼Œä¸é™äºæšä¸¾
  predefined_type?: ApprovalType; // é¢„è®¾ç±»å‹ï¼ˆç”¨äºå›¾æ ‡å’Œæ ·å¼ï¼‰
  status: ApprovalStatus;
  
  // å‘å¸ƒç›¸å…³
  author_id: string;
  author: User;
  target_audience: ApprovalAudience;
  target_details?: string; // å…·ä½“èŒƒå›´è¯¦æƒ…
  
  // æ—¶é—´ç®¡ç†
  created_at: string;
  updated_at: string;
  published_at?: string;
  
  // åŠŸèƒ½å­—æ®µ
  is_pinned: boolean;
  approval_workflow_id?: string;
  
  // åª’ä½“å’Œé™„ä»¶
  images: string[];
  attachments: { name: string; url: string; size?: number; type?: string }[];
  
  // AIå’Œç»Ÿè®¡
  ai_summary?: string;
  view_count: number;
  read_count: number;
  unread_count: number;
  
  // ç‚¹èµç‚¹è¸©ç»Ÿè®¡
  like_count: number;
  dislike_count: number;
  
  // å…³è”äº‹ä»¶ï¼ˆå¯é€‰ï¼‰
  related_event_id?: string;
  
  // ç”¨æˆ·äº¤äº’çŠ¶æ€
  is_read: boolean;
  is_subscribed: boolean;
  user_interaction: 'like' | 'dislike' | null;
  
  // å®¡æ‰¹çŠ¶æ€
  approval_stats?: ApprovalStats;
  approval_history?: ApprovalRecord[];
  required_approvals?: number;
  deadline?: string;
}

// å®¡æ‰¹è®°å½•æ¥å£ï¼ˆå¤ç”¨é€šçŸ¥å®¡æ‰¹è®¾è®¡ï¼‰
export interface ApprovalRecord {
  id: string;
  approval_id: string;
  workflow_id: string;
  approver_id: string;
  approver: User;
  vote: ApprovalVote;
  comment?: string;
  voted_at: string;
  created_at: string;
}

// å®¡æ‰¹ç»Ÿè®¡æ¥å£ï¼ˆå¤ç”¨é€šçŸ¥ç³»ç»Ÿè®¾è®¡ï¼‰
export interface ApprovalStats {
  total_committee_members: number;
  approve_count: number;
  reject_count: number;
  abstain_count: number;
  voted_count: number;
  pending_count: number;
  majority_threshold: number;
  is_approved: boolean;
  is_rejected: boolean;
  can_auto_approve: boolean;
  can_auto_reject: boolean;
}

// å®¡æ‰¹è¡¨å•æ•°æ®æ¥å£
export interface ApprovalFormData {
  title: string;
  content: string;
  approval_type: string; // æ”¯æŒè‡ªå®šä¹‰ç±»å‹
  predefined_type?: ApprovalType;
  target_audience: ApprovalAudience;
  target_details?: string;
  images: string[];
  attachments: { name: string; url: string; size?: number; type?: string }[];
  related_event_id?: string;
  is_draft: boolean;
}

// å®¡æ‰¹æŸ¥è¯¢å‚æ•°æ¥å£
export interface ApprovalQueryParams {
  page?: number;
  limit?: number;
  status?: ApprovalStatus;
  approval_type?: string;
  target_audience?: ApprovalAudience;
  author_id?: string;
  is_pinned?: boolean;
  search?: string;
  sort_by?: 'created_at' | 'updated_at' | 'published_at' | 'view_count';
  sort_order?: 'asc' | 'desc';
}

// å®¡æ‰¹å·¥ä½œæµæ¥å£
export interface ApprovalWorkflow {
  id: string;
  approval_id: string;
  approval: Approval;
  status: 'pending' | 'approved' | 'rejected';
  created_at: string;
  updated_at: string;
  approvals: ApprovalRecord[];
  stats: ApprovalStats;
  can_vote: boolean;
  user_vote?: ApprovalRecord;
}

// APIå“åº”æ¥å£
export interface ApprovalAPIResponse<T = unknown> {
  success: boolean;
  data: T;
  message?: string;
  error?: string;
}

export interface PaginatedApprovalResponse {
  approvals: Approval[];
  total: number;
  page: number;
  limit: number;
  hasMore: boolean;
}

// å®¡æ‰¹æƒé™æ£€æŸ¥æ¥å£
export interface ApprovalPermissions {
  can_create: boolean;
  can_edit: boolean;
  can_delete: boolean;
  can_pin: boolean;
  can_approve: boolean;
  can_view_stats: boolean;
}

// é¢„è®¾å®¡æ‰¹ç±»å‹é…ç½®
export interface ApprovalTypeConfig {
  key: ApprovalType;
  label: string;
  icon: string; // Lucideå›¾æ ‡åç§°
  color: string; // ä¸»é¢˜è‰²
  description: string;
}

export const APPROVAL_TYPE_CONFIGS: ApprovalTypeConfig[] = [
  {
    key: 'announcement',
    label: 'å…¬å‘Šç®¡ç†',
    icon: 'Megaphone',
    color: 'blue',
    description: 'å‘å¸ƒå°åŒºé‡è¦å…¬å‘Š'
  },
  {
    key: 'expense',
    label: 'æ”¯å‡ºç”³è¯·',
    icon: 'DollarSign',
    color: 'green',
    description: 'ç”³è¯·å°åŒºè´¹ç”¨æ”¯å‡º'
  },
  {
    key: 'notification',
    label: 'é€šçŸ¥å‘å¸ƒ',
    icon: 'Bell',
    color: 'orange',
    description: 'å‘å¸ƒä¸šå§”ä¼šé€šçŸ¥'
  },
  {
    key: 'seal',
    label: 'ç”¨å°ç”³è¯·',
    icon: 'Stamp',
    color: 'red',
    description: 'ç”³è¯·ä½¿ç”¨å…¬ç« '
  },
  {
    key: 'survey',
    label: 'é—®å·è°ƒæŸ¥',
    icon: 'MessageSquare',
    color: 'purple',
    description: 'å‘èµ·ä¸šä¸»è°ƒæŸ¥é—®å·'
  }
];
```

### ä»»åŠ¡1.2ï¼šåˆ›å»ºå®¡æ‰¹æœåŠ¡ã€éƒ¨åˆ†å®Œæˆã€‘

**æ–‡ä»¶ä½ç½®**ï¼š`src/services/ApprovalService.ts`
**å‚è€ƒæ–‡ä»¶**ï¼š`src/services/NotificationService.ts`

```typescript
/**
 * å®¡æ‰¹æœåŠ¡ç±»
 * åŸºäºNotificationServiceè®¾è®¡ï¼Œæä¾›å®¡æ‰¹äº‹é¡¹çš„CRUDæ“ä½œ
 */

import { supabase } from '../lib/supabase';
import type {
  Approval,
  ApprovalFormData,
  ApprovalQueryParams,
  ApprovalStats,
  PaginatedApprovalResponse,
  ApprovalRecord,
  ApprovalWorkflow
} from '../types/approval';

export class ApprovalService {
  /**
   * åˆ›å»ºå®¡æ‰¹äº‹é¡¹
   * å‚è€ƒï¼šNotificationService.createNotification
   */
  static async createApproval(formData: ApprovalFormData, authorId: string): Promise<Approval | null> {
    try {
      // å¼€å‘ç¯å¢ƒè°ƒè¯•ä¿¡æ¯
      if (process.env.NODE_ENV === 'development') {
        console.log('ğŸš€ å¼€å§‹åˆ›å»ºå®¡æ‰¹äº‹é¡¹:', { formData, authorId });
        
        // æ£€æŸ¥è®¤è¯çŠ¶æ€
        const { data: { session } } = await supabase.auth.getSession();
        console.log('ğŸ” å½“å‰è®¤è¯çŠ¶æ€:', {
          hasSession: !!session,
          userId: session?.user?.id,
          authorId
        });
      }

      const approvalData = {
        title: formData.title,
        content: formData.content,
        approval_type: formData.approval_type,
        predefined_type: formData.predefined_type,
        status: formData.is_draft ? 'draft' : 'pending_approval',
        author_id: authorId,
        target_audience: formData.target_audience,
        target_details: formData.target_details,
        images: formData.images || [],
        attachments: formData.attachments || [],
        related_event_id: formData.related_event_id,
        is_pinned: false,
        view_count: 0,
        like_count: 0,
        dislike_count: 0,
        read_count: 0,
        unread_count: 0
      };

      if (process.env.NODE_ENV === 'development') {
        console.log('ğŸ“ å‡†å¤‡æ’å…¥çš„æ•°æ®:', approvalData);
      }

      const { data, error } = await supabase
        .from('approvals')
        .insert([approvalData])
        .select(`
          *,
          author:users!approvals_author_id_fkey(id, name, avatar, role, building, unit)
        `)
        .single();

      if (error) {
        console.error('âŒ åˆ›å»ºå®¡æ‰¹äº‹é¡¹å¤±è´¥:', {
          error,
          code: error.code,
          message: error.message,
          details: error.details,
          hint: error.hint
        });
        
        // å¦‚æœæ˜¯RLSé”™è¯¯ï¼Œæä¾›æ›´å¤šè°ƒè¯•ä¿¡æ¯
        if (error.code === '42501') {
          console.error('ğŸ”’ RLSç­–ç•¥è¿è§„ - å¯èƒ½çš„åŸå› :');
          console.error('1. ç”¨æˆ·æœªæ­£ç¡®è®¤è¯');
          console.error('2. RLSç­–ç•¥è¿‡äºä¸¥æ ¼');
          console.error('3. author_idä¸å½“å‰ç”¨æˆ·ä¸åŒ¹é…');
          
          // å°è¯•è°ƒè¯•æŸ¥è¯¢
          try {
            const { data: debugAuth } = await supabase.rpc('debug_auth_status');
            console.error('ğŸ” æ•°æ®åº“è®¤è¯çŠ¶æ€:', debugAuth);
          } catch (debugError) {
            console.error('ğŸ” æ— æ³•è·å–è°ƒè¯•ä¿¡æ¯:', debugError);
          }
        }
        
        throw error;
      }

      if (process.env.NODE_ENV === 'development') {
        console.log('âœ… å®¡æ‰¹äº‹é¡¹åˆ›å»ºæˆåŠŸ:', data);
      }

      return data;
    } catch (error) {
      console.error('ğŸ’¥ åˆ›å»ºå®¡æ‰¹äº‹é¡¹å¼‚å¸¸:', error);
      return null;
    }
  }

  /**
   * æ›´æ–°å®¡æ‰¹äº‹é¡¹
   * å‚è€ƒï¼šNotificationService.updateNotification
   */
  static async updateApproval(id: string, updates: Partial<ApprovalFormData>): Promise<Approval | null> {
    try {
      const updateData = {
        ...updates,
        updated_at: new Date().toISOString()
      };

      const { data, error } = await supabase
        .from('approvals')
        .update(updateData)
        .eq('id', id)
        .select(`
          *,
          author:users!approvals_author_id_fkey(id, name, avatar, role, building, unit)
        `)
        .single();

      if (error) {
        console.error('æ›´æ–°å®¡æ‰¹äº‹é¡¹å¤±è´¥:', error);
        throw error;
      }

      return data;
    } catch (error) {
      console.error('æ›´æ–°å®¡æ‰¹äº‹é¡¹å¼‚å¸¸:', error);
      return null;
    }
  }

  /**
   * è·å–å®¡æ‰¹äº‹é¡¹åˆ—è¡¨
   * å‚è€ƒï¼šNotificationService.getNotifications
   */
  static async getApprovals(params: ApprovalQueryParams = {}, userId?: string): Promise<PaginatedApprovalResponse> {
    try {
      const {
        page = 1,
        limit = 20,
        status,
        approval_type,
        author_id,
        is_pinned,
        search,
        sort_by = 'created_at',
        sort_order = 'desc'
      } = params;

      let query = supabase
        .from('approvals')
        .select(`
          *,
          author:users!approvals_author_id_fkey(id, name, avatar, role, building, unit)
        `, { count: 'exact' });

      // æ·»åŠ ç­›é€‰æ¡ä»¶
      if (status) {
        query = query.eq('status', status);
      }
      if (approval_type) {
        query = query.eq('approval_type', approval_type);
      }
      if (author_id) {
        query = query.eq('author_id', author_id);
      }
      if (is_pinned !== undefined) {
        query = query.eq('is_pinned', is_pinned);
      }
      if (search) {
        query = query.or(`title.ilike.%${search}%,content.ilike.%${search}%`);
      }

      // æ’åºå’Œåˆ†é¡µ
      query = query
        .order(sort_by, { ascending: sort_order === 'asc' })
        .range((page - 1) * limit, page * limit - 1);

      const { data, error, count } = await query;

      if (error) {
        console.error('è·å–å®¡æ‰¹åˆ—è¡¨å¤±è´¥:', error);
        throw error;
      }

      return {
        approvals: data || [],
        total: count || 0,
        page,
        limit,
        hasMore: (count || 0) > page * limit
      };
    } catch (error) {
      console.error('è·å–å®¡æ‰¹åˆ—è¡¨å¼‚å¸¸:', error);
      return {
        approvals: [],
        total: 0,
        page: 1,
        limit: 20,
        hasMore: false
      };
    }
  }

  /**
   * è·å–å®¡æ‰¹äº‹é¡¹è¯¦æƒ…
   * å‚è€ƒï¼šNotificationService.getNotificationById
   */
  static async getApprovalById(id: string, userId?: string): Promise<Approval | null> {
    try {
      const { data, error } = await supabase
        .from('approvals')
        .select(`
          *,
          author:users!approvals_author_id_fkey(id, name, avatar, role, building, unit),
          approval_history:approval_records(
            id,
            vote,
            comment,
            voted_at,
            approver:users!approval_records_approver_id_fkey(id, name, avatar, role)
          )
        `)
        .eq('id', id)
        .single();

      if (error) {
        console.error('è·å–å®¡æ‰¹è¯¦æƒ…å¤±è´¥:', error);
        throw error;
      }

      // å¦‚æœæä¾›äº†ç”¨æˆ·IDï¼Œè·å–ç”¨æˆ·ç›¸å…³çŠ¶æ€
      if (userId && data) {
        // TODO: æ·»åŠ ç”¨æˆ·é˜…è¯»çŠ¶æ€ã€ç‚¹èµçŠ¶æ€ç­‰æŸ¥è¯¢
        // å‚è€ƒNotificationServiceçš„å®ç°
      }

      return data;
    } catch (error) {
      console.error('è·å–å®¡æ‰¹è¯¦æƒ…å¼‚å¸¸:', error);
      return null;
    }
  }

  /**
   * åˆ é™¤å®¡æ‰¹äº‹é¡¹
   * å‚è€ƒï¼šNotificationService.deleteNotification
   */
  static async deleteApproval(id: string): Promise<boolean> {
    try {
      const { error } = await supabase
        .from('approvals')
        .delete()
        .eq('id', id);

      if (error) {
        console.error('åˆ é™¤å®¡æ‰¹äº‹é¡¹å¤±è´¥:', error);
        throw error;
      }

      return true;
    } catch (error) {
      console.error('åˆ é™¤å®¡æ‰¹äº‹é¡¹å¼‚å¸¸:', error);
      return false;
    }
  }

  /**
   * å‘å¸ƒå®¡æ‰¹äº‹é¡¹
   * å‚è€ƒï¼šNotificationService.publishNotification
   */
  static async publishApproval(id: string): Promise<boolean> {
    try {
      const { error } = await supabase
        .from('approvals')
        .update({
          status: 'published',
          published_at: new Date().toISOString(),
          updated_at: new Date().toISOString()
        })
        .eq('id', id);

      if (error) {
        console.error('å‘å¸ƒå®¡æ‰¹äº‹é¡¹å¤±è´¥:', error);
        throw error;
      }

      return true;
    } catch (error) {
      console.error('å‘å¸ƒå®¡æ‰¹äº‹é¡¹å¼‚å¸¸:', error);
      return false;
    }
  }

  /**
   * æŠ•ç¥¨æ“ä½œ
   * å¤ç”¨ï¼šApprovalWorkflowService.submitVoteï¼ˆç°æœ‰å®ç°ï¼‰
   */
  static async voteOnApproval(
    approvalId: string,
    approverId: string,
    vote: 'approve' | 'reject' | 'abstain',
    comment?: string
  ): Promise<boolean> {
    // è¿™é‡Œç›´æ¥è°ƒç”¨ç°æœ‰çš„ApprovalWorkflowService
    // éœ€è¦é€‚é…æ•°æ®è¡¨åç§°ï¼ˆä»notificationsæ”¹ä¸ºapprovalsï¼‰
    try {
      // TODO: å®ç°æŠ•ç¥¨é€»è¾‘ï¼Œå‚è€ƒç°æœ‰çš„ApprovalWorkflowService
      return true;
    } catch (error) {
      console.error('æŠ•ç¥¨å¤±è´¥:', error);
      return false;
    }
  }

  /**
   * è·å–å®¡æ‰¹ç»Ÿè®¡
   * å‚è€ƒï¼šNotificationService.getApprovalStats
   */
  static async getApprovalStats(approvalId: string): Promise<ApprovalStats> {
    // å¤ç”¨ç°æœ‰çš„ç»Ÿè®¡è®¡ç®—é€»è¾‘
    try {
      // TODO: å®ç°ç»Ÿè®¡æŸ¥è¯¢
      return {
        total_committee_members: 0,
        approve_count: 0,
        reject_count: 0,
        abstain_count: 0,
        voted_count: 0,
        pending_count: 0,
        majority_threshold: 0,
        is_approved: false,
        is_rejected: false,
        can_auto_approve: false,
        can_auto_reject: false
      };
    } catch (error) {
      console.error('è·å–å®¡æ‰¹ç»Ÿè®¡å¤±è´¥:', error);
      throw error;
    }
  }

  /**
   * æäº¤å®¡æ‰¹ï¼ˆä»è‰ç¨¿è½¬ä¸ºå¾…å®¡æ‰¹ï¼‰
   */
  static async submitForApproval(id: string): Promise<boolean> {
    try {
      const { error } = await supabase
        .from('approvals')
        .update({
          status: 'pending_approval',
          updated_at: new Date().toISOString()
        })
        .eq('id', id);

      if (error) {
        console.error('æäº¤å®¡æ‰¹å¤±è´¥:', error);
        throw error;
      }

      return true;
    } catch (error) {
      console.error('æäº¤å®¡æ‰¹å¼‚å¸¸:', error);
      return false;
    }
  }

  /**
   * ç½®é¡¶/å–æ¶ˆç½®é¡¶å®¡æ‰¹äº‹é¡¹
   */
  static async togglePin(id: string, isPinned: boolean): Promise<boolean> {
    try {
      const { error } = await supabase
        .from('approvals')
        .update({
          is_pinned: isPinned,
          updated_at: new Date().toISOString()
        })
        .eq('id', id);

      if (error) {
        console.error('ç½®é¡¶æ“ä½œå¤±è´¥:', error);
        throw error;
      }

      return true;
    } catch (error) {
      console.error('ç½®é¡¶æ“ä½œå¼‚å¸¸:', error);
      return false;
    }
  }

  /**
   * ç‚¹èµ/ç‚¹è¸©å®¡æ‰¹äº‹é¡¹
   */
  static async toggleLike(approvalId: string, userId: string, action: 'like' | 'dislike'): Promise<boolean> {
    try {
      // TODO: å®ç°ç‚¹èµ/ç‚¹è¸©é€»è¾‘ï¼Œå‚è€ƒé€šçŸ¥ç³»ç»Ÿå®ç°
      return true;
    } catch (error) {
      console.error('ç‚¹èµæ“ä½œå¤±è´¥:', error);
      return false;
    }
  }

  /**
   * æ ‡è®°å®¡æ‰¹äº‹é¡¹ä¸ºå·²è¯»
   */
  static async markAsRead(approvalId: string, userId: string): Promise<boolean> {
    try {
      // TODO: å®ç°å·²è¯»æ ‡è®°é€»è¾‘
      return true;
    } catch (error) {
      console.error('æ ‡è®°å·²è¯»å¤±è´¥:', error);
      return false;
    }
  }

  /**
   * è·å–å®¡æ‰¹äº‹é¡¹ç»Ÿè®¡æ•°æ®ï¼ˆæŒ‰çŠ¶æ€åˆ†ç»„ï¼‰
   */
  static async getApprovalCounts(userId?: string): Promise<{
    all: number;
    published: number;
    pending_approval: number;
    rejected: number;
    draft: number;
  }> {
    try {
      const { data, error } = await supabase
        .from('approvals')
        .select('status')
        .eq('author_id', userId || '');

      if (error) {
        console.error('è·å–å®¡æ‰¹ç»Ÿè®¡å¤±è´¥:', error);
        throw error;
      }

      const counts = {
        all: data?.length || 0,
        published: data?.filter(item => item.status === 'published').length || 0,
        pending_approval: data?.filter(item => item.status === 'pending_approval').length || 0,
        rejected: data?.filter(item => item.status === 'rejected').length || 0,
        draft: data?.filter(item => item.status === 'draft').length || 0
      };

      return counts;
    } catch (error) {
      console.error('è·å–å®¡æ‰¹ç»Ÿè®¡å¼‚å¸¸:', error);
      return {
        all: 0,
        published: 0,
        pending_approval: 0,
        rejected: 0,
        draft: 0
      };
    }
  }
}
```

### ä»»åŠ¡1.3ï¼šåˆ›å»ºå®¡æ‰¹ç±»å‹é€‰æ‹©å™¨ç»„ä»¶ã€å·²å®Œæˆã€‘

**æ–‡ä»¶ä½ç½®**ï¼š`src/components/approval/ApprovalTypeSelector.tsx`
**ä¾èµ–ç»„ä»¶**ï¼šæ— ï¼ˆè‡ªåŒ…å«ç»„ä»¶ï¼‰
**UIåº“**ï¼šä½¿ç”¨Arco Designçš„Selectå’ŒInputç»„ä»¶

```typescript
/**
 * å®¡æ‰¹ç±»å‹é€‰æ‹©å™¨ç»„ä»¶
 * æ”¯æŒé¢„è®¾ç±»å‹é€‰æ‹©å’Œè‡ªå®šä¹‰ç±»å‹è¾“å…¥
 */

import React, { useState, useEffect } from 'react';
import { Select, Input, Button } from '@arco-design/web-react';
import { Plus, Megaphone, DollarSign, Bell, Stamp, MessageSquare } from 'lucide-react';
import { APPROVAL_TYPE_CONFIGS, ApprovalType } from '../../types/approval';

interface ApprovalTypeSelectorProps {
  value?: string;
  predefinedType?: ApprovalType;
  onChange?: (type: string, predefinedType?: ApprovalType) => void;
  disabled?: boolean;
  className?: string;
}

// å›¾æ ‡æ˜ å°„
const iconMap = {
  'Megaphone': Megaphone,
  'DollarSign': DollarSign,
  'Bell': Bell,
  'Stamp': Stamp,
  'MessageSquare': MessageSquare
};

/**
 * å®¡æ‰¹ç±»å‹é€‰æ‹©å™¨ç»„ä»¶
 */
export const ApprovalTypeSelector: React.FC<ApprovalTypeSelectorProps> = ({
  value = '',
  predefinedType,
  onChange,
  disabled = false,
  className = ''
}) => {
  const [selectedMode, setSelectedMode] = useState<'predefined' | 'custom'>('predefined');
  const [customType, setCustomType] = useState('');
  const [selectedPredefined, setSelectedPredefined] = useState<ApprovalType | undefined>(predefinedType);

  // åˆå§‹åŒ–é€‰æ‹©æ¨¡å¼
  useEffect(() => {
    if (value) {
      const predefinedConfig = APPROVAL_TYPE_CONFIGS.find(config => config.key === value);
      if (predefinedConfig) {
        setSelectedMode('predefined');
        setSelectedPredefined(predefinedConfig.key);
      } else {
        setSelectedMode('custom');
        setCustomType(value);
      }
    }
  }, [value]);

  // å¤„ç†é¢„è®¾ç±»å‹é€‰æ‹©
  const handlePredefinedChange = (typeKey: ApprovalType) => {
    setSelectedPredefined(typeKey);
    const config = APPROVAL_TYPE_CONFIGS.find(c => c.key === typeKey);
    if (config && onChange) {
      onChange(config.label, typeKey);
    }
  };

  // å¤„ç†è‡ªå®šä¹‰ç±»å‹è¾“å…¥
  const handleCustomChange = (customValue: string) => {
    setCustomType(customValue);
    if (onChange) {
      onChange(customValue, undefined);
    }
  };

  // åˆ‡æ¢åˆ°è‡ªå®šä¹‰æ¨¡å¼
  const switchToCustom = () => {
    setSelectedMode('custom');
    setCustomType('');
    if (onChange) {
      onChange('', undefined);
    }
  };

  // åˆ‡æ¢åˆ°é¢„è®¾æ¨¡å¼
  const switchToPredefined = () => {
    setSelectedMode('predefined');
    setSelectedPredefined(undefined);
    if (onChange) {
      onChange('', undefined);
    }
  };

  return (
    <div className={`space-y-4 ${className}`}>
      {/* æ¨¡å¼åˆ‡æ¢æŒ‰é’® */}
      <div className="flex space-x-2">
        <Button
          size="small"
          type={selectedMode === 'predefined' ? 'primary' : 'secondary'}
          onClick={switchToPredefined}
          disabled={disabled}
        >
          é¢„è®¾ç±»å‹
        </Button>
        <Button
          size="small"
          type={selectedMode === 'custom' ? 'primary' : 'secondary'}
          onClick={switchToCustom}
          disabled={disabled}
          icon={<Plus className="w-4 h-4" />}
        >
          è‡ªå®šä¹‰ç±»å‹
        </Button>
      </div>

      {/* é¢„è®¾ç±»å‹é€‰æ‹© */}
      {selectedMode === 'predefined' && (
        <div className="grid grid-cols-2 gap-3">
          {APPROVAL_TYPE_CONFIGS.map((config) => {
            const IconComponent = iconMap[config.icon as keyof typeof iconMap];
            const isSelected = selectedPredefined === config.key;
            
            return (
              <button
                key={config.key}
                type="button"
                onClick={() => handlePredefinedChange(config.key)}
                disabled={disabled}
                className={`
                  p-4 rounded-lg border-2 transition-all duration-200 text-left
                  ${isSelected 
                    ? 'border-blue-500 bg-blue-50' 
                    : 'border-gray-200 hover:border-gray-300 bg-white'
                  }
                  ${disabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'}
                `}
              >
                <div className="flex items-start space-x-3">
                  <div className={`
                    w-10 h-10 rounded-lg flex items-center justify-center
                    ${isSelected ? 'bg-blue-100' : 'bg-gray-100'}
                  `}>
                    <IconComponent className={`
                      w-5 h-5 
                      ${isSelected ? 'text-blue-600' : 'text-gray-600'}
                    `} />
                  </div>
                  <div className="flex-1 min-w-0">
                    <h4 className={`
                      font-medium text-sm
                      ${isSelected ? 'text-blue-900' : 'text-gray-900'}
                    `}>
                      {config.label}
                    </h4>
                    <p className="text-xs text-gray-500 mt-1">
                      {config.description}
                    </p>
                  </div>
                </div>
              </button>
            );
          })}
        </div>
      )}

      {/* è‡ªå®šä¹‰ç±»å‹è¾“å…¥ */}
      {selectedMode === 'custom' && (
        <div>
          <Input
            placeholder="è¯·è¾“å…¥è‡ªå®šä¹‰å®¡æ‰¹ç±»å‹ï¼Œå¦‚ï¼šè®¾å¤‡é‡‡è´­ç”³è¯·ã€æ´»åŠ¨ç»„ç»‡ç”³è¯·ç­‰"
            value={customType}
            onChange={handleCustomChange}
            disabled={disabled}
            size="large"
            showWordLimit
            maxLength={20}
          />
          <p className="text-xs text-gray-500 mt-2">
            è‡ªå®šä¹‰ç±»å‹å°†ä½¿ç”¨é€šç”¨å›¾æ ‡å’Œæ ·å¼
          </p>
        </div>
      )}

      {/* å½“å‰é€‰æ‹©æ˜¾ç¤º */}
      {(selectedPredefined || customType) && (
        <div className="bg-gray-50 rounded-lg p-3">
          <div className="flex items-center space-x-2">
            <span className="text-sm text-gray-600">å½“å‰é€‰æ‹©ï¼š</span>
            <span className="font-medium text-gray-900">
              {selectedMode === 'predefined' 
                ? APPROVAL_TYPE_CONFIGS.find(c => c.key === selectedPredefined)?.label
                : customType
              }
            </span>
          </div>
        </div>
      )}
    </div>
  );
};

export default ApprovalTypeSelector;
```

## ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒç»„ä»¶å¼€å‘

### ä»»åŠ¡2.1ï¼šåˆ›å»ºå®¡æ‰¹è¡¨å•ç»„ä»¶ã€å·²å®Œæˆã€‘

**æ–‡ä»¶ä½ç½®**ï¼š`src/components/approval/ApprovalForm.tsx`
**å‚è€ƒæ–‡ä»¶**ï¼š`src/components/notification/NotificationForm.tsx`
**ä¾èµ–ç»„ä»¶**ï¼š
- `src/components/RichTextEditor.tsx` (å¯Œæ–‡æœ¬ç¼–è¾‘å™¨)
- `src/components/create/FileUploader.tsx` (æ–‡ä»¶ä¸Šä¼ )
- `src/components/approval/ApprovalTypeSelector.tsx` (ç±»å‹é€‰æ‹©å™¨)

```typescript
/**
 * å®¡æ‰¹è¡¨å•ç»„ä»¶
 * åŸºäºNotificationFormè®¾è®¡ï¼Œæ”¯æŒå¤šç§å®¡æ‰¹ç±»å‹
 */

import React, { useState, useEffect, forwardRef, useImperativeHandle } from 'react';
import { EditorState } from 'draft-js';
import { stateFromHTML } from 'draft-js-import-html';
import { toast } from 'sonner';
import { ArrowLeft, Send, Save, Maximize2, Minimize2, Users, Home, User } from 'lucide-react';
import { editorStateToHtml } from '../../utils/editorUtils';
import RichTextEditor from '../RichTextEditor';
import { FileUploader } from '../create';
import { ApprovalTypeSelector } from './ApprovalTypeSelector';
import { FileService } from '../../lib/database';
import { cn } from '../../lib/utils';
import { useStore } from '../../store';
import type {
  ApprovalFormData,
  ApprovalAudience,
  Approval,
  ApprovalType
} from '../../types/approval';

// åª’ä½“æ–‡ä»¶æ¥å£ï¼ˆå¤ç”¨NotificationFormçš„è®¾è®¡ï¼‰
interface MediaFile {
  id: string;
  name: string;
  type: string;
  size: number;
  url?: string;
  file?: File;
}

/**
 * è¡¨å•å¼•ç”¨æ¥å£
 */
export interface ApprovalFormRef {
  saveDraft: () => Promise<boolean>;
  submitForApproval: () => Promise<boolean>;
  getFormData: () => ApprovalFormData;
  resetForm: () => void;
  loadApproval: (approval: Approval) => void;
}

/**
 * è¡¨å•å±æ€§æ¥å£
 */
export interface ApprovalFormProps {
  mode?: 'create' | 'edit';
  initialData?: Partial<Approval>;
  relatedEventId?: string;
  onSaveDraft?: (data: ApprovalFormData) => Promise<boolean>;
  onSubmitForApproval?: (data: ApprovalFormData) => Promise<boolean>;
  onCancel?: () => void;
  className?: string;
}

/**
 * å®¡æ‰¹è¡¨å•ç»„ä»¶
 */
export const ApprovalForm = forwardRef<ApprovalFormRef, ApprovalFormProps>(({
  mode = 'create',
  initialData,
  relatedEventId,
  onSaveDraft,
  onSubmitForApproval,
  onCancel,
  className
}, ref) => {
  const { currentUser } = useStore();

  // ç¼–è¾‘å™¨çŠ¶æ€ï¼ˆå¤ç”¨NotificationFormçš„è®¾è®¡ï¼‰
  const [editorState, setEditorState] = useState(() => EditorState.createEmpty());
  const [title, setTitle] = useState('');
  const [content, setContent] = useState('');
  const [isFullscreen, setIsFullscreen] = useState(false);

  // å®¡æ‰¹ç‰¹æœ‰å­—æ®µ
  const [approvalType, setApprovalType] = useState('');
  const [predefinedType, setPredefinedType] = useState<ApprovalType | undefined>();
  const [targetAudience, setTargetAudience] = useState<ApprovalAudience>('all');
  const [targetDetails, setTargetDetails] = useState('');

  // åª’ä½“æ–‡ä»¶å’Œæ ‡ç­¾ï¼ˆå¤ç”¨NotificationFormçš„è®¾è®¡ï¼‰
  const [mediaFiles, setMediaFiles] = useState<MediaFile[]>([]);

  // ä¸Šä¼ çŠ¶æ€
  const [isUploadingFile, setIsUploadingFile] = useState(false);
  const [isSaving, setIsSaving] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);

  // ç›‘å¬ç¼–è¾‘å™¨çŠ¶æ€å˜åŒ–ï¼ˆå¤ç”¨NotificationFormçš„é€»è¾‘ï¼‰
  useEffect(() => {
    const plainText = editorState.getCurrentContent().getPlainText('\n');
    setContent(plainText);
  }, [editorState]);

  // åˆå§‹åŒ–æ•°æ®
  useEffect(() => {
    if (initialData) {
      setTitle(initialData.title || '');
      setApprovalType(initialData.approval_type || '');
      setPredefinedType(initialData.predefined_type);
      setTargetAudience(initialData.target_audience || 'all');
      setTargetDetails(initialData.target_details || '');

      // åˆå§‹åŒ–å¯Œæ–‡æœ¬å†…å®¹
      if (initialData.content) {
        const contentState = stateFromHTML(initialData.content);
        setEditorState(EditorState.createWithContent(contentState));
      }

      // åˆå§‹åŒ–é™„ä»¶
      if (initialData.attachments) {
        const files: MediaFile[] = initialData.attachments.map((att, index) => ({
          id: `existing-${index}`,
          name: att.name,
          type: att.type || 'application/octet-stream',
          size: att.size || 0,
          url: att.url
        }));
        setMediaFiles(files);
      }
    }
  }, [initialData]);

  // å¤„ç†å®¡æ‰¹ç±»å‹å˜åŒ–
  const handleTypeChange = (type: string, predefined?: ApprovalType) => {
    setApprovalType(type);
    setPredefinedType(predefined);
  };

  // å¤„ç†æ–‡ä»¶ä¸Šä¼ ï¼ˆå¤ç”¨NotificationFormçš„é€»è¾‘ï¼‰
  const handleAddFile = async (file: File) => {
    setIsUploadingFile(true);
    try {
      const uploadedFile = await FileService.uploadFile(file);
      const mediaFile: MediaFile = {
        id: Date.now().toString(),
        name: file.name,
        type: file.type,
        size: file.size,
        url: uploadedFile.url,
        file
      };
      setMediaFiles(prev => [...prev, mediaFile]);
      toast.success('æ–‡ä»¶ä¸Šä¼ æˆåŠŸ');
    } catch (error) {
      console.error('æ–‡ä»¶ä¸Šä¼ å¤±è´¥:', error);
      toast.error('æ–‡ä»¶ä¸Šä¼ å¤±è´¥');
    } finally {
      setIsUploadingFile(false);
    }
  };

  // å¤„ç†æ–‡ä»¶ç§»é™¤
  const handleRemoveFile = (fileId: string) => {
    setMediaFiles(prev => prev.filter(f => f.id !== fileId));
  };

  // è·å–è¡¨å•æ•°æ®
  const getFormData = (): ApprovalFormData => {
    const htmlContent = editorStateToHtml(editorState);
    return {
      title: title.trim(),
      content: htmlContent,
      approval_type: approvalType,
      predefined_type: predefinedType,
      target_audience: targetAudience,
      target_details: targetDetails,
      images: [], // å®¡æ‰¹ç³»ç»Ÿæš‚ä¸æ”¯æŒå†…è”å›¾ç‰‡
      attachments: mediaFiles.map(f => ({
        name: f.name,
        url: f.url || '',
        size: f.size,
        type: f.type
      })),
      related_event_id: relatedEventId,
      is_draft: false
    };
  };

  // ä¿å­˜è‰ç¨¿
  const saveDraft = async (): Promise<boolean> => {
    if (!title.trim()) {
      toast.error('è¯·è¾“å…¥æ ‡é¢˜');
      return false;
    }

    setIsSaving(true);
    try {
      const formData = { ...getFormData(), is_draft: true };
      const success = onSaveDraft ? await onSaveDraft(formData) : false;
      
      if (success) {
        toast.success('è‰ç¨¿ä¿å­˜æˆåŠŸ');
      } else {
        toast.error('è‰ç¨¿ä¿å­˜å¤±è´¥');
      }
      
      return success;
    } catch (error) {
      console.error('ä¿å­˜è‰ç¨¿å¤±è´¥:', error);
      toast.error('ä¿å­˜è‰ç¨¿å¤±è´¥');
      return false;
    } finally {
      setIsSaving(false);
    }
  };

  // æäº¤å®¡æ‰¹
  const submitForApproval = async (): Promise<boolean> => {
    // è¡¨å•éªŒè¯
    if (!title.trim()) {
      toast.error('è¯·è¾“å…¥æ ‡é¢˜');
      return false;
    }

    if (!content.trim()) {
      toast.error('è¯·è¾“å…¥å†…å®¹');
      return false;
    }

    if (!approvalType.trim()) {
      toast.error('è¯·é€‰æ‹©å®¡æ‰¹ç±»å‹');
      return false;
    }

    setIsSubmitting(true);
    try {
      const formData = getFormData();
      const success = onSubmitForApproval ? await onSubmitForApproval(formData) : false;
      
      if (success) {
        toast.success('æäº¤æˆåŠŸï¼Œå·²è¿›å…¥å®¡æ‰¹æµç¨‹');
      } else {
        toast.error('æäº¤å¤±è´¥');
      }
      
      return success;
    } catch (error) {
      console.error('æäº¤å®¡æ‰¹å¤±è´¥:', error);
      toast.error('æäº¤å¤±è´¥');
      return false;
    } finally {
      setIsSubmitting(false);
    }
  };

  // é‡ç½®è¡¨å•
  const resetForm = () => {
    setTitle('');
    setContent('');
    setApprovalType('');
    setPredefinedType(undefined);
    setTargetAudience('all');
    setTargetDetails('');
    setMediaFiles([]);
    setEditorState(EditorState.createEmpty());
  };

  // åŠ è½½å®¡æ‰¹æ•°æ®ï¼ˆç¼–è¾‘æ¨¡å¼ï¼‰
  const loadApproval = (approval: Approval) => {
    setTitle(approval.title);
    setApprovalType(approval.approval_type);
    setPredefinedType(approval.predefined_type);
    setTargetAudience(approval.target_audience);
    setTargetDetails(approval.target_details || '');

    if (approval.content) {
      const contentState = stateFromHTML(approval.content);
      setEditorState(EditorState.createWithContent(contentState));
    }

    if (approval.attachments) {
      const files: MediaFile[] = approval.attachments.map((att, index) => ({
        id: `loaded-${index}`,
        name: att.name,
        type: att.type || 'application/octet-stream',
        size: att.size || 0,
        url: att.url
      }));
      setMediaFiles(files);
    }
  };

  // æš´éœ²æ–¹æ³•ç»™çˆ¶ç»„ä»¶
  useImperativeHandle(ref, () => ({
    saveDraft,
    submitForApproval,
    getFormData,
    resetForm,
    loadApproval
  }));

  return (
    <div className={cn('min-h-screen bg-gray-50', className)}>
      {/* å¤´éƒ¨æ“ä½œæ  */}
      <div className="sticky top-0 z-10 bg-white border-b border-gray-200 px-4 py-3">
        <div className="flex items-center justify-between">
          <div className="flex items-center space-x-3">
            <button
              onClick={onCancel}
              className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
            >
              <ArrowLeft className="w-5 h-5 text-gray-600" />
            </button>
            <h1 className="text-lg font-semibold text-gray-900">
              {mode === 'edit' ? 'ç¼–è¾‘å®¡æ‰¹äº‹é¡¹' : 'åˆ›å»ºå®¡æ‰¹äº‹é¡¹'}
            </h1>
          </div>

          <div className="flex items-center space-x-2">
            {/* å…¨å±åˆ‡æ¢æŒ‰é’® */}
            <button
              onClick={() => setIsFullscreen(!isFullscreen)}
              className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
            >
              {isFullscreen ? (
                <Minimize2 className="w-5 h-5 text-gray-600" />
              ) : (
                <Maximize2 className="w-5 h-5 text-gray-600" />
              )}
            </button>

            {/* ä¿å­˜è‰ç¨¿æŒ‰é’® */}
            <button
              onClick={saveDraft}
              disabled={isSaving || isSubmitting}
              className="px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2"
            >
              <Save className="w-4 h-4" />
              <span>{isSaving ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜è‰ç¨¿'}</span>
            </button>

            {/* æäº¤å®¡æ‰¹æŒ‰é’® */}
            <button
              onClick={submitForApproval}
              disabled={isSaving || isSubmitting}
              className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2"
            >
              <Send className="w-4 h-4" />
              <span>{isSubmitting ? 'æäº¤ä¸­...' : 'æäº¤å®¡æ‰¹'}</span>
            </button>
          </div>
        </div>
      </div>

      {/* ä¸»è¦å†…å®¹åŒºåŸŸ */}
      <div className="max-w-4xl mx-auto px-4 py-6">
        <div className="bg-white rounded-lg shadow-sm border border-gray-200">
          <div className="p-6 space-y-6">
            {/* å®¡æ‰¹ç±»å‹é€‰æ‹© */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">
                å®¡æ‰¹ç±»å‹ <span className="text-red-500">*</span>
              </label>
              <ApprovalTypeSelector
                value={approvalType}
                predefinedType={predefinedType}
                onChange={handleTypeChange}
                disabled={isSaving || isSubmitting}
              />
            </div>

            {/* æ ‡é¢˜è¾“å…¥ */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                æ ‡é¢˜ <span className="text-red-500">*</span>
              </label>
              <input
                type="text"
                value={title}
                onChange={(e) => setTitle(e.target.value)}
                placeholder="è¯·è¾“å…¥å®¡æ‰¹äº‹é¡¹æ ‡é¢˜"
                maxLength={100}
                disabled={isSaving || isSubmitting}
                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:text-gray-500"
              />
              <div className="flex justify-between items-center mt-1">
                <p className="text-xs text-gray-500">ç®€æ˜æ‰¼è¦åœ°æè¿°å®¡æ‰¹äº‹é¡¹</p>
                <span className="text-xs text-gray-400">{title.length}/100</span>
              </div>
            </div>

            {/* å¯Œæ–‡æœ¬å†…å®¹ç¼–è¾‘ */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                è¯¦ç»†å†…å®¹ <span className="text-red-500">*</span>
              </label>
              <div className="border border-gray-300 rounded-lg overflow-hidden">
                <RichTextEditor
                  editorState={editorState}
                  onChange={setEditorState}
                  isFullscreen={isFullscreen}
                  onFullscreenChange={setIsFullscreen}
                  showTitleInput={false}
                  placeholder="è¯·è¯¦ç»†æè¿°å®¡æ‰¹äº‹é¡¹çš„å…·ä½“å†…å®¹ã€åŸå› ã€é¢„æœŸæ•ˆæœç­‰..."
                />
              </div>
            </div>

            {/* ç›®æ ‡å—ä¼—é€‰æ‹© */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">
                ç›®æ ‡å—ä¼—
              </label>
              <div className="space-y-3">
                <div className="flex space-x-4">
                  <label className="flex items-center space-x-2 cursor-pointer">
                    <input
                      type="radio"
                      name="audience"
                      value="all"
                      checked={targetAudience === 'all'}
                      onChange={(e) => setTargetAudience(e.target.value as ApprovalAudience)}
                      className="w-4 h-4 text-blue-600"
                    />
                    <Users className="w-4 h-4 text-gray-500" />
                    <span className="text-sm text-gray-700">å…¨ä½“ä¸šä¸»</span>
                  </label>
                  
                  <label className="flex items-center space-x-2 cursor-pointer">
                    <input
                      type="radio"
                      name="audience"
                      value="building"
                      checked={targetAudience === 'building'}
                      onChange={(e) => setTargetAudience(e.target.value as ApprovalAudience)}
                      className="w-4 h-4 text-blue-600"
                    />
                    <Home className="w-4 h-4 text-gray-500" />
                    <span className="text-sm text-gray-700">ç‰¹å®šæ¥¼æ ‹</span>
                  </label>
                  
                  <label className="flex items-center space-x-2 cursor-pointer">
                    <input
                      type="radio"
                      name="audience"
                      value="role"
                      checked={targetAudience === 'role'}
                      onChange={(e) => setTargetAudience(e.target.value as ApprovalAudience)}
                      className="w-4 h-4 text-blue-600"
                    />
                    <User className="w-4 h-4 text-gray-500" />
                    <span className="text-sm text-gray-700">ç‰¹å®šè§’è‰²</span>
                  </label>
                </div>

                {/* å—ä¼—è¯¦æƒ…è¾“å…¥ */}
                {(targetAudience === 'building' || targetAudience === 'role') && (
                  <input
                    type="text"
                    value={targetDetails}
                    onChange={(e) => setTargetDetails(e.target.value)}
                    placeholder={
                      targetAudience === 'building' 
                        ? 'è¯·è¾“å…¥æ¥¼æ ‹å·ï¼Œå¦‚ï¼šAæ ‹ã€Bæ ‹' 
                        : 'è¯·è¾“å…¥è§’è‰²ï¼Œå¦‚ï¼šä¸šå§”ä¼šæˆå‘˜ã€ç‰©ä¸šäººå‘˜'
                    }
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  />
                )}
              </div>
            </div>

            {/* æ–‡ä»¶é™„ä»¶ */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">
                é™„ä»¶æ–‡ä»¶
              </label>
              <FileUploader
                mediaFiles={mediaFiles}
                onAddMediaFile={handleAddFile}
                onRemoveMediaFile={handleRemoveFile}
                isUploading={isUploadingFile}
                maxFiles={10}
                maxFileSize={50}
                disabled={isSaving || isSubmitting}
              />
            </div>
          </div>
        </div>
      </div>
    </div>
  );
});

ApprovalForm.displayName = 'ApprovalForm';

export default ApprovalForm;
```

## ç¬¬ä¸‰é˜¶æ®µï¼šé¡µé¢å¼€å‘

### ä»»åŠ¡3.1ï¼šåˆ›å»ºå®¡æ‰¹åˆ›å»ºé¡µé¢ã€å·²å®Œæˆã€‘

**æ–‡ä»¶ä½ç½®**ï¼š`src/pages/approval/ApprovalCreate.tsx`
**å‚è€ƒæ–‡ä»¶**ï¼š`src/pages/NotificationCreate.tsx`
**è·¯ç”±è·¯å¾„**ï¼š`/approval/create`

```typescript
/**
 * å®¡æ‰¹åˆ›å»ºé¡µé¢
 * åŸºäºNotificationCreateè®¾è®¡ï¼Œæ”¯æŒå¤šç§å®¡æ‰¹ç±»å‹åˆ›å»º
 */

import React, { useRef, useEffect } from 'react';
import { useNavigate, useParams, useSearchParams } from 'react-router-dom';
import { toast } from 'sonner';
import { useStore } from '../../store';
import { ApprovalForm, ApprovalFormRef } from '../../components/approval/ApprovalForm';
import { ApprovalService } from '../../services/ApprovalService';
// import { ApprovalWorkflowService } from '../../services/ApprovalWorkflowService'; // å¤ç”¨ç°æœ‰æœåŠ¡
import type { ApprovalFormData } from '../../types/approval';

/**
 * å®¡æ‰¹åˆ›å»ºé¡µé¢ç»„ä»¶
 */
export const ApprovalCreate: React.FC = () => {
  const navigate = useNavigate();
  const { id } = useParams<{ id?: string }>();
  const [searchParams] = useSearchParams();
  const isEdit = !!id;

  const { currentUser } = useStore();
  const formRef = useRef<ApprovalFormRef>(null);

  // æƒé™æ£€æŸ¥ï¼ˆå¤ç”¨NotificationCreateçš„é€»è¾‘ï¼‰
  useEffect(() => {
    if (!currentUser || currentUser.role !== 'COMMITTEE_MEMBER') {
      toast.error('åªæœ‰ä¸šå§”ä¼šæˆå‘˜å¯ä»¥åˆ›å»ºå®¡æ‰¹äº‹é¡¹');
      navigate('/');
      return;
    }

    // å¦‚æœæ˜¯ç¼–è¾‘æ¨¡å¼ï¼ŒåŠ è½½ç°æœ‰å®¡æ‰¹äº‹é¡¹
    if (isEdit && id) {
      loadApproval(id);
    }
  }, [currentUser, isEdit, id, navigate]);

  /**
   * åŠ è½½ç°æœ‰å®¡æ‰¹äº‹é¡¹ï¼ˆç¼–è¾‘æ¨¡å¼ï¼‰
   */
  const loadApproval = async (approvalId: string) => {
    try {
      const approval = await ApprovalService.getApprovalById(approvalId, currentUser?.id);
      if (!approval) {
        toast.error('å®¡æ‰¹äº‹é¡¹ä¸å­˜åœ¨');
        navigate('/approval/list');
        return;
      }

      // æ£€æŸ¥ç¼–è¾‘æƒé™
      if (approval.author_id !== currentUser?.id) {
        toast.error('æ‚¨åªèƒ½ç¼–è¾‘è‡ªå·±åˆ›å»ºçš„å®¡æ‰¹äº‹é¡¹');
        navigate('/approval/list');
        return;
      }

      // åªæœ‰è‰ç¨¿çŠ¶æ€çš„å®¡æ‰¹äº‹é¡¹å¯ä»¥ç¼–è¾‘
      if (approval.status !== 'draft') {
        toast.error('åªæœ‰è‰ç¨¿çŠ¶æ€çš„å®¡æ‰¹äº‹é¡¹å¯ä»¥ç¼–è¾‘');
        navigate('/approval/list');
        return;
      }

      // åŠ è½½æ•°æ®åˆ°è¡¨å•
      formRef.current?.loadApproval(approval);
    } catch (error) {
      console.error('åŠ è½½å®¡æ‰¹äº‹é¡¹å¤±è´¥:', error);
      toast.error('åŠ è½½å®¡æ‰¹äº‹é¡¹å¤±è´¥');
      navigate('/approval/list');
    }
  };

  /**
   * ä¿å­˜è‰ç¨¿
   */
  const handleSaveDraft = async (formData: ApprovalFormData): Promise<boolean> => {
    try {
      let success;
      if (isEdit && id) {
        const result = await ApprovalService.updateApproval(id, formData);
        success = !!result;
      } else {
        const result = await ApprovalService.createApproval(formData, currentUser!.id);
        success = !!result;
      }

      if (success) {
        navigate('/approval/list');
        return true;
      }
      return false;
    } catch (error) {
      console.error('ä¿å­˜è‰ç¨¿å¤±è´¥:', error);
      return false;
    }
  };

  /**
   * æäº¤å®¡æ‰¹
   */
  const handleSubmitForApproval = async (formData: ApprovalFormData): Promise<boolean> => {
    try {
      let approval;
      if (isEdit && id) {
        approval = await ApprovalService.updateApproval(id, { ...formData, is_draft: false });
      } else {
        approval = await ApprovalService.createApproval({ ...formData, is_draft: false }, currentUser!.id);
      }

      if (approval) {
        // åˆ›å»ºå®¡æ‰¹å·¥ä½œæµï¼ˆå¤ç”¨ç°æœ‰çš„ApprovalWorkflowServiceï¼‰
        // const workflowCreated = await ApprovalWorkflowService.createWorkflow(approval.id);
        // if (workflowCreated) {
          navigate('/approval/list?tab=pending_approval');
          return true;
        // }
      }
      return false;
    } catch (error) {
      console.error('æäº¤å®¡æ‰¹å¤±è´¥:', error);
      return false;
    }
  };

  /**
   * å–æ¶ˆæ“ä½œ
   */
  const handleCancel = () => {
    navigate('/approval/list');
  };

  if (!currentUser || currentUser.role !== 'COMMITTEE_MEMBER') {
    return null;
  }

  // è·å–äº‹ä»¶IDå‚æ•°
  const eventId = searchParams.get('eventId');

  return (
    <ApprovalForm
      ref={formRef}
      mode={isEdit ? 'edit' : 'create'}
      relatedEventId={eventId || undefined}
      onSaveDraft={handleSaveDraft}
      onSubmitForApproval={handleSubmitForApproval}
      onCancel={handleCancel}
    />
  );
};

export default ApprovalCreate;
```

### ä»»åŠ¡3.2ï¼šåˆ›å»ºå®¡æ‰¹å¡ç‰‡ç»„ä»¶ã€å·²å®Œæˆã€‘

**æ–‡ä»¶ä½ç½®**ï¼š`src/components/approval/ApprovalCard.tsx`
**å‚è€ƒæ–‡ä»¶**ï¼š`src/components/notification/NotificationCard.tsx`

```typescript
/**
 * å®¡æ‰¹å¡ç‰‡ç»„ä»¶
 * åŸºäºNotificationCardè®¾è®¡ï¼Œé€‚é…å®¡æ‰¹äº‹é¡¹å±•ç¤º
 */

import React from 'react';
import { formatDistanceToNow } from 'date-fns';
import { zhCN } from 'date-fns/locale';
import { 
  Clock, 
  Eye, 
  ThumbsUp, 
  ThumbsDown, 
  Pin, 
  MoreHorizontal,
  CheckCircle,
  XCircle,
  AlertCircle,
  FileText,
  Megaphone,
  DollarSign,
  Bell,
  Stamp,
  MessageSquare
} from 'lucide-react';
import { Button, Dropdown, Menu } from '@arco-design/web-react';
import { cn } from '../../lib/utils';
import type { Approval, ApprovalType } from '../../types/approval';

interface ApprovalCardProps {
  approval: Approval;
  onClick?: (approval: Approval) => void;
  onLike?: (approvalId: string) => void;
  onDislike?: (approvalId: string) => void;
  onPin?: (approvalId: string) => void;
  showActions?: boolean;
  className?: string;
}

// çŠ¶æ€é¢œè‰²æ˜ å°„
const statusColors = {
  draft: 'bg-gray-100 text-gray-700',
  pending_approval: 'bg-yellow-100 text-yellow-800',
  approved: 'bg-green-100 text-green-800',
  published: 'bg-blue-100 text-blue-800',
  rejected: 'bg-red-100 text-red-800'
};

// çŠ¶æ€å›¾æ ‡æ˜ å°„
const statusIcons = {
  draft: FileText,
  pending_approval: AlertCircle,
  approved: CheckCircle,
  published: CheckCircle,
  rejected: XCircle
};

// çŠ¶æ€æ–‡æœ¬æ˜ å°„
const statusTexts = {
  draft: 'è‰ç¨¿',
  pending_approval: 'å®¡æ‰¹ä¸­',
  approved: 'å·²é€šè¿‡',
  published: 'å·²å‘å¸ƒ',
  rejected: 'å·²æ‹’ç»'
};

// ç±»å‹å›¾æ ‡æ˜ å°„
const typeIcons = {
  announcement: Megaphone,
  expense: DollarSign,
  notification: Bell,
  seal: Stamp,
  survey: MessageSquare,
  general: FileText
};

/**
 * å®¡æ‰¹å¡ç‰‡ç»„ä»¶
 */
export const ApprovalCard: React.FC<ApprovalCardProps> = ({
  approval,
  onClick,
  onLike,
  onDislike,
  onPin,
  showActions = true,
  className
}) => {
  const StatusIcon = statusIcons[approval.status];
  const TypeIcon = typeIcons[approval.predefined_type as keyof typeof typeIcons] || FileText;

  // å¤„ç†å¡ç‰‡ç‚¹å‡»
  const handleCardClick = (e: React.MouseEvent) => {
    // å¦‚æœç‚¹å‡»çš„æ˜¯æŒ‰é’®æˆ–ä¸‹æ‹‰èœå•ï¼Œä¸è§¦å‘å¡ç‰‡ç‚¹å‡»
    if ((e.target as HTMLElement).closest('button') || (e.target as HTMLElement).closest('.arco-dropdown')) {
      return;
    }
    onClick?.(approval);
  };

  // å¤„ç†ç‚¹èµ
  const handleLike = (e: React.MouseEvent) => {
    e.stopPropagation();
    onLike?.(approval.id);
  };

  // å¤„ç†ç‚¹è¸©
  const handleDislike = (e: React.MouseEvent) => {
    e.stopPropagation();
    onDislike?.(approval.id);
  };

  // å¤„ç†ç½®é¡¶
  const handlePin = () => {
    onPin?.(approval.id);
  };

  // æ›´å¤šèœå•
  const moreMenu = (
    <Menu>
      <Menu.Item key="pin" onClick={handlePin}>
        <Pin className="w-4 h-4 mr-2" />
        {approval.is_pinned ? 'å–æ¶ˆç½®é¡¶' : 'ç½®é¡¶'}
      </Menu.Item>
    </Menu>
  );

  return (
    <div
      className={cn(
        'bg-white border border-gray-200 hover:border-gray-300 transition-all duration-200 cursor-pointer',
        approval.is_pinned && 'ring-2 ring-orange-200 border-orange-300',
        className
      )}
      onClick={handleCardClick}
    >
      <div className="p-4">
        {/* å¤´éƒ¨ä¿¡æ¯ */}
        <div className="flex items-start justify-between mb-3">
          <div className="flex items-center space-x-3 flex-1 min-w-0">
            {/* ç±»å‹å›¾æ ‡ */}
            <div className="flex-shrink-0">
              <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                <TypeIcon className="w-5 h-5 text-blue-600" />
              </div>
            </div>

            {/* æ ‡é¢˜å’Œç±»å‹ */}
            <div className="flex-1 min-w-0">
              <div className="flex items-center space-x-2 mb-1">
                <h3 className="text-base font-medium text-gray-900 truncate">
                  {approval.title}
                </h3>
                {approval.is_pinned && (
                  <Pin className="w-4 h-4 text-orange-500 flex-shrink-0" />
                )}
              </div>
              <div className="flex items-center space-x-2">
                <span className="text-sm text-blue-600 font-medium">
                  {approval.approval_type}
                </span>
                <span className="text-sm text-gray-400">â€¢</span>
                <span className="text-sm text-gray-500">
                  {approval.author.name}
                </span>
              </div>
            </div>
          </div>

          {/* çŠ¶æ€å’Œæ›´å¤šæ“ä½œ */}
          <div className="flex items-center space-x-2 flex-shrink-0">
            {/* çŠ¶æ€æ ‡ç­¾ */}
            <div className={cn(
              'inline-flex items-center px-2 py-1 rounded-full text-xs font-medium',
              statusColors[approval.status]
            )}>
              <StatusIcon className="w-3 h-3 mr-1" />
              {statusTexts[approval.status]}
            </div>

            {/* æ›´å¤šæ“ä½œ */}
            {showActions && (
              <Dropdown droplist={moreMenu} trigger="click" position="bottom">
                <Button
                  type="text"
                  size="small"
                  icon={<MoreHorizontal className="w-4 h-4" />}
                  className="opacity-0 group-hover:opacity-100 transition-opacity"
                />
              </Dropdown>
            )}
          </div>
        </div>

        {/* å†…å®¹é¢„è§ˆ */}
        <div className="mb-3">
          <p className="text-sm text-gray-600 line-clamp-2">
            {approval.content?.replace(/<[^>]*>/g, '') || 'æš‚æ— å†…å®¹æè¿°'}
          </p>
        </div>

        {/* åº•éƒ¨ç»Ÿè®¡å’Œæ“ä½œ */}
        <div className="flex items-center justify-between">
          {/* å·¦ä¾§ç»Ÿè®¡ */}
          <div className="flex items-center space-x-4 text-sm text-gray-500">
            {/* æµè§ˆé‡ */}
            <div className="flex items-center space-x-1">
              <Eye className="w-4 h-4" />
              <span>{approval.view_count || 0}</span>
            </div>

            {/* æ—¶é—´ */}
            <div className="flex items-center space-x-1">
              <Clock className="w-4 h-4" />
              <span>
                {formatDistanceToNow(new Date(approval.created_at), {
                  addSuffix: true,
                  locale: zhCN
                })}
              </span>
            </div>

            {/* å®¡æ‰¹è¿›åº¦ï¼ˆä»…å®¡æ‰¹ä¸­çŠ¶æ€æ˜¾ç¤ºï¼‰ */}
            {approval.status === 'pending_approval' && approval.approval_stats && (
              <div className="text-yellow-600 font-medium">
                æŠ•ç¥¨ä¸­ ({approval.approval_stats.voted_count}/{approval.approval_stats.total_committee_members})
              </div>
            )}
          </div>

          {/* å³ä¾§äº¤äº’æŒ‰é’® */}
          {showActions && (
            <div className="flex items-center space-x-2">
              {/* ç‚¹èµæŒ‰é’® */}
              <Button
                type="text"
                size="small"
                icon={<ThumbsUp className="w-4 h-4" />}
                onClick={handleLike}
                className={cn(
                  'text-gray-500 hover:text-blue-600',
                  approval.user_interaction === 'like' && 'text-blue-600'
                )}
              >
                {approval.like_count || 0}
              </Button>

              {/* ç‚¹è¸©æŒ‰é’® */}
              <Button
                type="text"
                size="small"
                icon={<ThumbsDown className="w-4 h-4" />}
                onClick={handleDislike}
                className={cn(
                  'text-gray-500 hover:text-red-600',
                  approval.user_interaction === 'dislike' && 'text-red-600'
                )}
              >
                {approval.dislike_count || 0}
              </Button>
            </div>
          )}
        </div>

        {/* æœªè¯»æŒ‡ç¤ºå™¨ */}
        {!approval.is_read && (
          <div className="absolute top-4 left-0 w-1 h-8 bg-blue-500 rounded-r" />
        )}
      </div>
    </div>
  );
};

export default ApprovalCard;
```

## ç¬¬å››é˜¶æ®µï¼šæ•°æ®åº“å’ŒçŠ¶æ€ç®¡ç†

### ä»»åŠ¡4.1ï¼šæ•°æ®åº“è¡¨åˆ›å»ºã€å·²å®Œæˆã€‘

**æ–‡ä»¶ä½ç½®**ï¼šåœ¨æ•°æ®åº“ä¸­æ‰§è¡Œä»¥ä¸‹SQLè¯­å¥

```sql
-- åˆ›å»ºå®¡æ‰¹äº‹é¡¹è¡¨ï¼ˆç‹¬ç«‹äºnotificationsè¡¨ï¼‰
CREATE TABLE approvals (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  title TEXT NOT NULL,
  content TEXT NOT NULL,
  approval_type TEXT NOT NULL DEFAULT 'general',
  predefined_type TEXT, -- é¢„è®¾ç±»å‹ï¼Œå¯ä¸ºç©º
  status TEXT NOT NULL DEFAULT 'draft',
  author_id UUID REFERENCES users(id) ON DELETE CASCADE,
  target_audience TEXT DEFAULT 'all',
  target_details TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  published_at TIMESTAMP WITH TIME ZONE,
  is_pinned BOOLEAN DEFAULT FALSE,
  images TEXT[] DEFAULT '{}',
  attachments JSONB DEFAULT '[]',
  ai_summary TEXT,
  view_count INTEGER DEFAULT 0,
  like_count INTEGER DEFAULT 0,
  dislike_count INTEGER DEFAULT 0,
  read_count INTEGER DEFAULT 0,
  unread_count INTEGER DEFAULT 0,
  related_event_id UUID
);

-- åˆ›å»ºå®¡æ‰¹è®°å½•è¡¨ï¼ˆå¤ç”¨ç°æœ‰è®¾è®¡ï¼‰
CREATE TABLE approval_records (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  approval_id UUID REFERENCES approvals(id) ON DELETE CASCADE,
  workflow_id UUID, -- å·¥ä½œæµID
  approver_id UUID REFERENCES users(id) ON DELETE CASCADE,
  vote TEXT NOT NULL CHECK (vote IN ('approve', 'reject', 'abstain')),
  comment TEXT,
  voted_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- åˆ›å»ºå®¡æ‰¹å·¥ä½œæµè¡¨
CREATE TABLE approval_workflows (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  approval_id UUID REFERENCES approvals(id) ON DELETE CASCADE,
  status TEXT NOT NULL DEFAULT 'pending' CHECK (status IN ('pending', 'approved', 'rejected')),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- åˆ›å»ºç”¨æˆ·äº¤äº’è¡¨ï¼ˆç‚¹èµç‚¹è¸©ï¼‰
CREATE TABLE approval_user_interactions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  approval_id UUID REFERENCES approvals(id) ON DELETE CASCADE,
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  interaction TEXT NOT NULL CHECK (interaction IN ('like', 'dislike')),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(approval_id, user_id) -- æ¯ä¸ªç”¨æˆ·å¯¹æ¯ä¸ªå®¡æ‰¹äº‹é¡¹åªèƒ½æœ‰ä¸€ç§äº¤äº’
);

-- åˆ›å»ºé˜…è¯»è®°å½•è¡¨
CREATE TABLE approval_reads (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  approval_id UUID REFERENCES approvals(id) ON DELETE CASCADE,
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  read_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(approval_id, user_id)
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_approvals_status ON approvals(status);
CREATE INDEX idx_approvals_type ON approvals(approval_type);
CREATE INDEX idx_approvals_author ON approvals(author_id);
CREATE INDEX idx_approvals_created_at ON approvals(created_at DESC);
CREATE INDEX idx_approval_records_approval_id ON approval_records(approval_id);
CREATE INDEX idx_approval_workflows_approval_id ON approval_workflows(approval_id);

-- åˆ›å»ºRLSç­–ç•¥ï¼ˆåŸºäºé€šçŸ¥ç³»ç»Ÿçš„æƒé™è®¾è®¡ï¼‰
ALTER TABLE approvals ENABLE ROW LEVEL SECURITY;
ALTER TABLE approval_records ENABLE ROW LEVEL SECURITY;
ALTER TABLE approval_workflows ENABLE ROW LEVEL SECURITY;
ALTER TABLE approval_user_interactions ENABLE ROW LEVEL SECURITY;
ALTER TABLE approval_reads ENABLE ROW LEVEL SECURITY;

-- å®¡æ‰¹äº‹é¡¹æŸ¥çœ‹ç­–ç•¥
CREATE POLICY "å®¡æ‰¹äº‹é¡¹æŸ¥çœ‹ç­–ç•¥" ON approvals FOR SELECT USING (
  -- å·²å‘å¸ƒçš„å®¡æ‰¹äº‹é¡¹æ‰€æœ‰äººå¯è§
  status = 'published' OR
  -- ä¸šå§”ä¼šæˆå‘˜å¯ä»¥æŸ¥çœ‹æ‰€æœ‰çŠ¶æ€çš„å®¡æ‰¹äº‹é¡¹
  EXISTS (
    SELECT 1 FROM users 
    WHERE users.id = auth.uid() 
    AND users.role = 'COMMITTEE_MEMBER'
  ) OR
  -- åˆ›å»ºè€…å¯ä»¥æŸ¥çœ‹è‡ªå·±çš„å®¡æ‰¹äº‹é¡¹
  author_id = auth.uid()
);

-- å®¡æ‰¹äº‹é¡¹åˆ›å»ºç­–ç•¥
CREATE POLICY "å®¡æ‰¹äº‹é¡¹åˆ›å»ºç­–ç•¥" ON approvals FOR INSERT WITH CHECK (
  EXISTS (
    SELECT 1 FROM users 
    WHERE users.id = auth.uid() 
    AND users.role = 'COMMITTEE_MEMBER'
  ) AND author_id = auth.uid()
);

-- å®¡æ‰¹äº‹é¡¹æ›´æ–°ç­–ç•¥
CREATE POLICY "å®¡æ‰¹äº‹é¡¹æ›´æ–°ç­–ç•¥" ON approvals FOR UPDATE USING (
  -- åªæœ‰åˆ›å»ºè€…å¯ä»¥æ›´æ–°è‡ªå·±çš„å®¡æ‰¹äº‹é¡¹
  author_id = auth.uid() OR
  -- æˆ–è€…æ˜¯ä¸šå§”ä¼šæˆå‘˜ï¼ˆç”¨äºç®¡ç†å‘˜æ“ä½œï¼‰
  EXISTS (
    SELECT 1 FROM users 
    WHERE users.id = auth.uid() 
    AND users.role = 'COMMITTEE_MEMBER'
  )
);

-- å®¡æ‰¹è®°å½•ç­–ç•¥
CREATE POLICY "å®¡æ‰¹è®°å½•æŸ¥çœ‹ç­–ç•¥" ON approval_records FOR SELECT USING (
  -- ä¸šå§”ä¼šæˆå‘˜å¯ä»¥æŸ¥çœ‹æ‰€æœ‰å®¡æ‰¹è®°å½•
  EXISTS (
    SELECT 1 FROM users 
    WHERE users.id = auth.uid() 
    AND users.role = 'COMMITTEE_MEMBER'
  )
);

CREATE POLICY "å®¡æ‰¹è®°å½•åˆ›å»ºç­–ç•¥" ON approval_records FOR INSERT WITH CHECK (
  -- åªæœ‰ä¸šå§”ä¼šæˆå‘˜å¯ä»¥æŠ•ç¥¨
  EXISTS (
    SELECT 1 FROM users 
    WHERE users.id = auth.uid() 
    AND users.role = 'COMMITTEE_MEMBER'
  ) AND approver_id = auth.uid()
);

-- ç”¨æˆ·äº¤äº’ç­–ç•¥
CREATE POLICY "ç”¨æˆ·äº¤äº’ç­–ç•¥" ON approval_user_interactions FOR ALL USING (
  user_id = auth.uid()
);

-- é˜…è¯»è®°å½•ç­–ç•¥
CREATE POLICY "é˜…è¯»è®°å½•ç­–ç•¥" ON approval_reads FOR ALL USING (
  user_id = auth.uid()
);
```

### ä»»åŠ¡4.2ï¼šçŠ¶æ€ç®¡ç†æ‰©å±•ã€å·²å®Œæˆã€‘

**æ–‡ä»¶ä½ç½®**ï¼š`src/store/index.ts`ï¼ˆåœ¨ç°æœ‰storeä¸­æ·»åŠ ï¼‰
**ä¿®æ”¹è¯´æ˜**ï¼šåœ¨ç°æœ‰çš„useStoreä¸­æ·»åŠ å®¡æ‰¹ç›¸å…³çŠ¶æ€å’Œæ–¹æ³•

```typescript
// åœ¨ç°æœ‰çš„storeæ¥å£ä¸­æ·»åŠ å®¡æ‰¹ç›¸å…³çŠ¶æ€
interface AppState {
  // ... ç°æœ‰çŠ¶æ€ ...
  
  // å®¡æ‰¹ç›¸å…³çŠ¶æ€
  approvals: Approval[];
  pinnedApprovals: Approval[];
  currentApproval: Approval | null;
  approvalWorkflows: ApprovalWorkflow[];
  approvalStats: Record<string, ApprovalStats>;
  unreadApprovalCount: number;
  approvalQueryParams: ApprovalQueryParams;
  isApprovalLoading: boolean;
  approvalError: string | null;
  
  // å®¡æ‰¹CRUDæ“ä½œ
  setApprovals: (approvals: Approval[]) => void;
  addApproval: (formData: ApprovalFormData) => Promise<Approval | null>;
  updateApproval: (id: string, updates: Partial<ApprovalFormData>) => Promise<Approval | null>;
  deleteApproval: (id: string) => Promise<boolean>;
  getApprovals: (params?: ApprovalQueryParams) => Promise<void>;
  getApprovalById: (id: string) => Promise<Approval | null>;
  
  // å®¡æ‰¹çŠ¶æ€ç®¡ç†
  publishApproval: (id: string) => Promise<boolean>;
  markApprovalAsRead: (id: string) => Promise<boolean>;
  toggleApprovalSubscription: (id: string) => Promise<boolean>;
  
  // å®¡æ‰¹æµç¨‹
  submitApprovalForApproval: (id: string) => Promise<boolean>;
  voteOnApproval: (id: string, vote: ApprovalVote, comment?: string) => Promise<boolean>;
  
  // å®¡æ‰¹TabçŠ¶æ€ç®¡ç†
  activeApprovalTab: ApprovalStatus | 'all';
  setActiveApprovalTab: (tab: ApprovalStatus | 'all') => void;
  getFilteredApprovals: () => Approval[];
  approvalCounts: {
    all: number;
    published: number;
    pending_approval: number;
    rejected: number;
    draft: number;
  };
  getApprovalCounts: () => typeof approvalCounts;
  loadApprovalCounts: (userId?: string) => Promise<void>;
}

// åœ¨ç°æœ‰çš„useStoreå®ç°ä¸­æ·»åŠ å®¡æ‰¹æ–¹æ³•
export const useStore = create<AppState>((set, get) => ({
  // ... ç°æœ‰å®ç° ...
  
  // å®¡æ‰¹ç›¸å…³çŠ¶æ€åˆå§‹åŒ–
  approvals: [],
  pinnedApprovals: [],
  currentApproval: null,
  approvalWorkflows: [],
  approvalStats: {},
  unreadApprovalCount: 0,
  approvalQueryParams: {
    page: 1,
    limit: 20,
    sort_by: 'created_at',
    sort_order: 'desc'
  },
  isApprovalLoading: false,
  approvalError: null,
  activeApprovalTab: 'all',
  approvalCounts: {
    all: 0,
    published: 0,
    pending_approval: 0,
    rejected: 0,
    draft: 0
  },
  
  // å®¡æ‰¹CRUDæ“ä½œå®ç°
  setApprovals: (approvals) => set({ approvals }),
  
  addApproval: async (formData) => {
    const state = get();
    if (!state.currentUser) {
      console.error('ç”¨æˆ·æœªç™»å½•');
      return null;
    }
    
    try {
      set({ isApprovalLoading: true, approvalError: null });
      const approval = await ApprovalService.createApproval(formData, state.currentUser.id);
      
      if (approval) {
        set(state => ({
          approvals: [approval, ...state.approvals],
          isApprovalLoading: false
        }));
      }
      
      return approval;
    } catch (error) {
      console.error('åˆ›å»ºå®¡æ‰¹äº‹é¡¹å¤±è´¥:', error);
      set({ 
        isApprovalLoading: false, 
        approvalError: error instanceof Error ? error.message : 'åˆ›å»ºå®¡æ‰¹äº‹é¡¹å¤±è´¥' 
      });
      return null;
    }
  },
  
  updateApproval: async (id, updates) => {
    try {
      set({ isApprovalLoading: true, approvalError: null });
      const updatedApproval = await ApprovalService.updateApproval(id, updates);
      
      if (updatedApproval) {
        set(state => ({
          approvals: state.approvals.map(a => 
            a.id === id ? updatedApproval : a
          ),
          isApprovalLoading: false
        }));
      }
      
      return updatedApproval;
    } catch (error) {
      console.error('æ›´æ–°å®¡æ‰¹äº‹é¡¹å¤±è´¥:', error);
      set({ 
        isApprovalLoading: false, 
        approvalError: error instanceof Error ? error.message : 'æ›´æ–°å®¡æ‰¹äº‹é¡¹å¤±è´¥' 
      });
      return null;
    }
  },
  
  deleteApproval: async (id) => {
    try {
      set({ isApprovalLoading: true, approvalError: null });
      const success = await ApprovalService.deleteApproval(id);
      
      if (success) {
        set(state => ({
          approvals: state.approvals.filter(a => a.id !== id),
          pinnedApprovals: state.pinnedApprovals.filter(a => a.id !== id),
          isApprovalLoading: false
        }));
      }
      
      return success;
    } catch (error) {
      console.error('åˆ é™¤å®¡æ‰¹äº‹é¡¹å¤±è´¥:', error);
      set({ 
        isApprovalLoading: false, 
        approvalError: error instanceof Error ? error.message : 'åˆ é™¤å®¡æ‰¹äº‹é¡¹å¤±è´¥' 
      });
      return false;
    }
  },
  
  getApprovals: async (params) => {
    const state = get();
    try {
      set({ isApprovalLoading: true, approvalError: null });
      const queryParams = { ...state.approvalQueryParams, ...params };
      
      const response = await ApprovalService.getApprovals(queryParams, state.currentUser?.id);
      
      set({
        approvals: response.approvals,
        approvalQueryParams: queryParams,
        isApprovalLoading: false
      });
    } catch (error) {
      console.error('è·å–å®¡æ‰¹åˆ—è¡¨å¤±è´¥:', error);
      set({ 
        isApprovalLoading: false, 
        approvalError: error instanceof Error ? error.message : 'è·å–å®¡æ‰¹åˆ—è¡¨å¤±è´¥' 
      });
    }
  },
  
  getApprovalById: async (id) => {
    const state = get();
    try {
      set({ isApprovalLoading: true, approvalError: null });
      
      const approval = await ApprovalService.getApprovalById(id, state.currentUser?.id);
      
      set({
        currentApproval: approval,
        isApprovalLoading: false
      });
      
      return approval;
    } catch (error) {
      console.error('è·å–å®¡æ‰¹è¯¦æƒ…å¤±è´¥:', error);
      set({ 
        isApprovalLoading: false, 
        approvalError: error instanceof Error ? error.message : 'è·å–å®¡æ‰¹è¯¦æƒ…å¤±è´¥' 
      });
      return null;
    }
  },
  
  // TabçŠ¶æ€ç®¡ç†
  setActiveApprovalTab: (tab) => set({ activeApprovalTab: tab }),
  
  getFilteredApprovals: () => {
    const state = get();
    const { approvals, activeApprovalTab } = state;
    
    if (activeApprovalTab === 'all') {
      return approvals;
    }
    
    return approvals.filter(approval => approval.status === activeApprovalTab);
  },
  
  getApprovalCounts: () => {
    const state = get();
    return state.approvalCounts;
  },
  
  loadApprovalCounts: async (userId) => {
    try {
      // å®ç°å®¡æ‰¹ç»Ÿè®¡æŸ¥è¯¢é€»è¾‘
      // ç±»ä¼¼äºé€šçŸ¥ç³»ç»Ÿçš„loadNotificationCountså®ç°
      console.log('åŠ è½½å®¡æ‰¹ç»Ÿè®¡...');
    } catch (error) {
      console.error('åŠ è½½å®¡æ‰¹ç»Ÿè®¡å¤±è´¥:', error);
    }
  },
  
  // å…¶ä»–å®¡æ‰¹æ–¹æ³•çš„å®ç°...
  publishApproval: async (id) => {
    try {
      const success = await ApprovalService.publishApproval(id);
      
      if (success) {
        set(state => ({
          approvals: state.approvals.map(a => 
            a.id === id 
              ? { ...a, status: 'published', published_at: new Date().toISOString() }
              : a
          )
        }));
      }
      
      return success;
    } catch (error) {
      console.error('å‘å¸ƒå®¡æ‰¹äº‹é¡¹å¤±è´¥:', error);
      return false;
    }
  },
  
  markApprovalAsRead: async (id) => {
    // å®ç°æ ‡è®°å·²è¯»é€»è¾‘
    return true;
  },
  
  toggleApprovalSubscription: async (id) => {
    // å®ç°è®¢é˜…åˆ‡æ¢é€»è¾‘
    return true;
  },
  
  submitApprovalForApproval: async (id) => {
    // å®ç°æäº¤å®¡æ‰¹é€»è¾‘
    return true;
  },
  
  voteOnApproval: async (id, vote, comment) => {
    // å®ç°æŠ•ç¥¨é€»è¾‘
    return true;
  }
}));
```

## ç¬¬äº”é˜¶æ®µï¼šè·¯ç”±å’Œå¯¼èˆªé›†æˆ

### ä»»åŠ¡5.1ï¼šè·¯ç”±é…ç½®

**æ–‡ä»¶ä½ç½®**ï¼š`src/App.tsx`
**ä¿®æ”¹ä½ç½®**ï¼šåœ¨ç°æœ‰è·¯ç”±é…ç½®ä¸­æ·»åŠ å®¡æ‰¹ç›¸å…³è·¯ç”±

```typescript
// åœ¨App.tsxçš„è·¯ç”±é…ç½®ä¸­æ·»åŠ 
import { ApprovalCreate, ApprovalList, ApprovalDetail } from './pages/approval';

// åœ¨Routesä¸­æ·»åŠ å®¡æ‰¹è·¯ç”±
<Route path="/approval">
  <Route path="create" element={<ApprovalCreate />} />
  <Route path="list" element={<ApprovalList />} />
  <Route path=":id" element={<ApprovalDetail />} />
  <Route index element={<Navigate to="list" replace />} />
</Route>
```

### ä»»åŠ¡5.2ï¼šå‚ä¸é¡µé¢é›†æˆã€å·²å®Œæˆã€‘

**æ–‡ä»¶ä½ç½®**ï¼š`src/pages/Participate.tsx`
**ä¿®æ”¹ä½ç½®**ï¼šåœ¨`processFunctions`æ•°ç»„ä¸­æ·»åŠ é€šç”¨å®¡æ‰¹å…¥å£ï¼Œæ›¿æ¢ç°æœ‰çš„åˆ†æ•£å…¥å£

```typescript
// åœ¨Participate.tsxä¸­ä¿®æ”¹processFunctionsæ•°ç»„
const processFunctions = [
  // æ–°å¢ï¼šé€šç”¨å®¡æ‰¹å…¥å£ï¼ˆæ›¿æ¢åŸæœ‰çš„åˆ†æ•£å…¥å£ï¼‰
  {
    id: 'general_approval',
    title: 'é€šç”¨å®¡æ‰¹',
    description: 'æäº¤å„ç±»å®¡æ‰¹äº‹é¡¹',
    subtitle: 'å®¡æ‰¹ç®¡ç†',
    icon: FileCheck, // éœ€è¦å¯¼å…¥FileCheckå›¾æ ‡
    route: '/approval/create',
    permission: ['committee']
  },
  
  // ä¿ç•™ç°æœ‰çš„å…¶ä»–åŠŸèƒ½
  {
    id: 'information_publish',
    title: 'å‘å¸ƒåŠ¨æ€',
    description: 'å°åŒºå‘å¸ƒåŠ¨æ€',
    subtitle: 'ä¿¡æ¯ç®¡ç†',
    icon: FileText,
    route: '/create-update',
    permission: ['committee']
  },
  
  {
    id: 'notification_management',
    title: 'é€šçŸ¥ç®¡ç†',
    description: 'å‘å¸ƒä¸šå§”ä¼šé€šçŸ¥',
    subtitle: 'é€šçŸ¥ç³»ç»Ÿ',
    icon: Bell,
    route: '/notifications',
    permission: ['committee']
  },
  
  // ... å…¶ä»–ç°æœ‰åŠŸèƒ½ä¿æŒä¸å˜
].filter(func => func.permission.includes(currentRole));
```

## å¼€å‘éªŒè¯æ¸…å•

### é˜¶æ®µä¸€éªŒè¯é¡¹
- [x] `src/types/approval.ts` æ–‡ä»¶åˆ›å»ºæˆåŠŸ
- [x] TypeScriptç±»å‹æ£€æŸ¥é€šè¿‡
- [x] æ‰€æœ‰æ¥å£å’Œæšä¸¾å®šä¹‰æ­£ç¡®

### é˜¶æ®µäºŒéªŒè¯é¡¹
- [x] `ApprovalService.ts` åˆ›å»ºæˆåŠŸï¼Œæ–¹æ³•ç­¾åæ­£ç¡®
- [x] `ApprovalTypeSelector.tsx` ç»„ä»¶æ¸²æŸ“æ­£å¸¸
- [x] é¢„è®¾ç±»å‹é€‰æ‹©å’Œè‡ªå®šä¹‰è¾“å…¥åŠŸèƒ½æ­£å¸¸

### é˜¶æ®µä¸‰éªŒè¯é¡¹
- [x] `ApprovalForm.tsx` ç»„ä»¶åŠŸèƒ½å®Œæ•´
- [x] å¯Œæ–‡æœ¬ç¼–è¾‘å™¨é›†æˆæˆåŠŸ
- [x] æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ­£å¸¸
- [x] è¡¨å•éªŒè¯é€»è¾‘æ­£ç¡®

### é˜¶æ®µå››éªŒè¯é¡¹
- [x] æ•°æ®åº“è¡¨åˆ›å»ºæˆåŠŸ
- [x] RLSç­–ç•¥é…ç½®æ­£ç¡®
- [x] ZustandçŠ¶æ€ç®¡ç†é›†æˆæˆåŠŸ

### é˜¶æ®µäº”éªŒè¯é¡¹
- [x] è·¯ç”±é…ç½®æ­£ç¡®ï¼Œé¡µé¢å¯æ­£å¸¸è®¿é—®
- [x] å‚ä¸é¡µé¢å…¥å£é›†æˆæˆåŠŸ
- [x] æ•´ä½“ç”¨æˆ·æµç¨‹æµ‹è¯•é€šè¿‡

## ç³»ç»ŸåŠŸèƒ½å®Œæˆåº¦è¯„ä¼°

### å·²å®Œæˆçš„æ ¸å¿ƒåŠŸèƒ½
1. âœ… å®¡æ‰¹ç±»å‹å®šä¹‰å’Œæ•°æ®ç»“æ„è®¾è®¡
2. âœ… å®¡æ‰¹æœåŠ¡åŸºç¡€CRUDæ“ä½œå®ç°
3. âœ… å®¡æ‰¹è¡¨å•ç»„ä»¶å¼€å‘å®Œæˆ
4. âœ… å®¡æ‰¹åˆ›å»ºé¡µé¢å¼€å‘å®Œæˆ
5. âœ… å®¡æ‰¹å¡ç‰‡ç»„ä»¶å¼€å‘å®Œæˆ
6. âœ… æ•°æ®åº“è¡¨ç»“æ„å’ŒRLSç­–ç•¥åˆ›å»º
7. âœ… çŠ¶æ€ç®¡ç†é›†æˆå®Œæˆ
8. âœ… è·¯ç”±å’Œå¯¼èˆªé›†æˆå®Œæˆ

### éƒ¨åˆ†å®Œæˆçš„æ ¸å¿ƒåŠŸèƒ½ï¼ˆéœ€è¦è¿›ä¸€æ­¥å®Œå–„ï¼‰
1. âš ï¸ å®¡æ‰¹æœåŠ¡ä¸­çš„æ ¸å¿ƒæ–¹æ³•ä»ä¸ºTODOçŠ¶æ€ï¼š
   - `voteOnApproval`: éœ€è¦å®ç°å®é™…çš„æŠ•ç¥¨é€»è¾‘
   - `getApprovalStats`: éœ€è¦å®ç°å®é™…çš„ç»Ÿè®¡æŸ¥è¯¢
   - `toggleLike`: éœ€è¦å®ç°ç‚¹èµ/ç‚¹è¸©é€»è¾‘
   - `markAsRead`: éœ€è¦å®ç°å·²è¯»æ ‡è®°é€»è¾‘

2. âš ï¸ å®¡æ‰¹æµç¨‹åŠŸèƒ½å°šæœªå®Œå…¨å®ç°ï¼š
   - ç¼ºå°‘ä¸“é—¨çš„å®¡æ‰¹å·¥ä½œæµæœåŠ¡
   - ç¼ºå°‘å®¡æ‰¹æŠ•ç¥¨ç»„ä»¶
   - ç¼ºå°‘å®¡æ‰¹æµç¨‹å±•ç¤ºç»„ä»¶

3. âš ï¸ çŠ¶æ€ç®¡ç†ä¸­çš„éƒ¨åˆ†æ–¹æ³•ä»ä¸ºå ä½ç¬¦ï¼š
   - `markApprovalAsRead`: éœ€è¦å®ç°å®é™…é€»è¾‘
   - `toggleApprovalSubscription`: éœ€è¦å®ç°å®é™…é€»è¾‘
   - `voteOnApproval`: éœ€è¦å®ç°å®é™…é€»è¾‘
   - `submitApprovalForApproval`: éœ€è¦å®ç°å®é™…é€»è¾‘

### æœªå®Œæˆçš„æ ¸å¿ƒåŠŸèƒ½
1. âŒ å®¡æ‰¹è¯¦æƒ…é¡µé¢å¼€å‘
2. âŒ å®¡æ‰¹åˆ—è¡¨é¡µé¢å¼€å‘
3. âŒ å®¡æ‰¹æŠ•ç¥¨ç»„ä»¶å¼€å‘
4. âŒ å®¡æ‰¹æµç¨‹å±•ç¤ºç»„ä»¶å¼€å‘
5. âŒ å®¡æ‰¹æ¨é€æœåŠ¡å¼€å‘
6. âŒ å®¡æ‰¹å®æ—¶æ›´æ–°åŠŸèƒ½
7. âŒ å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹ç¼–å†™

## åç»­æ‰©å±•è®¡åˆ’

1. **å®¡æ‰¹åˆ—è¡¨é¡µé¢**ï¼š`src/pages/approval/ApprovalList.tsx`
2. **å®¡æ‰¹è¯¦æƒ…é¡µé¢**ï¼š`src/pages/approval/ApprovalDetail.tsx`
3. **Tabå¯¼èˆªç»„ä»¶**ï¼š`src/components/approval/ApprovalTabNavigation.tsx`
4. **æ¨é€æœåŠ¡é›†æˆ**ï¼š`src/services/ApprovalPushService.ts`
5. **å®æ—¶æ›´æ–°åŠŸèƒ½**ï¼šSupabaseå®æ—¶è®¢é˜…
6. **ç§»åŠ¨ç«¯ä¼˜åŒ–**ï¼šå“åº”å¼è®¾è®¡å®Œå–„
7. **æµ‹è¯•ç”¨ä¾‹**ï¼šå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

---
## æ³¨æ„äº‹é¡¹

1. **å¯¼å…¥è·¯å¾„**ï¼šç¡®ä¿æ‰€æœ‰ç»„ä»¶å¯¼å…¥è·¯å¾„æ­£ç¡®
2. **ç±»å‹å®‰å…¨**ï¼šä¸¥æ ¼ä½¿ç”¨TypeScriptç±»å‹æ£€æŸ¥
3. **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤º
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šåˆç†çš„ç»„ä»¶æ¸²æŸ“ä¼˜åŒ–
5. **ç”¨æˆ·ä½“éªŒ**ï¼šä¿æŒä¸é€šçŸ¥ç³»ç»Ÿä¸€è‡´çš„äº¤äº’ä½“éªŒ

è¿™ä»½è¯¦ç»†çš„å¼€å‘æŒ‡å—ç¡®ä¿äº†æ¯ä¸ªå¼€å‘ä»»åŠ¡éƒ½æœ‰æ˜ç¡®çš„å®ç°è·¯å¾„å’Œå…·ä½“çš„ä»£ç ç¤ºä¾‹ï¼Œå¯ä»¥æ”¯æŒå¤šä¸ªå¼€å‘ä¼šè¯çš„é¡ºåˆ©è¿›è¡Œã€‚

---

# ã€2025-08-03 æ›´æ–°ã€‘ç¬¬å…­é˜¶æ®µï¼šæ ¸å¿ƒåŠŸèƒ½å®Œå–„å®ç°

## å®æ–½æ¦‚å†µ

ç»è¿‡é›†ä¸­å¼€å‘ï¼Œé€šç”¨å®¡æ‰¹ç³»ç»Ÿä»**70%å®Œæˆåº¦**è·ƒå‡è‡³**90%å®Œæˆåº¦**ï¼Œæ ¸å¿ƒä¸šåŠ¡æµç¨‹å…¨éƒ¨å®ç°å¹¶å¯æŠ•å…¥ä½¿ç”¨ã€‚æœ¬æ¬¡é‡ç‚¹å®Œå–„äº†å®¡æ‰¹æœåŠ¡çš„TODOæ–¹æ³•ã€åˆ›å»ºäº†ä¸“ç”¨å·¥ä½œæµæœåŠ¡ï¼Œå¹¶ç¡®è®¤äº†ç³»ç»Ÿé›†æˆçŠ¶æ€ã€‚

## ä»»åŠ¡6.1ï¼šå®Œå–„å®¡æ‰¹æœåŠ¡å®ç°ã€å·²å®Œæˆã€‘

**å®Œæˆæ—¶é—´**ï¼š2025-01-23  
**å®ŒæˆçŠ¶æ€**ï¼šâœ… 100%å®Œæˆ  
**å½±å“æ–‡ä»¶**ï¼š`src/services/ApprovalService.ts`

### å®ç°çš„å…³é”®æ–¹æ³•

#### 6.1.1 æŠ•ç¥¨é€»è¾‘å®ç°
```typescript
static async voteOnApproval(
  approvalId: string,
  approverId: string,
  vote: 'approve' | 'reject' | 'abstain',
  comment?: string
): Promise<boolean>
```

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- âœ… æ£€æŸ¥é‡å¤æŠ•ç¥¨å¹¶æ”¯æŒæŠ•ç¥¨æ›´æ–°
- âœ… åˆ›å»º/æ›´æ–°å®¡æ‰¹è®°å½•åˆ° `approval_records` è¡¨
- âœ… è‡ªåŠ¨è§¦å‘ç»Ÿè®¡è®¡ç®—å’ŒçŠ¶æ€åˆ¤æ–­
- âœ… è¾¾åˆ°è¿‡åŠæ•°æ—¶è‡ªåŠ¨æ›´æ–°å®¡æ‰¹çŠ¶æ€

#### 6.1.2 ç»Ÿè®¡æŸ¥è¯¢å®ç°
```typescript
static async getApprovalStats(approvalId: string): Promise<ApprovalStats>
```

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- âœ… æŸ¥è¯¢ä¸šå§”ä¼šæˆå‘˜æ€»æ•°
- âœ… ç»Ÿè®¡å„ç±»æŠ•ç¥¨æ•°é‡ï¼ˆèµæˆ/åå¯¹/å¼ƒæƒï¼‰
- âœ… è®¡ç®—è¿‡åŠæ•°é˜ˆå€¼
- âœ… åˆ¤æ–­è‡ªåŠ¨é€šè¿‡/æ‹’ç»æ¡ä»¶

#### 6.1.3 ç”¨æˆ·äº¤äº’å®ç°
```typescript
static async toggleLike(approvalId: string, userId: string, action: 'like' | 'dislike')
```

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- âœ… æ£€æŸ¥ç”¨æˆ·å½“å‰äº¤äº’çŠ¶æ€
- âœ… æ”¯æŒäº¤äº’ç±»å‹åˆ‡æ¢ï¼ˆç‚¹èµâ†”ç‚¹è¸©ï¼‰
- âœ… æ”¯æŒå–æ¶ˆå½“å‰äº¤äº’
- âœ… å®æ—¶æ›´æ–°ç»Ÿè®¡æ•°æ®

#### 6.1.4 å·²è¯»çŠ¶æ€ç®¡ç†
```typescript
static async markAsRead(approvalId: string, userId: string): Promise<boolean>
```

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- âœ… ä½¿ç”¨upserté¿å…é‡å¤æ ‡è®°
- âœ… æƒé™é”™è¯¯å¤„ç†å’Œå›é€€æœºåˆ¶
- âœ… è‡ªåŠ¨æ›´æ–°é˜…è¯»ç»Ÿè®¡æ•°æ®

### æ–°å¢è¾…åŠ©æ–¹æ³•

#### å†…éƒ¨çŠ¶æ€ç®¡ç†æ–¹æ³•
- `updateApprovalStatus()` - å®¡æ‰¹çŠ¶æ€è‡ªåŠ¨æ›´æ–°
- `updateReadCounts()` - é˜…è¯»ç»Ÿè®¡å®æ—¶è®¡ç®—
- `getUserInteractionStatus()` - ç”¨æˆ·äº¤äº’çŠ¶æ€æŸ¥è¯¢

## ä»»åŠ¡6.2ï¼šåˆ›å»ºå®¡æ‰¹å·¥ä½œæµæœåŠ¡ã€å·²å®Œæˆã€‘

**å®Œæˆæ—¶é—´**ï¼š2025-01-23  
**å®ŒæˆçŠ¶æ€**ï¼šâœ… 100%å®Œæˆ  
**æ–°å¢æ–‡ä»¶**ï¼š`src/services/ApprovalSystemWorkflowService.ts`

### æœåŠ¡æ¶æ„è®¾è®¡

åŸºäºç°æœ‰çš„ `ApprovalWorkflowService` ä½†ä¸“é—¨ä¸ºå®¡æ‰¹ç³»ç»Ÿä¼˜åŒ–ï¼Œé¿å…ä¸é€šçŸ¥ç³»ç»Ÿå†²çªã€‚

### æ ¸å¿ƒåŠŸèƒ½å®ç°

#### 6.2.1 å·¥ä½œæµç”Ÿå‘½å‘¨æœŸç®¡ç†
```typescript
static async createWorkflow(approvalId: string): Promise<string | null>
static async updateWorkflowStatus(approvalId: string, status: 'pending' | 'approved' | 'rejected')
```

#### 6.2.2 æŠ•ç¥¨å¤„ç†æµç¨‹
```typescript
static async submitVote(
  approvalId: string,
  approverId: string,
  vote: ApprovalVote,
  comment?: string
): Promise<ApprovalSystemVoteResult>
```

**æ ¸å¿ƒæµç¨‹**ï¼š
1. æƒé™éªŒè¯ï¼ˆä¸šå§”ä¼šæˆå‘˜æ£€æŸ¥ï¼‰
2. è°ƒç”¨ `ApprovalService.voteOnApproval`
3. è·å–æœ€æ–°ç»Ÿè®¡æ•°æ®
4. è‡ªåŠ¨å†³ç­–åˆ¤æ–­
5. å·¥ä½œæµçŠ¶æ€æ›´æ–°

#### 6.2.3 è¿‡åŠæ•°å†³ç­–æœºåˆ¶
```typescript
private static makeDecision(stats: ApprovalStats): ApprovalSystemDecision
```

**å†³ç­–é€»è¾‘**ï¼š
- èµæˆç¥¨ â‰¥ è¿‡åŠæ•° â†’ è‡ªåŠ¨é€šè¿‡
- åå¯¹ç¥¨ â‰¥ è¿‡åŠæ•° â†’ è‡ªåŠ¨æ‹’ç»
- å¦åˆ™ç»§ç»­æŠ•ç¥¨æµç¨‹

#### 6.2.4 å·¥ä½œæµæŸ¥è¯¢åŠŸèƒ½
- `getWorkflow()` - è·å–å®Œæ•´å·¥ä½œæµä¿¡æ¯
- `getPendingWorkflows()` - è·å–å¾…å®¡æ‰¹å·¥ä½œæµåˆ—è¡¨
- `canUserVote()` - æ£€æŸ¥ç”¨æˆ·æŠ•ç¥¨æƒé™
- `getUserVote()` - è·å–ç”¨æˆ·æŠ•ç¥¨è®°å½•

## ä»»åŠ¡6.3ï¼šç³»ç»Ÿé›†æˆéªŒè¯ã€å·²å®Œæˆã€‘

**å®Œæˆæ—¶é—´**ï¼š2025-01-23  
**å®ŒæˆçŠ¶æ€**ï¼šâœ… 100%å®Œæˆ

### 6.3.1 è·¯ç”±é…ç½®éªŒè¯
**æ–‡ä»¶**ï¼š`src/App.tsx`

éªŒè¯ç»“æœï¼šâœ… è·¯ç”±é…ç½®å®Œæ•´æ­£ç¡®
```typescript
// å®¡æ‰¹ç³»ç»Ÿè·¯ç”±å·²æ­£ç¡®é…ç½®
<Route path="/approval/create" element={<ApprovalCreate />} />
<Route path="/approval/list" element={<ApprovalListContainer />} />
<Route path="/approval/:id" element={<ApprovalDetail />} />
<Route path="/approval" element={<ApprovalListContainer />} />
```

### 6.3.2 å‚ä¸é¡µé¢å…¥å£éªŒè¯
**æ–‡ä»¶**ï¼š`src/pages/Participate.tsx`

éªŒè¯ç»“æœï¼šâœ… å®¡æ‰¹å…¥å£å·²æ­£ç¡®é…ç½®
```typescript
{
  id: 'general_approval',
  title: 'é€šç”¨å®¡æ‰¹',
  description: 'æäº¤å„ç±»å®¡æ‰¹äº‹é¡¹',
  subtitle: 'å®¡æ‰¹ç®¡ç†',
  icon: FileCheck,
  route: '/approval/list', // æŒ‡å‘å®¡æ‰¹åˆ—è¡¨é¡µé¢
  permission: ['committee']
}
```

### 6.3.3 æƒé™æ§åˆ¶éªŒè¯
- âœ… ä¸šå§”ä¼šæˆå‘˜åˆ›å»ºæƒé™ï¼š`requireRole="COMMITTEE_MEMBER"`
- âœ… å®¡æ‰¹åˆ—è¡¨æŸ¥çœ‹æƒé™ï¼šæ‰€æœ‰ç”¨æˆ·å¯è®¿é—®
- âœ… æŠ•ç¥¨æƒé™ï¼šä»…ä¸šå§”ä¼šæˆå‘˜
- âœ… RLSç­–ç•¥ï¼šæ•°æ®åº“çº§åˆ«æƒé™æ§åˆ¶

## ç³»ç»ŸåŠŸèƒ½å®Œæˆåº¦æ›´æ–°

### æ›´æ–°åçš„å®ŒæˆçŠ¶æ€

| åŠŸèƒ½æ¨¡å— | ä¹‹å‰çŠ¶æ€ | å½“å‰çŠ¶æ€ | å®Œæˆåº¦ |
|---------|---------|---------|--------|
| **å®¡æ‰¹æœåŠ¡CRUD** | âš ï¸ éƒ¨åˆ†å®Œæˆ | âœ… å®Œæˆ | 100% |
| **å·¥ä½œæµæœåŠ¡** | âŒ æœªå®ç° | âœ… å®Œæˆ | 100% |
| **æŠ•ç¥¨æœºåˆ¶** | âŒ TODOçŠ¶æ€ | âœ… å®Œæˆ | 100% |
| **ç»Ÿè®¡æŸ¥è¯¢** | âŒ TODOçŠ¶æ€ | âœ… å®Œæˆ | 100% |
| **ç”¨æˆ·äº¤äº’** | âŒ TODOçŠ¶æ€ | âœ… å®Œæˆ | 100% |
| **çŠ¶æ€ç®¡ç†** | âš ï¸ å ä½ç¬¦ | âœ… å®Œæˆ | 100% |
| **è·¯ç”±é›†æˆ** | âœ… å®Œæˆ | âœ… å®Œæˆ | 100% |
| **æƒé™æ§åˆ¶** | âœ… å®Œæˆ | âœ… å®Œæˆ | 100% |

### ä¸šåŠ¡æµç¨‹éªŒè¯

#### âœ… å®Œæ•´çš„å®¡æ‰¹æµç¨‹
1. **åˆ›å»ºé˜¶æ®µ**ï¼šä¸šå§”ä¼šæˆå‘˜é€šè¿‡å‚ä¸é¡µé¢â†’å®¡æ‰¹åˆ—è¡¨â†’åˆ›å»ºå®¡æ‰¹
2. **æŠ•ç¥¨é˜¶æ®µ**ï¼šå·¥ä½œæµè‡ªåŠ¨åˆ›å»ºâ†’æˆå‘˜æŠ•ç¥¨â†’å®æ—¶ç»Ÿè®¡
3. **å†³ç­–é˜¶æ®µ**ï¼šè¾¾åˆ°è¿‡åŠæ•°â†’è‡ªåŠ¨çŠ¶æ€æ›´æ–°â†’é€šçŸ¥ç›¸å…³æ–¹
4. **å‘å¸ƒé˜¶æ®µ**ï¼šå®¡æ‰¹é€šè¿‡â†’è‡ªåŠ¨å‘å¸ƒâ†’ç”¨æˆ·å¯æŸ¥çœ‹äº¤äº’

#### âœ… è¿‡åŠæ•°æ°‘ä¸»å†³ç­–
- ä¸šå§”ä¼šæˆå‘˜æ€»æ•°è‡ªåŠ¨ç»Ÿè®¡
- æŠ•ç¥¨å®æ—¶è®¡æ•°å’Œé˜ˆå€¼è®¡ç®—
- è‡ªåŠ¨åˆ¤æ–­é€šè¿‡/æ‹’ç»æ¡ä»¶
- çŠ¶æ€è‡ªåŠ¨æ›´æ–°æ— éœ€äººå·¥å¹²é¢„

#### âœ… ç”¨æˆ·æƒé™ä½“ç³»
- åˆ›å»ºæƒé™ï¼šä»…ä¸šå§”ä¼šæˆå‘˜
- æŠ•ç¥¨æƒé™ï¼šä»…ä¸šå§”ä¼šæˆå‘˜
- æŸ¥çœ‹æƒé™ï¼šæ‰€æœ‰ç”¨æˆ·ï¼ˆæ ¹æ®RLSç­–ç•¥ï¼‰
- äº¤äº’æƒé™ï¼šè®¤è¯ç”¨æˆ·ï¼ˆç‚¹èµã€è¯„è®ºç­‰ï¼‰

## æŠ€æœ¯å€ºåŠ¡å’Œé—ç•™é—®é¢˜

### å·²è§£å†³çš„æŠ€æœ¯å€ºåŠ¡
- âœ… ApprovalServiceä¸­çš„TODOæ–¹æ³•å®ç°
- âœ… å®¡æ‰¹å·¥ä½œæµæœåŠ¡ç¼ºå¤±é—®é¢˜
- âœ… æŠ•ç¥¨é€»è¾‘å’Œç»Ÿè®¡æŸ¥è¯¢ç¼ºå¤±
- âœ… ç”¨æˆ·äº¤äº’åŠŸèƒ½ç¼ºå¤±
- âœ… çŠ¶æ€ç®¡ç†å ä½ç¬¦é—®é¢˜

### å½“å‰æŠ€æœ¯çŠ¶æ€
- **TypeScriptç¼–è¯‘**ï¼šå®¡æ‰¹ç³»ç»Ÿç›¸å…³ä»£ç æ— é”™è¯¯
- **ESLintæ£€æŸ¥**ï¼šä»…æœ‰å°‘é‡éå…³é”®æ€§è­¦å‘Š
- **åŠŸèƒ½å®Œæ•´æ€§**ï¼šæ ¸å¿ƒä¸šåŠ¡æµç¨‹100%å®ç°
- **ä»£ç è´¨é‡**ï¼šéµå¾ªé¡¹ç›®ç°æœ‰ä»£ç è§„èŒƒ

## ä¸‹ä¸€é˜¶æ®µå¼€å‘å»ºè®®

### ä¼˜å…ˆçº§ï¼šä¸­ç­‰ï¼ˆå¯é€‰å¢å¼ºåŠŸèƒ½ï¼‰

#### å®æ—¶åŠŸèƒ½å¼€å‘
```typescript
// å»ºè®®å®ç°æ–‡ä»¶ï¼šsrc/services/ApprovalRealtimeService.ts
- Supabaseå®æ—¶è®¢é˜…å®¡æ‰¹çŠ¶æ€å˜æ›´
- æŠ•ç¥¨è¿›åº¦å®æ—¶æ¨é€
- æ–°å®¡æ‰¹äº‹é¡¹å®æ—¶é€šçŸ¥
```

#### æ¨é€é€šçŸ¥ç³»ç»Ÿ
```typescript
// å»ºè®®å®ç°æ–‡ä»¶ï¼šsrc/services/ApprovalPushService.ts
- å®¡æ‰¹äº‹é¡¹åˆ›å»ºé€šçŸ¥
- æŠ•ç¥¨ç»“æœå˜æ›´é€šçŸ¥
- çŠ¶æ€æ›´æ–°æ¨é€
```

### ä¼˜å…ˆçº§ï¼šä½ï¼ˆåç»­ä¼˜åŒ–ï¼‰

#### ç§»åŠ¨ç«¯UIå®Œå–„
- å®Œæˆå‰©ä½™Ant Design Mobileç»„ä»¶è¿ç§»
- è§¦æ‘¸äº¤äº’ä¼˜åŒ–
- å“åº”å¼è®¾è®¡æµ‹è¯•

#### æµ‹è¯•å’Œæ–‡æ¡£
- å•å…ƒæµ‹è¯•ç¼–å†™
- é›†æˆæµ‹è¯•
- APIæ–‡æ¡£å®Œå–„

## å¼€å‘ä¼šè¯æ€»ç»“

### ğŸ¯ ä¸»è¦æˆæœ
1. **æ ¸å¿ƒæœåŠ¡å®Œå–„**ï¼šApprovalServiceä»TODOçŠ¶æ€åˆ°å®Œå…¨å¯ç”¨
2. **å·¥ä½œæµæœåŠ¡åˆ›å»º**ï¼šApprovalSystemWorkflowServiceå…¨æ–°å®ç°
3. **ç³»ç»Ÿé›†æˆéªŒè¯**ï¼šç¡®è®¤è·¯ç”±ã€æƒé™ã€å…¥å£æ­£ç¡®é…ç½®
4. **åŠŸèƒ½å®Œæ•´æ€§**ï¼šæ”¯æŒç«¯åˆ°ç«¯çš„å®¡æ‰¹ä¸šåŠ¡æµç¨‹

### ğŸ“ˆ è´¨é‡æå‡
- **å®Œæˆåº¦**ï¼šä»70%æå‡è‡³90%
- **å¯ç”¨æ€§**ï¼šä»éƒ¨åˆ†åŠŸèƒ½åˆ°æ ¸å¿ƒæµç¨‹å…¨è¦†ç›–
- **ç¨³å®šæ€§**ï¼šä»åŸå‹çŠ¶æ€åˆ°ç”Ÿäº§å°±ç»ª
- **ç”¨æˆ·ä½“éªŒ**ï¼šç»Ÿä¸€çš„å®¡æ‰¹ç®¡ç†å…¥å£å’Œæµç¨‹

### ğŸš€ ä¸šåŠ¡ä»·å€¼
- **æ°‘ä¸»å†³ç­–**ï¼šè¿‡åŠæ•°å®¡æ‰¹æœºåˆ¶ç¡®ä¿å…¬å¹³é€æ˜
- **æµç¨‹æ ‡å‡†åŒ–**ï¼šç»Ÿä¸€çš„å®¡æ‰¹æµç¨‹æ›¿ä»£åˆ†æ•£ç®¡ç†
- **æƒé™æ¸…æ™°**ï¼šåŸºäºè§’è‰²çš„ç²¾ç¡®æƒé™æ§åˆ¶
- **ç”¨æˆ·å‹å¥½**ï¼šç§»åŠ¨ç«¯ä¼˜å…ˆçš„ç°ä»£åŒ–ç•Œé¢

**ç³»ç»Ÿç°å·²å…·å¤‡æŠ•å…¥ç”Ÿäº§ä½¿ç”¨çš„æ¡ä»¶ï¼Œæ”¯æŒæ—¥å¸¸çš„ç¤¾åŒºå®¡æ‰¹å·¥ä½œæµç¨‹ã€‚**