# 系统架构文档

## 概述

阳光花园社区应用是一个基于现代Web技术构建的社区信息管理系统。该系统采用前后端分离的架构，前端使用React和TypeScript构建，后端使用Supabase提供的云服务，包括数据库、认证和实时功能。系统还集成了AI服务，用于生成事件概要和提供其他智能辅助功能。

## 架构图

```
┌─────────────────────────────────────────────────────────────────────┐
│                            用户界面                                │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │
│  │   浏览器    │  │   移动应用   │  │   小程序    │  │   其他客户端 │ │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘ │
└─────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────┐
│                           API网关/负载均衡                          │
└─────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────┐
│                           前端应用 (React)                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │
│  │   首页模块   │  │   参与模块   │  │   消息模块   │  │   个人中心模块 │ │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘ │
│                                                                     │
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │                     状态管理 (Zustand)                        │  │
│  └───────────────────────────────────────────────────────────────┘  │
│                                                                     │
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │                    路由管理 (React Router)                    │  │
│  └───────────────────────────────────────────────────────────────┘  │
│                                                                     │
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │               UI组件库 (Tailwind CSS + shadcn/ui)             │  │
│  └───────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────┐
│                           后端服务 (Supabase)                      │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │
│  │   数据库    │  │   认证服务   │  │   存储服务   │  │   实时服务   │ │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘ │
└─────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────┐
│                           AI服务 (硅基流动)                        │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │
│  │   文本生成   │  │   图像识别   │  │   语音处理   │  │   其他AI功能 │ │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘ │
└─────────────────────────────────────────────────────────────────────┘
```

## 前端架构

前端应用基于React框架构建，使用TypeScript进行类型检查，确保代码质量和可维护性。

### 技术栈
- **React**: 用于构建用户界面的JavaScript库。
- **TypeScript**: 为JavaScript添加静态类型检查，提高代码质量和开发效率。
- **Vite**: 构建工具，提供快速的开发环境和优化的生产构建。
- **React Router**: 用于处理页面路由。
- **Zustand**: 轻量级的状态管理库。
- **Tailwind CSS**: 用于快速构建自定义用户界面的CSS框架。
- **shadcn/ui**: 基于Tailwind CSS和Radix UI构建的可复用组件库。
- **Lucide React**: 图标库。

### 模块划分
1. **首页模块**: 展示社区事件列表、重要公告等。
2. **参与模块**: 提供业委会功能，如支出申请、用印申请、公告通知、征询意见等。
3. **消息模块**: 展示系统消息和用户互动消息。
4. **个人中心模块**: 用户个人信息管理、设置等。

### 数据流
1. 用户在前端界面进行操作。
2. 前端通过Supabase客户端库与后端服务交互。
3. 后端服务处理请求，操作数据库或调用其他服务。
4. 后端将结果返回给前端。
5. 前端更新UI，展示结果给用户。

## 后端架构 (Supabase)

后端服务完全基于Supabase云平台，包括以下核心组件：

### 数据库
- 使用PostgreSQL数据库，通过Supabase提供的数据库服务进行管理。
- 支持行级安全策略(RLS)，确保数据访问的安全性。
- 支持实时订阅，实现数据的实时更新。

### 认证服务
- 提供用户注册、登录、邮箱验证、密码重置等功能。
- 支持多种认证方式，如邮箱密码、OAuth等。

### 存储服务
- 提供文件存储功能，用于存储用户上传的图片、附件等。

### 实时服务
- 基于PostgreSQL的实时功能，实现数据变更的实时推送。

## 数据库架构

数据库设计遵循规范化原则，确保数据的一致性和完整性。主要表包括：
- `users`: 存储用户信息。
- `events`: 存储社区事件信息。
- `timeline_items`: 存储事件的时间线信息。
- `user_interactions`: 存储用户互动信息。
- `messages`: 存储消息信息。
- `event_collaborators`: 存储事件协作者信息。
- `search_history`: 存储用户搜索历史。

详细设计请参考 [数据库设计文档](./database-design.md)。

## AI服务集成

系统集成了硅基流动提供的AI服务，主要用于：
- **事件概要生成**: 利用AI技术自动生成事件的概要信息，提高信息获取效率。
- **智能辅助**: 在用户创建事件或撰写内容时提供智能辅助建议。

AI服务通过API调用的方式与系统集成，前端或后端在需要时调用相应的AI功能。

## 部署架构

应用可以部署在多种环境中，包括：
- **开发环境**: 本地开发环境，使用Vite提供的开发服务器。
- **测试环境**: 用于测试的预发布环境。
- **生产环境**: 面向最终用户的生产环境。

部署时，前端应用构建为静态文件，可以托管在CDN或静态文件服务器上。后端服务由Supabase提供，无需额外部署。

## 安全性

系统在多个层面考虑了安全性：
- **认证与授权**: 通过Supabase的认证服务和行级安全策略确保用户只能访问授权的数据。
- **数据传输**: 使用HTTPS协议确保数据在传输过程中的安全。
- **数据存储**: 敏感数据在存储时进行加密处理。
- **输入验证**: 对用户输入进行严格的验证，防止SQL注入等攻击。