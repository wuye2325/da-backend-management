<svg width="1200" height="800" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font-family: Arial, sans-serif; font-size: 20px; font-weight: bold; fill: #2563eb; }
      .box { fill: #f8fafc; stroke: #3b82f6; stroke-width: 2; rx: 8; }
      .decision { fill: #fef3c7; stroke: #f59e0b; stroke-width: 2; }
      .process { fill: #ecfdf5; stroke: #10b981; stroke-width: 2; rx: 8; }
      .storage { fill: #f3e8ff; stroke: #8b5cf6; stroke-width: 2; rx: 8; }
      .text { font-family: Arial, sans-serif; font-size: 12px; fill: #374151; text-anchor: middle; }
      .arrow { stroke: #6b7280; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .label { font-family: Arial, sans-serif; font-size: 10px; fill: #6b7280; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#6b7280" />
    </marker>
  </defs>
  
  <!-- 标题 -->
  <text x="600" y="30" class="title">AI信息降噪业务流程图</text>
  
  <!-- 用户访问页面 -->
  <rect x="50" y="60" width="120" height="60" class="box" />
  <text x="110" y="85" class="text">用户访问</text>
  <text x="110" y="100" class="text">页面</text>
  
  <!-- 检查AI总结是否存在 -->
  <polygon points="250,60 350,90 250,120 150,90" class="decision" />
  <text x="250" y="85" class="text">检查AI总结</text>
  <text x="250" y="100" class="text">是否存在？</text>
  
  <!-- 存在：从数据库获取 -->
  <rect x="400" y="60" width="120" height="60" class="box" />
  <text x="460" y="85" class="text">从数据库</text>
  <text x="460" y="100" class="text">获取总结</text>
  
  <!-- 不存在：显示生成按钮 -->
  <rect x="180" y="180" width="140" height="60" class="process" />
  <text x="250" y="205" class="text">显示"生成AI总结"</text>
  <text x="250" y="220" class="text">按钮</text>
  
  <!-- 用户点击生成 -->
  <rect x="180" y="280" width="140" height="60" class="box" />
  <text x="250" y="305" class="text">用户点击</text>
  <text x="250" y="320" class="text">生成按钮</text>
  
  <!-- 获取原始数据 -->
  <rect x="50" y="380" width="120" height="60" class="process" />
  <text x="110" y="405" class="text">获取原始数据</text>
  <text x="110" y="420" class="text">(事件、任务等)</text>
  
  <!-- 数据预处理 -->
  <rect x="220" y="380" width="120" height="60" class="process" />
  <text x="280" y="405" class="text">数据预处理</text>
  <text x="280" y="420" class="text">(过滤、排序)</text>
  
  <!-- 生成AI提示词 -->
  <rect x="390" y="380" width="120" height="60" class="process" />
  <text x="450" y="405" class="text">生成AI</text>
  <text x="450" y="420" class="text">提示词</text>
  
  <!-- 调用AI API -->
  <rect x="560" y="380" width="120" height="60" class="process" />
  <text x="620" y="405" class="text">调用AI API</text>
  <text x="620" y="420" class="text">(OpenAI)</text>
  
  <!-- 解析AI响应 -->
  <rect x="730" y="380" width="120" height="60" class="process" />
  <text x="790" y="405" class="text">解析AI响应</text>
  <text x="790" y="420" class="text">(JSON格式)</text>
  
  <!-- 保存到数据库 -->
  <rect x="900" y="380" width="120" height="60" class="storage" />
  <text x="960" y="405" class="text">保存到</text>
  <text x="960" y="420" class="text">数据库</text>
  
  <!-- 显示总结内容 -->
  <rect x="730" y="280" width="140" height="60" class="box" />
  <text x="800" y="305" class="text">显示总结内容</text>
  <text x="800" y="320" class="text">(概览、重点、洞察)</text>
  
  <!-- 用户刷新操作 -->
  <rect x="950" y="180" width="120" height="60" class="box" />
  <text x="1010" y="205" class="text">用户点击</text>
  <text x="1010" y="220" class="text">刷新按钮</text>
  
  <!-- 删除旧总结 -->
  <rect x="950" y="280" width="120" height="60" class="process" />
  <text x="1010" y="305" class="text">删除旧总结</text>
  <text x="1010" y="320" class="text">(清除缓存)</text>
  
  <!-- 数据库表 -->
  <rect x="500" y="500" width="200" height="100" class="storage" />
  <text x="600" y="525" class="text">ai_summaries 表</text>
  <text x="600" y="545" class="text">- id (主键)</text>
  <text x="600" y="560" class="text">- time_range (时间范围)</text>
  <text x="600" y="575" class="text">- summary_data (总结数据)</text>
  <text x="600" y="590" class="text">- created_at (创建时间)</text>
  
  <!-- 箭头连接 -->
  <line x1="170" y1="90" x2="200" y2="90" class="arrow" />
  <line x1="300" y1="90" x2="400" y2="90" class="arrow" />
  <text x="350" y="85" class="label">存在</text>
  
  <line x1="250" y1="120" x2="250" y2="180" class="arrow" />
  <text x="260" y="150" class="label">不存在</text>
  
  <line x1="250" y1="240" x2="250" y2="280" class="arrow" />
  
  <line x1="250" y1="340" x2="110" y2="380" class="arrow" />
  <line x1="170" y1="410" x2="220" y2="410" class="arrow" />
  <line x1="340" y1="410" x2="390" y2="410" class="arrow" />
  <line x1="510" y1="410" x2="560" y2="410" class="arrow" />
  <line x1="680" y1="410" x2="730" y2="410" class="arrow" />
  <line x1="850" y1="410" x2="900" y2="410" class="arrow" />
  
  <line x1="960" y1="380" x2="960" y2="340" class="arrow" />
  <line x1="900" y1="320" x2="870" y2="320" class="arrow" />
  
  <line x1="520" y1="90" x2="800" y2="90" class="arrow" />
  <line x1="800" y1="90" x2="800" y2="280" class="arrow" />
  
  <line x1="870" y1="310" x2="1010" y2="240" class="arrow" />
  <line x1="1010" y1="240" x2="1010" y2="280" class="arrow" />
  
  <line x1="950" y1="320" x2="250" y2="320" class="arrow" stroke-dasharray="5,5" />
  <text x="600" y="335" class="label">重新生成流程</text>
  
  <!-- 数据库连接线 -->
  <line x1="960" y1="440" x2="600" y2="500" class="arrow" stroke-dasharray="3,3" />
  <line x1="460" y1="120" x2="550" y2="500" class="arrow" stroke-dasharray="3,3" />
  
  <!-- 图例 -->
  <rect x="50" y="650" width="300" height="120" fill="none" stroke="#d1d5db" stroke-width="1" />
  <text x="200" y="670" class="text" style="font-weight: bold;">图例说明</text>
  
  <rect x="70" y="680" width="40" height="20" class="box" />
  <text x="120" y="695" class="label">用户操作</text>
  
  <rect x="70" y="710" width="40" height="20" class="process" />
  <text x="120" y="725" class="label">系统处理</text>
  
  <polygon points="70,740 110,750 70,760 30,750" class="decision" />
  <text x="120" y="755" class="label">判断条件</text>
  
  <rect x="200" y="680" width="40" height="20" class="storage" />
  <text x="250" y="695" class="label">数据存储</text>
  
  <line x1="200" y1="720" x2="240" y2="720" class="arrow" />
  <text x="250" y="725" class="label">数据流向</text>
  
  <line x1="200" y1="750" x2="240" y2="750" class="arrow" stroke-dasharray="3,3" />
  <text x="250" y="755" class="label">数据库操作</text>
  
</svg>