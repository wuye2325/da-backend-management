# 用户角色和权限文档

## 概述

阳光花园社区应用支持三种用户角色：业主、业委会成员和物业。每种角色有不同的功能权限，以确保系统的安全性和功能性。本系统通过严格的权限控制机制，确保用户只能访问和操作自己权限范围内的功能和数据。

## 用户角色

### 业主

业主是社区的普通居民，是系统的主要使用者。业主可以查看社区事件和公告，提出建议和报修请求，参与社区互动。

#### 权限详情

- **查看权限**:
  - 查看所有公开的社区事件和公告。
  - 查看事件详情和时间线。
  - 查看财务公开信息。
  - 查看其他业主的公开信息。

- **创建权限**:
  - 创建"小区建议"类型的事件。
  - 创建"报事报修"类型的事件。
  - 在已有事件中添加进展更新。

- **互动权限**:
  - 对事件和时间线项目进行点赞、点踩、跟进等操作。
  - 在事件和时间线项目的评论区发表评论。
  - 参与征询意见投票。

- **消息权限**:
  - 接收系统消息和互动消息。
  - 查看个人消息中心。

- **个人权限**:
  - 查看和编辑个人资料。
  - 修改个人密码。
  - 查看个人发布的事件和参与的事件。

### 业委会成员

业委会成员是社区的管理者，拥有更多的管理权限。业委会成员可以发布公告、发起征询意见、处理支出申请等。

#### 权限详情

- **查看权限**:
  - 拥有业主的所有查看权限。
  - 查看所有类型的事件和时间线项目。
  - 查看详细的财务信息和统计报表。

- **创建权限**:
  - 创建所有类型的事件。
  - 创建和管理征询意见。
  - 创建和管理支出申请、用印申请等审批流程。

- **管理权限**:
  - 编辑和删除自己创建的事件。
  - 在一定条件下编辑和删除其他用户创建的事件。
  - 置顶重要事件。
  - 管理事件的标签和分类。
  - 管理用户评论，包括删除不当评论。

- **审批权限**:
  - 审批支出申请、用印申请等流程。
  - 查看和处理待审批事项。

- **消息权限**:
  - 拥有业主的所有消息权限。
  - 发送系统公告。
  - 向特定用户或用户组发送消息。

- **个人权限**:
  - 拥有业主的所有个人权限。
  - 查看和管理业委会相关信息。

### 物业

物业是社区的服务提供者，负责小区的日常管理。物业可以发布物业通知、处理报修请求等。

#### 权限详情

- **查看权限**:
  - 查看所有公开的社区事件和公告。
  - 查看事件详情和时间线。
  - 查看与物业相关的事件和通知。

- **创建权限**:
  - 创建"通知发布"类型的事件。
  - 创建和更新与物业相关的事件进展。

- **管理权限**:
  - 编辑和删除自己创建的事件。
  - 在一定条件下编辑和删除与物业相关的事件。
  - 更新事件状态，如标记为"处理中"、"已完成"等。

- **消息权限**:
  - 接收系统消息和互动消息。
  - 向相关用户发送物业通知。

- **个人权限**:
  - 查看和编辑个人资料。
  - 修改个人密码。

## 权限控制机制

系统通过以下机制实现权限控制：

### 身份认证

用户需要通过注册和登录来获得系统身份。系统支持邮箱密码注册和登录，以及第三方OAuth登录（如微信、QQ等）。

### 角色分配

用户角色在注册时或由管理员分配。普通用户默认为"业主"角色，业委会成员和物业由管理员审核后分配相应角色。

### 功能权限控制

系统在前端和后端都实现了功能权限控制：
- **前端控制**: 根据用户角色显示相应的功能菜单和操作按钮。
- **后端控制**: 在API层面验证用户权限，拒绝未授权的请求。

### 数据权限控制

系统通过行级安全策略(RLS)实现数据权限控制，确保用户只能访问授权的数据：
- 业主只能查看公开的事件和自己的数据。
- 业委会成员可以查看所有数据，但只能编辑自己创建的或授权编辑的数据。
- 物业可以查看和编辑与物业相关的数据。

### 权限审计

系统记录用户的操作日志，包括登录、数据访问、数据修改等，以便进行安全审计和问题追踪。